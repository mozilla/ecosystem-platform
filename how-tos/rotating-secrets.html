<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-how-tos/rotating-secrets" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.0.1">
<title data-rh="true">Rotating Secrets | Firefox Ecosystem Platform</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://mozilla.github.io/ecosystem-platform/how-tos/rotating-secrets"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Rotating Secrets | Firefox Ecosystem Platform"><meta data-rh="true" name="description" content="Last updated: Oct 6th, 2023"><meta data-rh="true" property="og:description" content="Last updated: Oct 6th, 2023"><link data-rh="true" rel="icon" href="/ecosystem-platform/img/firefox-logo.png"><link data-rh="true" rel="canonical" href="https://mozilla.github.io/ecosystem-platform/how-tos/rotating-secrets"><link data-rh="true" rel="alternate" href="https://mozilla.github.io/ecosystem-platform/how-tos/rotating-secrets" hreflang="en"><link data-rh="true" rel="alternate" href="https://mozilla.github.io/ecosystem-platform/how-tos/rotating-secrets" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://RFM5H13DFK-dsn.algolia.net" crossorigin="anonymous"><link rel="search" type="application/opensearchdescription+xml" title="Firefox Ecosystem Platform" href="/ecosystem-platform/opensearch.xml"><link rel="stylesheet" href="/ecosystem-platform/assets/css/styles.e5583d03.css">
<script src="/ecosystem-platform/assets/js/runtime~main.5bad1611.js" defer="defer"></script>
<script src="/ecosystem-platform/assets/js/main.f9afe5db.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();null!==e?t(e):window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,t("light"))}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/ecosystem-platform/"><div class="navbar__logo"><img src="/ecosystem-platform/img/firefox-logo.png" alt="Ecosystem Platform Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/ecosystem-platform/img/firefox-logo.png" alt="Ecosystem Platform Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Firefox Ecosystem Platform</b></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/mozilla/ecosystem-platform" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/ecosystem-platform/">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link">For Relying Parties</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/ecosystem-platform/relying-parties/tutorials/integration-with-fxa">Tutorials</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/ecosystem-platform/relying-parties/how-tos/end-to-end-encryption">How-to Guides</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/ecosystem-platform/relying-parties/reference/integration-requirements">Reference</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--active">For FxA Engineers</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/ecosystem-platform/tutorials/development-setup">Tutorials</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/ecosystem-platform/how-tos/ci-guidelines">How-to Guides</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/how-tos/ci-guidelines">CI Guidelines</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/how-tos/connecting-to-a-local-mysql-db">Connecting to a local MySQL DB</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/how-tos/creating-an-account-locally">Creating an Account Locally</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/how-tos/local-emails-with-maildev">Local Emails with MailDev</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/how-tos/managing-yarn-dependencies">Managing Yarn Dependencies</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/how-tos/node-debugging">Node Debugging</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/how-tos/using-a-custom-profile-with-firefox">Using a Custom Profile with Firefox</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/how-tos/using-sentry-locally">Using Sentry.io for Local Development</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/how-tos/using-swagger-for-api-documentation">Using Swagger for API documentation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/how-tos/using-tracing-in-gcp">Tracing for Stage/Prod</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/how-tos/using-tracing-locally">Tracing for Local Development</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/how-tos/using-vscode-with-fxa">Using VS Code with FxA</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/how-tos/working-with-metrics">Working with Metrics</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/ecosystem-platform/how-tos/rotating-secrets">Rotating Secrets</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/ecosystem-platform/reference/team-processes/development-process">Reference</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/ecosystem-platform/explanation/architectural-decision-records">Explanation</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/additional-docs">Additional Docs</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link">For Support Agents</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/ecosystem-platform/reference/admin-panel">Reference</a></div></li></ul></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/ecosystem-platform/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">For FxA Engineers</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">How-to Guides</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Rotating Secrets</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Rotating Secrets</h1></header><p>Last updated: <code>Oct 6th, 2023</code></p>
<p>It is unfortunate yet inevitable that secrets such as API keys get leaked upon occasion. In most cases, this is an urgent matter that must be addressed immediately, but it depends on what information was leaked, whether it&#x27;s still valid, and what damage can be done with that information.</p>
<p>In the steps below, we&#x27;ll walk through an example for how to resolve a possible leak of a Stripe API key.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="find-or-be-informed-about-the-potential-leak">Find or be informed about the (potential) leak<a href="#find-or-be-informed-about-the-potential-leak" class="hash-link" aria-label="Direct link to Find or be informed about the (potential) leak" title="Direct link to Find or be informed about the (potential) leak">​</a></h2>
<p>There are many ways this can happen:</p>
<ul>
<li>An engineer stumbles upon it while working on a patch</li>
<li>The Mozilla information security team finds it as part of a routine scan</li>
<li>It is flagged as part of Mozilla&#x27;s bug bounty program</li>
<li>GitHub notifies us with a <a href="https://docs.github.com/en/code-security/secret-scanning" target="_blank" rel="noopener noreferrer">secret scanning alert</a></li>
<li>And more...</li>
</ul>
<p>In the case of our example, we received a secret scanning alert from GitHub in the <code>fxa</code> repo.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="confirm-the-leak-and-its-severity">Confirm the leak and its severity<a href="#confirm-the-leak-and-its-severity" class="hash-link" aria-label="Direct link to Confirm the leak and its severity" title="Direct link to Confirm the leak and its severity">​</a></h2>
<p>Sometimes, sensitive looking data isn&#x27;t actually valid or compromising. Try to answer the following questions, answered below with our Stripe API key example:</p>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>If the secret is expired or otherwise invalid, the urgency goes away, and you can skip these questions to the next step.</p></div></div>
<ul>
<li><strong>Is this a valid secret?</strong>
<ul>
<li>Yes. It is listed in the <a href="https://dashboard.stripe.com/test/apikeys" target="_blank" rel="noopener noreferrer">stage (<code>SUB_PLAT_STAGE</code>) dashboard</a> as the unrestricted <a href="https://stripe.com/docs/test-mode" target="_blank" rel="noopener noreferrer">test mode</a> secret key, and it is active. This is a real leak.</li>
</ul>
</li>
<li><strong>Is it in use?</strong>
<ul>
<li>In this case, the <a href="https://dashboard.stripe.com/test/apikeys" target="_blank" rel="noopener noreferrer">Stripe API Keys page in the dashboard</a> has helpful information including when a given valid key was last used. Per the dashboard, our example key was last used very recently, so it&#x27;s definitely still in use!</li>
</ul>
</li>
<li><strong>What do we use it for?</strong>
<ul>
<li>Since this is an unrestricted Stripe API key (test mode), it is used to make read/write API requests to any Stripe API in test mode in our staging environment. Without searching for this key value explicitly in various places (see <a href="#places-to-check-where-a-secret-might-be-used">Places to check where a secret might be used</a>), one can only guess at this point that it&#x27;s likely used by our stage apps to make Stripe API calls, and maybe by our CI end-to-end tests to do the same.</li>
</ul>
</li>
<li><strong>What <em>can</em> it be used for?</strong>
<ul>
<li>In terms of severity, the fact that this key is unrestricted is very bad, but the fact that it&#x27;s only valid for our staging environment (and in Stripe test mode), which uses fake data and money, greatly reduces the risk and urgency of this leak.<!-- -->
<ul>
<li>By contrast, if this same key was for production (live mode), an attacker could <a href="https://stripe.com/docs/keys#safe-keys" target="_blank" rel="noopener noreferrer">make charges or issue refunds</a> among other things.</li>
</ul>
</li>
<li><strong>Can someone with this secret access sensitive user data?</strong>
<ul>
<li>No. All data is test data.</li>
</ul>
</li>
<li><strong>Can someone with this secret modify critical user or application state?</strong>
<ul>
<li>They could not modify real users&#x27; state. They could modify our stage application state and/or cause us to get rate limited by Stripe, where subsequent API requests are denied.</li>
</ul>
</li>
</ul>
</li>
<li><strong>Where was it exposed?</strong>
<ul>
<li>The GitHub secret scanning alert indicates where it found the secret referenced. It scans the code but also other forms of user-generated content, like PR comments and issues. It&#x27;s worth noting that depending on how old the alert is, a reference may have since been removed or moved.</li>
<li>In this example of the leaked test Stripe API key, this was leaked in a user comment within a GitHub issue.</li>
</ul>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="fix-the-leak">Fix the leak<a href="#fix-the-leak" class="hash-link" aria-label="Direct link to Fix the leak" title="Direct link to Fix the leak">​</a></h2>
<p>The most important thing to do -- particularly if the secret is valid -- is to remove the exposed secret from wherever it was found.</p>
<p>In this example, the secret was leaked in a GitHub issue comment. The comment can be edited to redact the reference, but it will still be retained in the comment&#x27;s revision history. An <a href="https://docs.github.com/en/organizations/managing-user-access-to-your-organizations-repositories/managing-repository-roles/repository-roles-for-an-organization" target="_blank" rel="noopener noreferrer">admin for the repo</a> can remove the revision which introduced the leak to completely remove any public reference to it.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="rotate-the-secret-if-valid">Rotate the secret (if valid)<a href="#rotate-the-secret-if-valid" class="hash-link" aria-label="Direct link to Rotate the secret (if valid)" title="Direct link to Rotate the secret (if valid)">​</a></h2>
<p>Now that we&#x27;ve stopped the bleeding, it&#x27;s time to rotate the secret if it was determined to be valid and in use.</p>
<p>The steps here are to:</p>
<ol>
<li>Create a new secret,</li>
<li>Replace the old secret where it&#x27;s used with the new secret, and</li>
<li>Invalidate the old secret</li>
</ol>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</div><div class="admonitionContent_BuS1"><p>Order matters! Don&#x27;t invalidate the old key unless/until a new key has been created, the old key&#x27;s value has been replaced everywhere it&#x27;s used and any affected parties (such as other engineers) have been notified.</p><p>Depending on the urgency and deployment process, this overlap period where both keys are valid could be on the order of seconds, hours or even days. Discuss this with the team if you&#x27;re uncertain.</p></div></div>
<p>For our example, <a href="https://stripe.com/docs/keys#rolling-keys" target="_blank" rel="noopener noreferrer">Stripe provides some helpful docs</a> on how to create a new secret and invalidate the old secret. The hard part here is replacing the old secret where it is used with the new secret, as we store secrets in a number of different places for different purposes.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="places-to-check-where-a-secret-might-be-used">Places to check where a secret might be used<a href="#places-to-check-where-a-secret-might-be-used" class="hash-link" aria-label="Direct link to Places to check where a secret might be used" title="Direct link to Places to check where a secret might be used">​</a></h3>
<ul>
<li>Application config environment variables<!-- -->
<ul>
<li>These secrets are managed by SRE, so you will need to <a href="https://mozilla-hub.atlassian.net/wiki/spaces/SECENGOPS/pages/378273870/How+to+share+a+secret+with+coworkers" target="_blank" rel="noopener noreferrer">securely send them the new secret</a>, so they can update it and redeploy the affected application(s).</li>
<li>If you&#x27;re unsure what environment variable(s) represent this secret in what app(s), you can send them both the old secret and the new secret, so they can do a find-and-replace.</li>
</ul>
</li>
<li><a href="https://circleci.com/docs/env-vars/#private-keys-and-secrets" target="_blank" rel="noopener noreferrer">CircleCI environment variables</a></li>
<li>GitHub <a href="https://docs.github.com/en/actions/security-guides/using-secrets-in-github-actions" target="_blank" rel="noopener noreferrer">Actions</a>, <a href="https://docs.github.com/en/codespaces/managing-your-codespaces/managing-secrets-for-your-codespaces" target="_blank" rel="noopener noreferrer">Codespaces</a> and/or <a href="https://docs.github.com/en/code-security/dependabot/working-with-dependabot" target="_blank" rel="noopener noreferrer">Dependabot</a> environment variables</li>
</ul>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</div><div class="admonitionContent_BuS1"><p>This is not an exhaustive list. Check with other engineers and/or SRE if you are unsure of all of the locations where a secret may be kept.</p></div></div>
<p>In our example case, after scanning all three above locations, application config was the sole place where the leaked Stripe API key was used.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="clean-up-the-mess-if-applicable">Clean up the mess (if applicable)<a href="#clean-up-the-mess-if-applicable" class="hash-link" aria-label="Direct link to Clean up the mess (if applicable)" title="Direct link to Clean up the mess (if applicable)">​</a></h2>
<p>If the leak was for a valid secret in use in production, it may have been exploited. Based on the risk profile for the secret identified above (see &quot;What <em>can</em> it be used for?&quot; when <a href="#confirm-the-leak-and-its-severity">confirming the leak</a>), review monitoring tools like Grafana, Sentry and application logs in BigQuery for any indications of exploitation.</p>
<p>The work involved here will vary depending on many factors. It could involve correcting/updating database records, placing new limits or access restrictions on certain resources and/or notifying affected end users.</p>
<p>Work with the team to determine what all needs to be done, whether or not the leak rises to the level of an <a href="https://mozilla-hub.atlassian.net/wiki/spaces/MIR/overview" target="_blank" rel="noopener noreferrer">incident</a>, and follow those procedures accordingly.</p>
<p>Take a moment to document the leak and the fix in the form of a ticket if one was not yet created, and update the ticket with what was done before closing it out. File any follow-up tickets as necessary and ensure they are triaged in a timely manner.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="mitigating-leaks-and-risks">Mitigating leaks and risks<a href="#mitigating-leaks-and-risks" class="hash-link" aria-label="Direct link to Mitigating leaks and risks" title="Direct link to Mitigating leaks and risks">​</a></h2>
<ul>
<li>Never post or commit sensitive data to public repos or other public or semi-public forums.</li>
<li>Use secure methods to share secrets with team members. See Mozilla&#x27;s <a href="https://mozilla-hub.atlassian.net/wiki/spaces/SECENGOPS/pages/378273870/How+to+share+a+secret+with+coworkers" target="_blank" rel="noopener noreferrer">recommended guidance for sharing secrets</a>.</li>
<li>Restrict API keys to only the privileges needed for the task at hand and nothing more. For example, you can create <a href="https://stripe.com/docs/keys#limit-access" target="_blank" rel="noopener noreferrer">restricted keys</a> for Stripe that only permit read/write access to specific APIs.</li>
<li>For public GitHub repositories, regularly review GitHub&#x27;s <a href="https://docs.github.com/en/code-security/secret-scanning" target="_blank" rel="noopener noreferrer">secret scanning alerts</a> and resolve them in a timely manner.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="additional-reading">Additional reading<a href="#additional-reading" class="hash-link" aria-label="Direct link to Additional reading" title="Direct link to Additional reading">​</a></h3>
<ul>
<li><a href="https://mozilla-hub.atlassian.net/wiki/spaces/SRE/pages/27924750/Secrets+Management" target="_blank" rel="noopener noreferrer">SRE docs on secrets management</a></li>
</ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/mozilla/ecosystem-platform/edit/master/docs/how-tos/rotating-secrets.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/ecosystem-platform/how-tos/working-with-metrics"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Working with Metrics</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/ecosystem-platform/reference/team-processes/development-process"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Planning and Development</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#find-or-be-informed-about-the-potential-leak" class="table-of-contents__link toc-highlight">Find or be informed about the (potential) leak</a></li><li><a href="#confirm-the-leak-and-its-severity" class="table-of-contents__link toc-highlight">Confirm the leak and its severity</a></li><li><a href="#fix-the-leak" class="table-of-contents__link toc-highlight">Fix the leak</a></li><li><a href="#rotate-the-secret-if-valid" class="table-of-contents__link toc-highlight">Rotate the secret (if valid)</a><ul><li><a href="#places-to-check-where-a-secret-might-be-used" class="table-of-contents__link toc-highlight">Places to check where a secret might be used</a></li></ul></li><li><a href="#clean-up-the-mess-if-applicable" class="table-of-contents__link toc-highlight">Clean up the mess (if applicable)</a></li><li><a href="#mitigating-leaks-and-risks" class="table-of-contents__link toc-highlight">Mitigating leaks and risks</a><ul><li><a href="#additional-reading" class="table-of-contents__link toc-highlight">Additional reading</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 Mozilla Corporation.</div></div></div></footer></div>
</body>
</html>