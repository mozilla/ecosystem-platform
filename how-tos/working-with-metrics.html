<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-how-tos/working-with-metrics" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.0.1">
<title data-rh="true">Working with Metrics | Firefox Ecosystem Platform</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://mozilla.github.io/ecosystem-platform/how-tos/working-with-metrics"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Working with Metrics | Firefox Ecosystem Platform"><meta data-rh="true" name="description" content="Last updated: May 21st, 2024"><meta data-rh="true" property="og:description" content="Last updated: May 21st, 2024"><link data-rh="true" rel="icon" href="/ecosystem-platform/img/firefox-logo.png"><link data-rh="true" rel="canonical" href="https://mozilla.github.io/ecosystem-platform/how-tos/working-with-metrics"><link data-rh="true" rel="alternate" href="https://mozilla.github.io/ecosystem-platform/how-tos/working-with-metrics" hreflang="en"><link data-rh="true" rel="alternate" href="https://mozilla.github.io/ecosystem-platform/how-tos/working-with-metrics" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://RFM5H13DFK-dsn.algolia.net" crossorigin="anonymous"><link rel="search" type="application/opensearchdescription+xml" title="Firefox Ecosystem Platform" href="/ecosystem-platform/opensearch.xml"><link rel="stylesheet" href="/ecosystem-platform/assets/css/styles.e5583d03.css">
<script src="/ecosystem-platform/assets/js/runtime~main.23e23d83.js" defer="defer"></script>
<script src="/ecosystem-platform/assets/js/main.d15f1ff4.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();null!==e?t(e):window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,t("light"))}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/ecosystem-platform/"><div class="navbar__logo"><img src="/ecosystem-platform/img/firefox-logo.png" alt="Ecosystem Platform Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/ecosystem-platform/img/firefox-logo.png" alt="Ecosystem Platform Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Firefox Ecosystem Platform</b></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/mozilla/ecosystem-platform" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/ecosystem-platform/">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link">For Relying Parties</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/ecosystem-platform/relying-parties/tutorials/integration-with-fxa">Tutorials</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/ecosystem-platform/relying-parties/how-tos/end-to-end-encryption">How-to Guides</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/ecosystem-platform/relying-parties/reference/integration-requirements">Reference</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--active">For FxA Engineers</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/ecosystem-platform/tutorials/development-setup">Tutorials</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/ecosystem-platform/how-tos/ci-guidelines">How-to Guides</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/how-tos/ci-guidelines">CI Guidelines</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/how-tos/connecting-to-a-local-mysql-db">Connecting to a local MySQL DB</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/how-tos/creating-an-account-locally">Creating an Account Locally</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/how-tos/local-emails-with-maildev">Local Emails with MailDev</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/how-tos/managing-yarn-dependencies">Managing Yarn Dependencies</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/how-tos/node-debugging">Node Debugging</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/how-tos/using-a-custom-profile-with-firefox">Using a Custom Profile with Firefox</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/how-tos/using-sentry-locally">Using Sentry.io for Local Development</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/how-tos/using-swagger-for-api-documentation">Using Swagger for API documentation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/how-tos/using-tracing-in-gcp">Tracing for Stage/Prod</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/how-tos/using-tracing-locally">Tracing for Local Development</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/how-tos/using-vscode-with-fxa">Using VS Code with FxA</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/ecosystem-platform/how-tos/working-with-metrics">Working with Metrics</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/how-tos/rotating-secrets">Rotating Secrets</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/ecosystem-platform/reference/team-processes/development-process">Reference</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/ecosystem-platform/explanation/architectural-decision-records">Explanation</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/additional-docs">Additional Docs</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link">For Support Agents</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/ecosystem-platform/reference/admin-panel">Reference</a></div></li></ul></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/ecosystem-platform/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">For FxA Engineers</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">How-to Guides</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Working with Metrics</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><p>Last updated: <code>May 21st, 2024</code></p>
<p>Other relevant documents include our <a href="/ecosystem-platform/reference/metrics">metrics reference</a> and <a href="/ecosystem-platform/explanation/metrics">metrics explanation</a>.</p>
<p>In Spring 2023, FxA began its migration to use Mozilla&#x27;s <a href="https://mozilla.github.io/glean/book/" target="_blank" rel="noopener noreferrer">Glean</a> for metrics.  At the time of writing, it is still ongoing.  Here you&#x27;ll find the Glean related content at the top; information on older metric event types can be found at the bottom.</p>
<h1>How do I...</h1>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="find-documentation-on-glean">...find documentation on Glean?<a href="#find-documentation-on-glean" class="hash-link" aria-label="Direct link to ...find documentation on Glean?" title="Direct link to ...find documentation on Glean?">​</a></h2>
<p><a href="https://mozilla.github.io/glean/book/" target="_blank" rel="noopener noreferrer">The Glean book</a> is very good.  We use <a href="https://github.com/mozilla/glean.js" target="_blank" rel="noopener noreferrer">Glean.js</a> in FxA.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="enable-glean-in-my-local-development-environment">...enable Glean in my local development environment?<a href="#enable-glean-in-my-local-development-environment" class="hash-link" aria-label="Direct link to ...enable Glean in my local development environment?" title="Direct link to ...enable Glean in my local development environment?">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="auth-server">Auth server<a href="#auth-server" class="hash-link" aria-label="Direct link to Auth server" title="Direct link to Auth server">​</a></h3>
<p>Set the env var <code>AUTH_GLEAN_ENABLED</code> to true.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="content-server--settings">Content server / Settings<a href="#content-server--settings" class="hash-link" aria-label="Direct link to Content server / Settings" title="Direct link to Content server / Settings">​</a></h3>
<ol start="0">
<li>Set the env var <code>GLEAN_ENABLED</code> to true.</li>
<li>Use <code>GLEAN_UPLOAD_ENABLED</code>, with a value of true or false, to toggle the <a href="https://mozilla.github.io/glean/book/reference/general/toggling-upload-status.html" target="_blank" rel="noopener noreferrer">upload status</a>.</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="add-more-glean-events">...add more Glean events?<a href="#add-more-glean-events" class="hash-link" aria-label="Direct link to ...add more Glean events?" title="Direct link to ...add more Glean events?">​</a></h2>
<p>Initially FxA used a string metric for the event name, so adding an &quot;event&quot; merely involved a new string.  At the time of writing, we are migrating to Glean&#x27;s event metric type.  To add a new event now, we need to declare it in the appropriate YAML.</p>
<p>For event specific properties, we have a <code>event.reason</code> string metric to capture some additional, <code>event.name</code>-specific information.  Moving forward, we should use the <a href="https://mozilla.github.io/glean/book/reference/metrics/event.html#extra-metric-parameters" target="_blank" rel="noopener noreferrer"><code>extra_keys</code></a> in the event for these event properties.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="auth-server-1">Auth server<a href="#auth-server-1" class="hash-link" aria-label="Direct link to Auth server" title="Direct link to Auth server">​</a></h3>
<ol start="0">
<li>Update the YAML in <code>packages/fxa-shared/metrics/glean/fxa-backend-metrics.yaml</code>.</li>
<li>Run <code>yarn glean-generate</code> from <code>packages/fxa-auth-server</code>.</li>
<li>Update <code>gleanMetrics</code> in <code>packages/fxa-auth-server/lib/metrics/glean/index.ts</code> to add the event.  Ensure that you call the <code>record*</code> method on the new event by adding another case in the big switch statement in <code>createEventFn</code>.</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="content-server">Content server<a href="#content-server" class="hash-link" aria-label="Direct link to Content server" title="Direct link to Content server">​</a></h3>
<ol start="0">
<li>Update the YAML in <code>packages/fxa-shared/metrics/glean/fxa-ui-metrics.yaml</code>.</li>
<li>Run <code>yarn glean-generate</code> from <code>packages/fxa-content-server</code>.</li>
<li>Update <code>GleanMetrics</code> in <code>packages/fxa-content-server/app/scripts/lib/glean/index.ts</code> so its API exposes a function for the event.  Also ensure that you add the new event to the switch statement in <code>recordEventMetric</code>.</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="settings">Settings<a href="#settings" class="hash-link" aria-label="Direct link to Settings" title="Direct link to Settings">​</a></h3>
<ol start="0">
<li>Update the YAML in <code>packages/fxa-shared/metrics/glean/fxa-ui-metrics.yaml</code>.</li>
<li>Run <code>yarn glean-generate</code> from <code>packages/fxa-shared</code>.</li>
<li>Add the event to <code>eventsMap</code> in <code>packages/fxa-shared/metrics/glean/web/index.ts</code>.</li>
<li>Update <code>recordEventMetric</code> in <code>packages/fxa-settings/src/lib/glean/index.ts</code> to include the new event in the switch statement.</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="view-the-glean-pings-while-debugging">...view the Glean pings while debugging?<a href="#view-the-glean-pings-while-debugging" class="hash-link" aria-label="Direct link to ...view the Glean pings while debugging?" title="Direct link to ...view the Glean pings while debugging?">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="auth-server-2">Auth server<a href="#auth-server-2" class="hash-link" aria-label="Direct link to Auth server" title="Direct link to Auth server">​</a></h3>
<p>Grep for <code>glean-server-event</code> in <code>auth-out.log</code>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="content-server--settings-1">Content server / Settings<a href="#content-server--settings-1" class="hash-link" aria-label="Direct link to Content server / Settings" title="Direct link to Content server / Settings">​</a></h3>
<ol start="0">
<li>Set <code>GLEAN_LOG_PINGS</code> to true to see the pings in the page&#x27;s JS console.</li>
<li>Set <code>GLEAN_DEBUG_VIEW_TAG</code> to some string to see the pings in the <a href="https://debug-ping-preview.firebaseapp.com/" target="_blank" rel="noopener noreferrer">Debug Ping Viewer</a>.  For example, if you set a value of &#x27;bchen-local-dev&#x27;, then you can view the pings at <a href="https://debug-ping-preview.firebaseapp.com/pings/bchen-local-dev" target="_blank" rel="noopener noreferrer">https://debug-ping-preview.firebaseapp.com/pings/bchen-local-dev</a>.</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="create-a-new-activity-event">...create a new activity event?<a href="#create-a-new-activity-event" class="hash-link" aria-label="Direct link to ...create a new activity event?" title="Direct link to ...create a new activity event?">​</a></h2>
<ol start="0">
<li>Add the event name to <code>ACTIVITY_EVENTS</code> in <code>lib/metrics/events.js</code>. Unless it’s also a flow event (most new events will be one or the other), you should also add it to <code>NOT_FLOW_EVENTS</code> in the same module.</li>
<li>Emit the new event in code like <code>request.emitMetricsEvent(&#x27;foo.bar&#x27;, { uid })</code>.</li>
<li>Wherever you emit it, add test cases to cover that the event is correctly logged.</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="create-a-new-flow-event">...create a new flow event?<a href="#create-a-new-flow-event" class="hash-link" aria-label="Direct link to ...create a new flow event?" title="Direct link to ...create a new flow event?">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="auth-server-3">Auth server<a href="#auth-server-3" class="hash-link" aria-label="Direct link to Auth server" title="Direct link to Auth server">​</a></h3>
<ol start="0">
<li>Emit the new event in code like <code>request.emitMetricsEvent(&#x27;foo.bar&#x27;)</code>.</li>
<li>Wherever you emit it, add test cases to cover that the event is correctly logged.</li>
<li>Be aware that flow events are only emitted if you have a <code>metricsContext</code>. If there’s one in the payload for the current route, you’re all good. If not, the code will try to read one from Redis for you. But a previous call to <code>request.stashMetricsContext</code> or <code>request.propagateMetricsContext</code> will need to have been made with the token that your request is authenticated by. Maybe that’s done already, maybe it isn’t, you’ll need to trace the request flow and grep the code.</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="content-server-1">Content server<a href="#content-server-1" class="hash-link" aria-label="Direct link to Content server" title="Direct link to Content server">​</a></h3>
<ol start="0">
<li>On the front-end, make sure your view has mixed in <code>FlowEventsMixin</code>.</li>
<li>view and engage events will be emitted automatically when you add the mixin, for other events you need to call <code>this.logFlowEvent</code> from your view.</li>
<li>Add test coverage for the new event to your view unit tests.</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="create-a-new-email-event">...create a new email event?<a href="#create-a-new-email-event" class="hash-link" aria-label="Direct link to ...create a new email event?" title="Direct link to ...create a new email event?">​</a></h2>
<p>You don’t need to do this, it’s all set up to work automatically.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="create-a-new-amplitude-event">...create a new Amplitude event?<a href="#create-a-new-amplitude-event" class="hash-link" aria-label="Direct link to ...create a new Amplitude event?" title="Direct link to ...create a new Amplitude event?">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="auth-server-4">Auth server<a href="#auth-server-4" class="hash-link" aria-label="Direct link to Auth server" title="Direct link to Auth server">​</a></h3>
<ol start="0">
<li>Amplitude events are all triggered by activity or flow events, so the first step is to ensure there’s one of those (see above if you need to create a new one).</li>
<li>If you’re triggering from a specific event, add a new mapping to the <code>EVENTS</code> object in <code>lib/metrics/amplitude.js</code>. If you’re triggering from a set of events, add a mapping to <code>FUZZY_EVENTS</code> instead.</li>
<li>Add a new test case for the new event to <code>test/local/metrics/amplitude.js</code>. Every event should have its own test case in that module.</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="content-server-2">Content server<a href="#content-server-2" class="hash-link" aria-label="Direct link to Content server" title="Direct link to Content server">​</a></h3>
<ol start="0">
<li>Amplitude events are all triggered by flow or screen events, so the first step is to ensure there’s one of those (see above if you need to create a new flow event).</li>
<li>If you’re triggering from a specific event, add a new mapping to the <code>EVENTS</code> object in <code>server/lib/amplitude.js</code>. If you’re triggering from a set of events, add a mapping to <code>FUZZY_EVENTS</code> instead.</li>
<li>Add a new test case for the new event to <code>tests/server/amplitude.js</code>. Every event should have its own test case in that module.</li>
</ol></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/mozilla/ecosystem-platform/edit/master/docs/how-tos/working-with-metrics.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/ecosystem-platform/how-tos/using-vscode-with-fxa"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Using VS Code with FxA</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/ecosystem-platform/how-tos/rotating-secrets"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Rotating Secrets</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#find-documentation-on-glean" class="table-of-contents__link toc-highlight">...find documentation on Glean?</a></li><li><a href="#enable-glean-in-my-local-development-environment" class="table-of-contents__link toc-highlight">...enable Glean in my local development environment?</a><ul><li><a href="#auth-server" class="table-of-contents__link toc-highlight">Auth server</a></li><li><a href="#content-server--settings" class="table-of-contents__link toc-highlight">Content server / Settings</a></li></ul></li><li><a href="#add-more-glean-events" class="table-of-contents__link toc-highlight">...add more Glean events?</a><ul><li><a href="#auth-server-1" class="table-of-contents__link toc-highlight">Auth server</a></li><li><a href="#content-server" class="table-of-contents__link toc-highlight">Content server</a></li><li><a href="#settings" class="table-of-contents__link toc-highlight">Settings</a></li></ul></li><li><a href="#view-the-glean-pings-while-debugging" class="table-of-contents__link toc-highlight">...view the Glean pings while debugging?</a><ul><li><a href="#auth-server-2" class="table-of-contents__link toc-highlight">Auth server</a></li><li><a href="#content-server--settings-1" class="table-of-contents__link toc-highlight">Content server / Settings</a></li></ul></li><li><a href="#create-a-new-activity-event" class="table-of-contents__link toc-highlight">...create a new activity event?</a></li><li><a href="#create-a-new-flow-event" class="table-of-contents__link toc-highlight">...create a new flow event?</a><ul><li><a href="#auth-server-3" class="table-of-contents__link toc-highlight">Auth server</a></li><li><a href="#content-server-1" class="table-of-contents__link toc-highlight">Content server</a></li></ul></li><li><a href="#create-a-new-email-event" class="table-of-contents__link toc-highlight">...create a new email event?</a></li><li><a href="#create-a-new-amplitude-event" class="table-of-contents__link toc-highlight">...create a new Amplitude event?</a><ul><li><a href="#auth-server-4" class="table-of-contents__link toc-highlight">Auth server</a></li><li><a href="#content-server-2" class="table-of-contents__link toc-highlight">Content server</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 Mozilla Corporation.</div></div></div></footer></div>
</body>
</html>