"use strict";(self.webpackChunkfirefox_ecosystem_platform=self.webpackChunkfirefox_ecosystem_platform||[]).push([[8745],{16761:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>o,metadata:()=>r,toc:()=>l});const r=JSON.parse('{"id":"relying-parties/reference/integration-requirements","title":"Requirements for Integration","description":"Last updated: June 8th, 2023","source":"@site/docs/relying-parties/reference/integration-requirements.md","sourceDirName":"relying-parties/reference","slug":"/relying-parties/reference/integration-requirements","permalink":"/ecosystem-platform/relying-parties/reference/integration-requirements","draft":false,"unlisted":false,"editUrl":"https://github.com/mozilla/ecosystem-platform/edit/master/docs/relying-parties/reference/integration-requirements.md","tags":[],"version":"current","frontMatter":{"title":"Requirements for Integration","sidebar_label":"Integration Requirements"},"sidebar":"docs","previous":{"title":"Glossary","permalink":"/ecosystem-platform/relying-parties/reference/glossary"},"next":{"title":"Metrics","permalink":"/ecosystem-platform/relying-parties/reference/metrics-for-relying-parties"}}');var i=n(74848),s=n(28453);const o={title:"Requirements for Integration",sidebar_label:"Integration Requirements"},a=void 0,c={},l=[{value:"Maintain a point of contact",id:"maintain-a-point-of-contact",level:2},{value:"Subscribe to and process events",id:"subscribe-to-and-process-events",level:2},{value:"Respect API backoff headers",id:"respect-api-backoff-headers",level:2},{value:"Practice Good User Data Hygiene",id:"practice-good-user-data-hygiene",level:2},{value:"Self Hosted Login Flow",id:"self-hosted-login-flow",level:2}];function d(e){const t={a:"a",code:"code",h2:"h2",li:"li",ol:"ol",p:"p",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(t.p,{children:["Last updated: ",(0,i.jsx)(t.code,{children:"June 8th, 2023"})]}),"\n",(0,i.jsx)(t.h2,{id:"maintain-a-point-of-contact",children:"Maintain a point of contact"}),"\n",(0,i.jsxs)(t.p,{children:["We communicate with our relying parties via the ",(0,i.jsx)(t.a,{href:"https://groups.google.com/a/mozilla.com/g/firefox-accounts-notices",children:"firefox-accounts-notices group"}),".  You must subscribe to this list."]}),"\n",(0,i.jsx)(t.h2,{id:"subscribe-to-and-process-events",children:"Subscribe to and process events"}),"\n",(0,i.jsxs)(t.p,{children:["Mozilla accounts maintains an ",(0,i.jsx)(t.a,{href:"/relying-parties/tutorials/integration-with-fxa#webhook-events",children:"event broker which is a webhook delivery system to communicate with relying parties"}),".  You must ",(0,i.jsx)(t.a,{href:"/relying-parties/tutorials/integration-with-fxa#register-for-webhooks",children:"register an endpoint to receive events"}),".  You will receive events you may or may not care about but some events require you to perform actions:"]}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"A user opts out of metrics"})," (the ",(0,i.jsx)(t.code,{children:"metricsEnabled"})," boolean in the profile):  When this is ",(0,i.jsx)(t.code,{children:"false"})," you must not collect any metrics tied to the user.  Any existing metrics should be deleted.  This boolean should be checked each time a profile is requested."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"A user deletes their account"})," (event ",(0,i.jsx)(t.code,{children:"https://schemas.accounts.firefox.com/event/delete-user"}),"):  The relying party must delete all user records for the deleted user."]}),"\n"]}),"\n",(0,i.jsx)(t.h2,{id:"respect-api-backoff-headers",children:"Respect API backoff headers"}),"\n",(0,i.jsxs)(t.p,{children:["Please see ",(0,i.jsx)(t.a,{href:"/relying-parties/reference/using-apis",children:"this section on rate limits"}),"."]}),"\n",(0,i.jsx)(t.h2,{id:"practice-good-user-data-hygiene",children:"Practice Good User Data Hygiene"}),"\n",(0,i.jsxs)(t.ol,{start:"0",children:["\n",(0,i.jsx)(t.li,{children:"Accounts should use uid rather than email address as the primary key. An account\u2019s primary email address can change."}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.a,{href:"https://github.com/mozilla/fxa/tree/main/packages/fxa-event-broker#profile-change",children:"Primary email changed notifications"})," should update the contact email stored with the account."]}),"\n",(0,i.jsx)(t.li,{children:"Profile information should not be shared with 3rd parties without explicit consent."}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.a,{href:"/api#tag/Oauth/operation/postOauthDestroy",children:"Destroy any outstanding access tokens and refresh tokens"})," whenever a user signals their session or account should be terminated, e.g., the user signs out of your site, closes their account on your site, or unsubscribes from all functionality."]}),"\n"]}),"\n",(0,i.jsx)(t.h2,{id:"self-hosted-login-flow",children:"Self Hosted Login Flow"}),"\n",(0,i.jsx)(t.p,{children:"If you're hosting your own login page you need to send top-of-funnel metrics to FxA:"}),"\n",(0,i.jsxs)(t.ol,{start:"0",children:["\n",(0,i.jsxs)(t.li,{children:["Initialize top of funnel metrics by calling [/metrics-flow request][metrics-flow-request] with the required query parameters:","\n",(0,i.jsxs)(t.ol,{children:["\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"entrypoint"})," This is a string identifying the source of the request and should be agreed upon by the Mozilla accounts team."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"form_type"})," This is either ",(0,i.jsx)(t.code,{children:"email"})," (you have an input on your form for an email address) or ",(0,i.jsx)(t.code,{children:"button"})," (you just have a 'sign in' button)"]}),"\n",(0,i.jsx)(t.li,{children:(0,i.jsx)(t.code,{children:"utm_source"})}),"\n",(0,i.jsx)(t.li,{children:(0,i.jsx)(t.code,{children:"utm_campaign"})}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["Propagate the ",(0,i.jsx)(t.code,{children:"email"}),", ",(0,i.jsx)(t.code,{children:"flow_id"})," and ",(0,i.jsx)(t.code,{children:"flow_begin_time"})," query parameters, which are returned from the [/metrics-flow request][metrics-flow-request], in the request to ",(0,i.jsx)(t.code,{children:"/authentication"}),"."]}),"\n"]}),"\n",(0,i.jsx)(t.p,{children:"To test without CORS errors your test application must have one of the following URLs:"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:(0,i.jsx)(t.a,{href:"http://127.0.0.1:8001",children:"http://127.0.0.1:8001"})}),"\n",(0,i.jsx)(t.li,{children:(0,i.jsx)(t.a,{href:"http://localhost:8000",children:"http://localhost:8000"})}),"\n",(0,i.jsx)(t.li,{children:(0,i.jsx)(t.a,{href:"http://127.0.0.1:8000",children:"http://127.0.0.1:8000"})}),"\n",(0,i.jsxs)(t.li,{children:["Or be in the ",(0,i.jsx)(t.code,{children:"ALLOWED_METRICS_FLOW_ORIGINS"})," list (used for production entities)"]}),"\n"]})]})}function h(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},28453:(e,t,n)=>{n.d(t,{R:()=>o,x:()=>a});var r=n(96540);const i={},s=r.createContext(i);function o(e){const t=r.useContext(s);return r.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),r.createElement(s.Provider,{value:t},e.children)}}}]);