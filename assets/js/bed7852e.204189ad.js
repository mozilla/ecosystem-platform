"use strict";(self.webpackChunkfirefox_ecosystem_platform=self.webpackChunkfirefox_ecosystem_platform||[]).push([[3269],{28453:(e,n,i)=>{i.d(n,{R:()=>o,x:()=>l});var s=i(96540);const r={},t=s.createContext(r);function o(e){const n=s.useContext(t);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),s.createElement(t.Provider,{value:n},e.children)}},86783:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>h,frontMatter:()=>o,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"explanation/cms-strapi-l10n","title":"Mozilla Accounts Localization Workflow","description":"Last updated: Aug 25th, 2025","source":"@site/docs/explanation/cms-strapi-l10n.md","sourceDirName":"explanation","slug":"/explanation/cms-strapi-l10n","permalink":"/ecosystem-platform/explanation/cms-strapi-l10n","draft":false,"unlisted":false,"editUrl":"https://github.com/mozilla/ecosystem-platform/edit/master/docs/explanation/cms-strapi-l10n.md","tags":[],"version":"current","frontMatter":{"title":"Mozilla Accounts Localization Workflow"},"sidebar":"docs","previous":{"title":"Scoped Keys","permalink":"/ecosystem-platform/explanation/scoped-keys"},"next":{"title":"Additional Docs","permalink":"/ecosystem-platform/additional-docs"}}');var r=i(74848),t=i(28453);const o={title:"Mozilla Accounts Localization Workflow"},l=void 0,a={},c=[{value:"Overview",id:"overview",level:2},{value:"Architecture Components",id:"architecture-components",level:2},{value:"Core Components",id:"core-components",level:3},{value:"Workflow Diagram",id:"workflow-diagram",level:2},{value:"Detailed Workflow Steps",id:"detailed-workflow-steps",level:2},{value:"1. Content Creation and Publishing",id:"1-content-creation-and-publishing",level:3},{value:"2. Webhook Processing and FTL Generation",id:"2-webhook-processing-and-ftl-generation",level:3},{value:"Webhook Validation",id:"webhook-validation",level:4},{value:"FTL Generation Process",id:"ftl-generation-process",level:4},{value:"FTL Format Example",id:"ftl-format-example",level:4},{value:"3. GitHub Integration and PR Management",id:"3-github-integration-and-pr-management",level:3},{value:"PR Creation Process",id:"pr-creation-process",level:4},{value:"PR Update Process",id:"pr-update-process",level:4},{value:"4. Human Review and Approval",id:"4-human-review-and-approval",level:3},{value:"5. Pontoon Integration",id:"5-pontoon-integration",level:3},{value:"6. Runtime Localization and Caching",id:"6-runtime-localization-and-caching",level:3},{value:"Caching Strategy",id:"caching-strategy",level:4},{value:"Cache Configuration",id:"cache-configuration",level:4},{value:"Localization Request Flow",id:"localization-request-flow",level:4},{value:"FTL URL Template",id:"ftl-url-template",level:4},{value:"Error Handling and Fallbacks",id:"error-handling-and-fallbacks",level:2},{value:"Webhook Processing Errors",id:"webhook-processing-errors",level:3},{value:"Runtime Localization Errors",id:"runtime-localization-errors",level:3},{value:"Fallback Strategy",id:"fallback-strategy",level:3},{value:"Configuration",id:"configuration",level:2},{value:"Environment Variables",id:"environment-variables",level:3},{value:"Service Configuration",id:"service-configuration",level:3},{value:"Key File Locations",id:"key-file-locations",level:2},{value:"Backend Components",id:"backend-components",level:3},{value:"Frontend Components",id:"frontend-components",level:3},{value:"L10n Scripts",id:"l10n-scripts",level:3},{value:"Monitoring and Metrics",id:"monitoring-and-metrics",level:2},{value:"StatsD Metrics",id:"statsd-metrics",level:3},{value:"Logging",id:"logging",level:3},{value:"Testing Localization",id:"testing-localization",level:3},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Common Issues",id:"common-issues",level:3}];function d(e){const n={code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(n.p,{children:["Last updated: ",(0,r.jsx)(n.code,{children:"Aug 25th, 2025"})]}),"\n",(0,r.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,r.jsx)(n.p,{children:"This document describes the complete localization workflow for Mozilla Accounts (FxA), covering how content changes in Strapi CMS trigger automated localization processes, and how localized content is delivered to users at runtime."}),"\n",(0,r.jsx)(n.p,{children:"The Mozilla Accounts localization system enables dynamic, localized user experiences by integrating Strapi CMS, GitHub, Pontoon, and runtime content delivery. The workflow ensures that content changes are automatically processed for localization and efficiently delivered to users with proper caching and error handling."}),"\n",(0,r.jsx)(n.h2,{id:"architecture-components",children:"Architecture Components"}),"\n",(0,r.jsx)(n.h3,{id:"core-components",children:"Core Components"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Strapi CMS"}),": Headless CMS for managing relying party configurations"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"fxa-auth-server"})," (",(0,r.jsx)(n.code,{children:"cms.ts"}),"): API layer handling CMS requests and webhook processing"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"fxa-shared"})," (",(0,r.jsx)(n.code,{children:"relying-party-configuration-manager.ts"}),"): Configuration management with caching"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"fxa-settings"})," (",(0,r.jsx)(n.code,{children:"getCmsInfo"}),"): Frontend integration for localized content"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"GitHub"}),": Version control and FTL file storage"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Pontoon"}),": Mozilla's localization platform"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"FTL (Fluent Translation List)"}),": Localization file format"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"workflow-diagram",children:"Workflow Diagram"}),"\n",(0,r.jsx)(n.mermaid,{value:'graph TB\n    subgraph "Content Management"\n        A[Strapi CMS] --\x3e B[Content Editor Creates/Updates Content]\n        B --\x3e C[Content Published]\n    end\n\n    subgraph "Webhook Processing"\n        C --\x3e D[Strapi Webhook Triggered]\n        D --\x3e E[fxa-auth-server /cms/webhook/strapil10n]\n        E --\x3e F[Validate Webhook Authorization]\n        F --\x3e G[Fetch All Strapi Entries]\n        G --\x3e H[Generate FTL Content]\n        H --\x3e I{Existing PR?}\n        I --\x3e|Yes| J[Update Existing PR]\n        I --\x3e|No| K[Create New GitHub PR]\n        J --\x3e L[PR Ready for Review]\n        K --\x3e L\n    end\n\n    subgraph "Human Review & Integration"\n        L --\x3e M[Human Reviews PR]\n        M --\x3e N[PR Approved & Merged]\n        N --\x3e O[FTL Files in main branch]\n    end\n\n    subgraph "Pontoon Localization"\n        O --\x3e P[Pontoon Detects New FTL Files]\n        P --\x3e Q[Translators Work on Localization]\n        Q --\x3e R[Translations Submitted]\n        R --\x3e S[Pontoon Merges Translations Back to Git]\n    end\n\n    subgraph "Runtime Content Delivery"\n        T[Client Requests Localized Config] --\x3e U[fxa-auth-server /cms/config]\n        U --\x3e V[RelyingPartyConfigurationManager]\n        V --\x3e W[Fetch Base Config from Strapi]\n        W --\x3e X{Locale = \'en\'?}\n        X --\x3e|Yes| Y[Return Base Config]\n        X --\x3e|No| Z[Fetch FTL from GitHub Raw URL]\n        Z --\x3e AA[Memory Cache Check]\n        AA --\x3e|Hit| BB[Return Cached Content]\n        AA --\x3e|Miss| CC[Firestore Cache Check]\n        CC --\x3e|Hit| DD[Return Cached Content]\n        CC --\x3e|Miss| EE[Fetch from GitHub]\n        EE --\x3e FF[Cache in Memory & Firestore]\n        FF --\x3e GG[Parse FTL Content]\n        GG --\x3e HH[Merge with Base Config]\n        HH --\x3e II[Return Localized Config]\n        Y --\x3e JJ[Client Receives Config]\n        BB --\x3e GG\n        DD --\x3e GG\n        II --\x3e JJ\n    end\n\n    S --\x3e Z'}),"\n",(0,r.jsx)(n.h2,{id:"detailed-workflow-steps",children:"Detailed Workflow Steps"}),"\n",(0,r.jsx)(n.h3,{id:"1-content-creation-and-publishing",children:"1. Content Creation and Publishing"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Location"}),": Strapi CMS\n",(0,r.jsx)(n.strong,{children:"Participants"}),": Content editors, marketing teams"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Content creators log into Strapi CMS"}),"\n",(0,r.jsx)(n.li,{children:"Create or modify relying party configurations"}),"\n",(0,r.jsx)(n.li,{children:"Content includes localizable fields like headlines, descriptions, button text"}),"\n",(0,r.jsx)(n.li,{children:"Content is published, triggering the webhook system"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"2-webhook-processing-and-ftl-generation",children:"2. Webhook Processing and FTL Generation"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Location"}),": ",(0,r.jsx)(n.code,{children:"packages/fxa-auth-server/lib/routes/cms.ts:178-297"}),"\n",(0,r.jsx)(n.strong,{children:"Participants"}),": Webhook handler, GitHub API"]}),"\n",(0,r.jsx)(n.h4,{id:"webhook-validation",children:"Webhook Validation"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"// Webhook authorization is verified using timing-safe comparison\nconst authHeader = request.headers.authorization;\nif (!crypto.timingSafeEqual(\n  Buffer.from(authHeader),\n  Buffer.from(this.config.cmsl10n.strapiWebhook.secret)\n)) {\n  throw new Error('Invalid authorization header');\n}\n"})}),"\n",(0,r.jsx)(n.h4,{id:"ftl-generation-process",children:"FTL Generation Process"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Location"}),": ",(0,r.jsx)(n.code,{children:"packages/fxa-auth-server/lib/routes/utils/cms/localization.ts:110-192"})]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Fetch All Entries"}),": Query Strapi for all published relying party entries"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Extract Localizable Content"}),": Filter out non-localizable fields (IDs, dates, URLs, colors)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Generate FTL Format"}),": Convert extracted strings to Fluent format with unique identifiers"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Create GitHub PR"}),": Either update existing PR or create new branch and PR"]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"ftl-format-example",children:"FTL Format Example"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ftl",children:"### Generated on 2024-01-15T10:30:00.000Z\n### FTL file for CMS localization\n\n## sync-signin - Firefox Sync Sign In\n# Headline for Sign In Page\nsync-signin-headline-a1b2c3d4 = Sign in to sync your data\n# Primary Button Text for Sign In Page\nsync-signin-primary-button-text-e5f6g7h8 = Continue\n"})}),"\n",(0,r.jsx)(n.h3,{id:"3-github-integration-and-pr-management",children:"3. GitHub Integration and PR Management"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Location"}),": ",(0,r.jsx)(n.code,{children:"packages/fxa-auth-server/lib/routes/utils/cms/localization.ts:495-604"})]}),"\n",(0,r.jsx)(n.h4,{id:"pr-creation-process",children:"PR Creation Process"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Branch Creation"}),": Create timestamped branch ",(0,r.jsx)(n.code,{children:"cms-localization-{timestamp}"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"File Creation"}),": Add/update ",(0,r.jsx)(n.code,{children:"locales/en/cms.ftl"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"PR Creation"}),": Create PR with detailed description including:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Webhook event details"}),"\n",(0,r.jsx)(n.li,{children:"Entry count processed"}),"\n",(0,r.jsx)(n.li,{children:"Generation timestamp"}),"\n",(0,r.jsx)(n.li,{children:"Source information"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"pr-update-process",children:"PR Update Process"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Existing PR Detection"}),": Search for open PRs with CMS localization titles"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Content Update"}),": Update FTL file in existing branch"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Metadata Preservation"}),": Maintain PR context and approval history"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"4-human-review-and-approval",children:"4. Human Review and Approval"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Participants"}),": Development team, localization coordinators\n",(0,r.jsx)(n.strong,{children:"Process"}),":"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Automated PR contains generated FTL file"}),"\n",(0,r.jsx)(n.li,{children:"Reviewers verify content extraction accuracy"}),"\n",(0,r.jsx)(n.li,{children:"Check for proper FTL format compliance"}),"\n",(0,r.jsx)(n.li,{children:"Approve and merge PR to main branch"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"5-pontoon-integration",children:"5. Pontoon Integration"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Location"}),": External to FxA codebase\n",(0,r.jsx)(n.strong,{children:"Process"}),":"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Detection"}),": Pontoon monitors the FxA repository for FTL file changes"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Project Update"}),": New strings are imported into Pontoon projects"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Translation"}),": Community translators and staff work on localizations"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Quality Assurance"}),": Translations are reviewed and approved"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Merge Back"}),": Completed translations are committed back to the repository"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"6-runtime-localization-and-caching",children:"6. Runtime Localization and Caching"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Location"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["API: ",(0,r.jsx)(n.code,{children:"packages/fxa-auth-server/lib/routes/cms.ts:96-176"})]}),"\n",(0,r.jsxs)(n.li,{children:["Configuration Manager: ",(0,r.jsx)(n.code,{children:"libs/shared/cms/src/lib/relying-party-configuration.manager.ts"})]}),"\n",(0,r.jsxs)(n.li,{children:["Frontend: ",(0,r.jsx)(n.code,{children:"packages/fxa-settings/src/models/integrations/integration.ts:167-199"})]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"caching-strategy",children:"Caching Strategy"}),"\n",(0,r.jsx)(n.mermaid,{value:"graph LR\n    A[Request] --\x3e B[Memory Cache]\n    B --\x3e|Hit| C[Return Cached]\n    B --\x3e|Miss| D[Firestore Cache]\n    D --\x3e|Hit| E[Return Cached]\n    D --\x3e|Miss| F[Fetch from GitHub]\n    F --\x3e G[Store in Caches]\n    G --\x3e H[Return Content]"}),"\n",(0,r.jsx)(n.h4,{id:"cache-configuration",children:"Cache Configuration"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Memory Cache TTL"}),": 5 minutes (configurable via ",(0,r.jsx)(n.code,{children:"cmsl10n.ftlCache.memoryTtlSeconds"}),")"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Firestore Cache TTL"}),": 30 minutes (configurable via ",(0,r.jsx)(n.code,{children:"cmsl10n.ftlCache.firestoreTtlSeconds"}),")"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Firestore Offline TTL"}),": 7 days (configurable via ",(0,r.jsx)(n.code,{children:"cmsl10n.ftlCache.firestoreOfflineTtlSeconds"}),")"]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"localization-request-flow",children:"Localization Request Flow"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Client Request"}),": Frontend requests ",(0,r.jsx)(n.code,{children:"/cms/config?clientId={id}&entrypoint={point}"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Base Configuration"}),": Fetch base config from Strapi via RelyingPartyConfigurationManager"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Locale Detection"}),": Determine user locale from request headers"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Localization Logic"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"If locale is 'en' \u2192 return base config"}),"\n",(0,r.jsx)(n.li,{children:"If localization disabled \u2192 return base config"}),"\n",(0,r.jsx)(n.li,{children:"Otherwise, proceed with localization"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"FTL Retrieval"}),": Fetch localized FTL content with fallback logic:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Try specific locale (e.g., 'es-MX')"}),"\n",(0,r.jsx)(n.li,{children:"Fallback to base language (e.g., 'es')"}),"\n",(0,r.jsx)(n.li,{children:"Use cached content when available"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Content Merging"}),": Parse FTL and merge with base configuration"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Response"}),": Return localized configuration to client"]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"ftl-url-template",children:"FTL URL Template"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:'// Configuration example\n{\n  "cmsl10n": {\n    "ftlUrl": {\n      "template": "https://raw.githubusercontent.com/mozilla/fxa/{branch}/locales/{locale}/cms.ftl",\n      "timeout": 5000\n    }\n  }\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"error-handling-and-fallbacks",children:"Error Handling and Fallbacks"}),"\n",(0,r.jsx)(n.h3,{id:"webhook-processing-errors",children:"Webhook Processing Errors"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Location"}),": ",(0,r.jsx)(n.code,{children:"packages/fxa-auth-server/lib/routes/cms.ts:290-296"})]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Authentication Failures"}),": Invalid webhook secrets are logged and rejected"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Strapi API Errors"}),": Network failures fall back gracefully without blocking the webhook"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"GitHub API Errors"}),": PR creation failures are logged with full context"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Validation Errors"}),": Malformed content is logged for debugging"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"runtime-localization-errors",children:"Runtime Localization Errors"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Location"}),": ",(0,r.jsx)(n.code,{children:"packages/fxa-auth-server/lib/routes/utils/cms/localization.ts:665-716"})]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"FTL Fetch Failures"}),": Automatic fallback to base language, then base config"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Network Timeouts"}),": Configurable timeout with graceful degradation"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Cache Failures"}),": Continue to next cache level or origin fetch"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Parse Errors"}),": Return base configuration on FTL parsing failures"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"fallback-strategy",children:"Fallback Strategy"}),"\n",(0,r.jsx)(n.mermaid,{value:"graph TD\n    A[Request Locale 'es-MX'] --\x3e B[Try 'es-MX' FTL]\n    B --\x3e|Success| C[Return Localized Config]\n    B --\x3e|Fail| D[Try 'es' FTL]\n    D --\x3e|Success| C\n    D --\x3e|Fail| E[Return Base Config]"}),"\n",(0,r.jsx)(n.h2,{id:"configuration",children:"Configuration"}),"\n",(0,r.jsx)(n.h3,{id:"environment-variables",children:"Environment Variables"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"FXA_L10N_REPO"}),": L10n repository URL (default: mozilla/fxa-content-server-l10n)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"FXA_L10N_BRANCH"}),": Target branch (default: main)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"FXA_L10N_SHA"}),": Specific commit hash for L10n files"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"service-configuration",children:"Service Configuration"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"interface CMSLocalizationConfig {\n  enabled: boolean;\n  strapiWebhook: {\n    enabled: boolean;\n    secret: string;\n    strapiUrl: string;\n  };\n  github: {\n    token: string;\n    owner: string;\n    repo: string;\n    branch: string;\n  };\n  ftlUrl: {\n    template: string;\n    timeout: number;\n  };\n  ftlCache: {\n    memoryTtlSeconds: number;\n    firestoreTtlSeconds: number;\n    firestoreOfflineTtlSeconds: number;\n  };\n}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"key-file-locations",children:"Key File Locations"}),"\n",(0,r.jsx)(n.h3,{id:"backend-components",children:"Backend Components"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"CMS Routes"}),": ",(0,r.jsx)(n.code,{children:"packages/fxa-auth-server/lib/routes/cms.ts"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Localization Logic"}),": ",(0,r.jsx)(n.code,{children:"packages/fxa-auth-server/lib/routes/utils/cms/localization.ts"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Configuration Manager"}),": ",(0,r.jsx)(n.code,{children:"libs/shared/cms/src/lib/relying-party-configuration.manager.ts"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Test Suite"}),": ",(0,r.jsx)(n.code,{children:"packages/fxa-auth-server/test/local/routes/utils/cms/localization.js"})]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"frontend-components",children:"Frontend Components"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Integration Layer"}),": ",(0,r.jsx)(n.code,{children:"packages/fxa-settings/src/models/integrations/integration.ts:167"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"CMS Hooks"}),": ",(0,r.jsx)(n.code,{children:"packages/fxa-settings/src/models/hooks.ts:262"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Auth Client"}),": ",(0,r.jsx)(n.code,{children:"packages/fxa-auth-client/lib/client.ts:2428"})]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"l10n-scripts",children:"L10n Scripts"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Clone Script"}),": ",(0,r.jsx)(n.code,{children:"_scripts/l10n/clone.sh"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Prime Script"}),": ",(0,r.jsx)(n.code,{children:"_scripts/l10n/prime.sh"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Bundle Script"}),": ",(0,r.jsx)(n.code,{children:"_scripts/l10n/bundle.sh"})]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"monitoring-and-metrics",children:"Monitoring and Metrics"}),"\n",(0,r.jsx)(n.h3,{id:"statsd-metrics",children:"StatsD Metrics"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"cms.getConfig.empty"}),": Config requests returning empty results"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"cms.getConfig.multiple"}),": Multiple relying parties found for request"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"cms.getConfig.error"}),": Config fetch errors"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"cms.getLocalizedConfig.success"}),": Successful localized config delivery"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"cms.getLocalizedConfig.fallback"}),": Fallback to base config"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"cms.getLocalizedConfig.error"}),": Localization errors"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"cms.strapiWebhook.processed"}),": Successfully processed webhooks"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"cms.strapiWebhook.error"}),": Webhook processing errors"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"cms_ftl_cache_hit"}),": FTL cache hit timing"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"cms_ftl_request"}),": FTL fetch timing and errors"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"logging",children:"Logging"}),"\n",(0,r.jsx)(n.p,{children:"All components use structured logging with:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Request correlation IDs"}),"\n",(0,r.jsx)(n.li,{children:"Client identification"}),"\n",(0,r.jsx)(n.li,{children:"Locale information"}),"\n",(0,r.jsx)(n.li,{children:"Error details and stack traces"}),"\n",(0,r.jsx)(n.li,{children:"Performance metrics"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"testing-localization",children:"Testing Localization"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'# Run localization-specific tests\nNODE_ENV=test yarn test test/local/routes/utils/cms/localization.js\n\n# Test with specific locale\ncurl "http://localhost:9000/v1/cms/config?clientId={clientId}&entrypoint={entrypoint}" \\\n  -H "Accept-Language: es-MX"\n'})}),"\n",(0,r.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,r.jsx)(n.h3,{id:"common-issues",children:"Common Issues"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Empty Localized Config"}),": Check FTL file availability and cache status"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Webhook Failures"}),": Verify webhook secret configuration and Strapi connectivity"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"GitHub PR Errors"}),": Confirm GitHub token permissions and repository access"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Cache Inconsistency"}),": Clear Firestore and memory caches, verify TTL settings"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"FTL Parse Errors"}),": Validate FTL file format and character encoding"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}}}]);