"use strict";(self.webpackChunkfirefox_ecosystem_platform=self.webpackChunkfirefox_ecosystem_platform||[]).push([[5247],{11342:(e,t,s)=>{s.r(t),s.d(t,{assets:()=>a,contentTitle:()=>l,default:()=>h,frontMatter:()=>r,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"how-tos/using-twilio-locally","title":"Using Twilio For Local Development and Testing","description":"We use Twilio to send SMS messages to confirm and validate backup recovery phones. We are currently using Twilio\'s SMS api, but may also include the Twilio verify API in future versions of the recovery phone service. Regardless, the process of setting up and testing a twilio account should be pretty similar. The steps are as follows.","source":"@site/docs/how-tos/using-twilio-locally.md","sourceDirName":"how-tos","slug":"/how-tos/using-twilio-locally","permalink":"/ecosystem-platform/how-tos/using-twilio-locally","draft":false,"unlisted":false,"editUrl":"https://github.com/mozilla/ecosystem-platform/edit/master/docs/how-tos/using-twilio-locally.md","tags":[],"version":"current","frontMatter":{"title":"Using Twilio For Local Development and Testing"},"sidebar":"docs","previous":{"title":"Tracing for Local Development","permalink":"/ecosystem-platform/how-tos/using-tracing-locally"},"next":{"title":"Using VS Code with FxA","permalink":"/ecosystem-platform/how-tos/using-vscode-with-fxa"}}');var o=s(74848),n=s(28453);const r={title:"Using Twilio For Local Development and Testing"},l="About Twilio",a={},c=[];function d(e){const t={a:"a",code:"code",em:"em",h1:"h1",header:"header",li:"li",ol:"ol",p:"p",ul:"ul",...(0,n.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(t.header,{children:(0,o.jsx)(t.h1,{id:"about-twilio",children:"About Twilio"})}),"\n",(0,o.jsx)(t.p,{children:"We use Twilio to send SMS messages to confirm and validate backup recovery phones. We are currently using Twilio's SMS api, but may also include the Twilio verify API in future versions of the recovery phone service. Regardless, the process of setting up and testing a twilio account should be pretty similar. The steps are as follows."}),"\n",(0,o.jsxs)(t.ol,{children:["\n",(0,o.jsx)(t.li,{children:"Go to twilio.com and sign up. You should use your @mozilla.com email and signup / in with google's oauth."}),"\n",(0,o.jsx)(t.li,{children:"Once in twilio, go to your 'api keys'. There should be a link on the landing page."}),"\n",(0,o.jsx)(t.li,{children:"On the api keys page, you'll see separate keys for 'test credentials'. Be sure to use the 'test credential keys' for local development!"}),"\n",(0,o.jsx)(t.li,{children:"Now in the root of fxa open up your .env file. (If one does not exist, create it.)"}),"\n",(0,o.jsxs)(t.li,{children:["Add ",(0,o.jsx)(t.code,{children:"RECOVERY_PHONE__TWILIO__ACCOUNT_SID=#####"})," where ",(0,o.jsx)(t.code,{children:"#####"})," is your test account sid value."]}),"\n",(0,o.jsxs)(t.li,{children:["Add ",(0,o.jsx)(t.code,{children:"RECOVERY_PHONE__TWILIO__AUTH_TOKEN==#####"})," where ",(0,o.jsx)(t.code,{children:"#####"})," is your test account auth token value."]}),"\n",(0,o.jsxs)(t.li,{children:["Add ",(0,o.jsx)(t.code,{children:"RECOVERY_PHONE__ENABLED=true"})]}),"\n",(0,o.jsxs)(t.li,{children:["Start up the stack with env applied, ",(0,o.jsx)(t.code,{children:"dotenv -- yarn start"})]}),"\n"]}),"\n",(0,o.jsx)(t.p,{children:(0,o.jsx)(t.em,{children:"Note that another option is simply updating the local.json config files to override the config values."})}),"\n",(0,o.jsx)(t.h1,{id:"validating-the-twilio-integration",children:"Validating The Twilio Integration"}),"\n",(0,o.jsx)(t.p,{children:"The auth server has a test suite that allows us to run integration tests against the Twilio API. This relies on using test credentials setup in the previous step. Running these integration tests on your dev environment is a great way to validate\nthat the Twilio integration is in fact configured correctly and working."}),"\n",(0,o.jsx)(t.p,{children:"Here's the steps to do this:"}),"\n",(0,o.jsxs)(t.ol,{children:["\n",(0,o.jsx)(t.li,{children:"Make sure you've followed the steps in the 'Configuring Twilio' section above."}),"\n",(0,o.jsxs)(t.li,{children:["Just to make sure we have a clean slate run ",(0,o.jsx)(t.code,{children:"yarn stop"})]}),"\n",(0,o.jsxs)(t.li,{children:["Next start the infrastructure, which spin up required mysql and redis instances locally. ",(0,o.jsx)(t.code,{children:"yarn start infrastructure"})]}),"\n",(0,o.jsxs)(t.li,{children:["Next run the integration tests. ",(0,o.jsx)(t.code,{children:"dotenv -- nx test-integration fxa-auth-server remote"})]}),"\n"]}),"\n",(0,o.jsx)(t.h1,{id:"notes-on-testing-with-twilio",children:"Notes on Testing with Twilio"}),"\n",(0,o.jsxs)(t.p,{children:["For almost all test cases we can rely on Twilio magic phone numbers. These numbers represent different possible success and error states when sending out messages. For example, when a sending a valid text message use ",(0,o.jsx)(t.code,{children:"+15005550006"})," as the from number\nand any valid number as the \u2018to\u2019 phone number, the SMS will appear to go through. Note, that using a non real phone number like ",(0,o.jsx)(t.code,{children:"+12345678900"})," for the ",(0,o.jsx)(t.code,{children:"to"})," phone number is a good idea, since it avoids hardcoding a potentially real phone number, and this is also a magic number that plays nicely with Twilio's lookup api. For more examples and ideas for testing, see the recovery-phone integration tests @ ",(0,o.jsx)(t.code,{children:"fxa-auth-server/test/remote/recovery_phone_tests.js"}),"."]}),"\n",(0,o.jsx)(t.p,{children:"For more info about testing and magic phone numbers in general check out the following Twilio docs:"}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsx)(t.li,{children:(0,o.jsx)(t.a,{href:"https://www.twilio.com/docs/messaging/tutorials/automate-testing",children:"https://www.twilio.com/docs/messaging/tutorials/automate-testing"})}),"\n",(0,o.jsx)(t.li,{children:(0,o.jsx)(t.a,{href:"https://www.twilio.com/docs/iam/test-credentials#test-sms-messages",children:"https://www.twilio.com/docs/iam/test-credentials#test-sms-messages"})}),"\n",(0,o.jsx)(t.li,{children:(0,o.jsx)(t.a,{href:"https://www.twilio.com/docs/lookup/magic-numbers-for-lookup",children:"https://www.twilio.com/docs/lookup/magic-numbers-for-lookup"})}),"\n"]})]})}function h(e={}){const{wrapper:t}={...(0,n.R)(),...e.components};return t?(0,o.jsx)(t,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},28453:(e,t,s)=>{s.d(t,{R:()=>r,x:()=>l});var i=s(96540);const o={},n=i.createContext(o);function r(e){const t=i.useContext(n);return i.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function l(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:r(e.components),i.createElement(n.Provider,{value:t},e.children)}}}]);