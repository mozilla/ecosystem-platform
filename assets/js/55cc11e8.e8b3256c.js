"use strict";(self.webpackChunkfirefox_ecosystem_platform=self.webpackChunkfirefox_ecosystem_platform||[]).push([[5182],{48227:(e,t,o)=>{o.r(t),o.d(t,{assets:()=>l,contentTitle:()=>a,default:()=>m,frontMatter:()=>n,metadata:()=>c,toc:()=>h});var i=o(74848),s=o(28453);const r=o.p+"assets/images/storybook-circleci-ae90d4f4b43a5ba61eca5c9be8db596f.png",n={title:"Storybook Deploys with CircleCI"},a=void 0,c={id:"reference/storybook-deploys-with-circleci",title:"Storybook Deploys with CircleCI",description:"Several of the packages in this repository use Storybook to build and demonstrate user interface components (mostly in React). These notably include fxa-settings, fxa-payments-server, fxa-react, and fxa-auth-server which contains our emails.",source:"@site/docs/reference/storybook-deploys-with-circleci.md",sourceDirName:"reference",slug:"/reference/storybook-deploys-with-circleci",permalink:"/ecosystem-platform/reference/storybook-deploys-with-circleci",draft:!1,unlisted:!1,editUrl:"https://github.com/mozilla/ecosystem-platform/edit/master/docs/reference/storybook-deploys-with-circleci.md",tags:[],version:"current",frontMatter:{title:"Storybook Deploys with CircleCI"},sidebar:"docs",previous:{title:"Rate limiting",permalink:"/ecosystem-platform/reference/rate-limiting"},next:{title:"System Diagrams",permalink:"/ecosystem-platform/reference/system-diagrams"}},l={},h=[{value:"Maintaining Storybook Builds",id:"maintaining-storybook-builds",level:2}];function d(e){const t={a:"a",admonition:"admonition",code:"code",h2:"h2",li:"li",p:"p",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(t.p,{children:["Several of the packages in this repository use ",(0,i.jsx)(t.a,{href:"https://storybook.js.org/",children:"Storybook"})," to build and demonstrate user interface components (mostly in React). These notably include ",(0,i.jsx)(t.a,{href:"https://github.com/mozilla/fxa/tree/main/packages/fxa-settings",children:"fxa-settings"}),", ",(0,i.jsx)(t.a,{href:"https://github.com/mozilla/fxa/tree/main/packages/fxa-payments-server",children:"fxa-payments-server"}),", ",(0,i.jsx)(t.a,{href:"https://github.com/mozilla/fxa/tree/main/packages/fxa-react",children:"fxa-react"}),", and ",(0,i.jsx)(t.a,{href:"https://github.com/mozilla/fxa/tree/main/packages/fxa-auth-server/lib/senders/emails",children:"fxa-auth-server"})," which contains our emails."]}),"\n",(0,i.jsx)(t.admonition,{type:"info",children:(0,i.jsxs)(t.p,{children:["The latest Storybook builds on the ",(0,i.jsx)(t.code,{children:"main"})," branch can ",(0,i.jsx)(t.a,{href:"https://storage.googleapis.com/mozilla-storybooks-fxa/commits/latest/index.html",children:"be found here"}),"."]})}),"\n",(0,i.jsxs)(t.p,{children:["For most ",(0,i.jsx)(t.a,{href:"https://github.com/mozilla/fxa/blob/main/.circleci/config.yml",children:"test runs in CircleCI"}),", a static build of each package's Storybook for the relevant commit is published to a website we host on Google Cloud Platform. ",(0,i.jsx)(t.a,{href:"https://storage.googleapis.com/mozilla-storybooks-fxa/index.html",children:"Click here"})," to view the index page."]}),"\n",(0,i.jsxs)(t.p,{children:['You can find the Storybook build associated with a given commit on GitHub by clicking the "Details" link next to a ',(0,i.jsx)(t.strong,{children:"storybooks: pull request"})," check, accessible via clicking the green check mark next to the commit title."]}),"\n",(0,i.jsx)("img",{src:r,alt:"Example showing how to preview a Storybook build",width:"400px"}),"\n",(0,i.jsx)(t.admonition,{type:"tip",children:(0,i.jsx)(t.p,{children:"Since Storybook builds per commit, it can be helpful to send Storybook links around to Product, UX, or anyone else that may want to preview UI changes for a PR you have up before it's approved and merged."})}),"\n",(0,i.jsx)(t.h2,{id:"maintaining-storybook-builds",children:"Maintaining Storybook Builds"}),"\n",(0,i.jsxs)(t.p,{children:["If you've been given access, the Google Cloud Platform project dashboard for the website can be ",(0,i.jsx)(t.a,{href:"https://console.cloud.google.com/home/dashboard?project=storybook-static-sites",children:"found here"}),"."]}),"\n",(0,i.jsxs)(t.p,{children:["We use ",(0,i.jsx)(t.a,{href:"https://github.com/mozilla-fxa/storybook-gcp-publisher",children:"mozilla-fxa/storybook-gcp-publisher"})," for publishing Storybook builds. Refer to its repository for full documentation."]}),"\n",(0,i.jsxs)(t.p,{children:["For quick reference, here are a few ",(0,i.jsx)(t.a,{href:"https://github.com/mozilla-fxa/storybook-gcp-publisher#basic-1",children:"CircleCI environment variables"})," used by ",(0,i.jsx)(t.code,{children:"storybook-gcp-publisher"})," that are relevant to FxA operations in CircleCI. Occasionally they may need maintenance or replacement (e.g. in case of a security incident involving another tool that exposes variables):"]}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"STORYBOOKS_GITHUB_TOKEN"})," - personal access token on GitHub for use in posting status check updates"]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"STORYBOOKS_GCP_BUCKET"})," - name of the GCP bucket to which Storybook builds will be uploaded"]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"STORYBOOKS_GCP_PROJECT_ID"})," - the ID of the GCP project to which the bucket belongs"]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"STORYBOOKS_GCP_CLIENT_EMAIL"})," - client email address from GCP credentials with access to the bucket"]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"STORYBOOKS_GCP_PRIVATE_KEY_BASE64"})," - the private key from GCP credentials, encoded with base64 to accommodate line breaks"]}),"\n"]})]})}function m(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},28453:(e,t,o)=>{o.d(t,{R:()=>n,x:()=>a});var i=o(96540);const s={},r=i.createContext(s);function n(e){const t=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:n(e.components),i.createElement(r.Provider,{value:t},e.children)}}}]);