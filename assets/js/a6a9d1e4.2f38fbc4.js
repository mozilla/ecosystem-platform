"use strict";(self.webpackChunkfirefox_ecosystem_platform=self.webpackChunkfirefox_ecosystem_platform||[]).push([[4258],{39857:(e,t,i)=>{i.r(t),i.d(t,{assets:()=>l,contentTitle:()=>s,default:()=>u,frontMatter:()=>o,metadata:()=>a,toc:()=>c});var n=i(85893),r=i(11151);const o={id:"integration-with-subscription-platform",title:"Integration with Subscription Platform",sidebar_label:"Integration with Subscription Platform"},s=void 0,a={id:"relying-parties/tutorials/integration-with-subscription-platform",title:"Integration with Subscription Platform",description:"Last updated: Oct 6th, 2023",source:"@site/docs/relying-parties/tutorials/integration-with-subscription-platform.md",sourceDirName:"relying-parties/tutorials",slug:"/relying-parties/tutorials/integration-with-subscription-platform",permalink:"/ecosystem-platform/relying-parties/tutorials/integration-with-subscription-platform",draft:!1,unlisted:!1,editUrl:"https://github.com/mozilla/ecosystem-platform/edit/master/docs/relying-parties/tutorials/integration-with-subscription-platform.md",tags:[],version:"current",frontMatter:{id:"integration-with-subscription-platform",title:"Integration with Subscription Platform",sidebar_label:"Integration with Subscription Platform"},sidebar:"docs",previous:{title:"Integration with FxA",permalink:"/ecosystem-platform/relying-parties/tutorials/integration-with-fxa"},next:{title:"Pairing authentication",permalink:"/ecosystem-platform/relying-parties/tutorials/pairing"}},l={},c=[{value:"Setting up A Subscription",id:"setting-up-a-subscription",level:2},{value:"Pre-Development",id:"pre-development",level:3},{value:"File A ticket",id:"file-a-ticket",level:4},{value:"Have a kickoff meeting",id:"have-a-kickoff-meeting",level:4},{value:"Development",id:"development",level:3},{value:"Demoing Subscription Flows",id:"demoing-subscription-flows",level:4},{value:"Setting up your marketing pages",id:"setting-up-your-marketing-pages",level:4},{value:"Webhook Events",id:"webhook-events",level:4},{value:"Testing",id:"testing",level:4},{value:"Ensure your product(s) are included in SubPlat&#39;s Looker dashboards",id:"ensure-your-products-are-included-in-subplats-looker-dashboards",level:4},{value:"Evaluating the current user flow",id:"evaluating-the-current-user-flow",level:2},{value:"Integration with Google IAP",id:"integration-with-google-iap",level:2},{value:"Integration with Apple IAP",id:"integration-with-apple-iap",level:2},{value:"Product metrics in Looker",id:"product-metrics-in-looker",level:2}];function p(e){const t={a:"a",code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,r.a)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(t.p,{children:["Last updated: ",(0,n.jsx)(t.code,{children:"Oct 6th, 2023"})]}),"\n",(0,n.jsx)(t.h2,{id:"setting-up-a-subscription",children:"Setting up A Subscription"}),"\n",(0,n.jsx)(t.h3,{id:"pre-development",children:"Pre-Development"}),"\n",(0,n.jsx)(t.h4,{id:"file-a-ticket",children:"File A ticket"}),"\n",(0,n.jsx)(t.p,{children:"First thing's first. File an FxA ticket in Jira. This ticket can be used to track documentation for your subscription. You can use the component \"Subscription Platform\" but otherwise, don't worry too much about format for your issue. We will use this request to set up an initial meeting and get the ball rolling. We will track your subscription setup in Confluence in order to keep sensitive details such as price and release dates and market confidential."}),"\n",(0,n.jsx)(t.h4,{id:"have-a-kickoff-meeting",children:"Have a kickoff meeting"}),"\n",(0,n.jsx)(t.p,{children:"Once your ticket is filed, you should have had a RRA-style meeting with the Mozilla accounts team. During or shortly after this meeting, an initial subscription capability string or strings should be agreed upon."}),"\n",(0,n.jsx)(t.p,{children:"We will use this meeting to do the following:"}),"\n",(0,n.jsxs)(t.ol,{children:["\n",(0,n.jsx)(t.li,{children:"Set up a Confluence page to track basic info about your product such as name & capability string or strings"}),"\n",(0,n.jsx)(t.li,{children:"Get a rough estimate of your shipping timeline (don't worry if this isn't 100% pinned down)"}),"\n",(0,n.jsx)(t.li,{children:"Get a staging subscription set up for you to start testing with"}),"\n"]}),"\n",(0,n.jsx)(t.h3,{id:"development",children:"Development"}),"\n",(0,n.jsxs)(t.p,{children:["Integration with FxA is the primary development task to complete for a working subscription integration. The additional Subscription Capability string will be included as the ",(0,n.jsx)(t.code,{children:"subscriptions"})," field in the response from the FxA Profile Server."]}),"\n",(0,n.jsx)(t.p,{children:"If your integration includes an application service, it will need a webhook handler to receive relying party events from the FxA Event Broker."}),"\n",(0,n.jsx)(t.h4,{id:"demoing-subscription-flows",children:"Demoing Subscription Flows"}),"\n",(0,n.jsxs)(t.p,{children:["The FxA Team maintains the Firefox Fortress package ",(0,n.jsx)(t.code,{children:"fxa/packages/fortress"})," in order to demonstrate various SubPlat capabilities including tiers & different cycle durations. This package runs at ",(0,n.jsx)(t.code,{children:"127.0.0.1:9292"}),", and is an up-to-date representation of SubPlat features. In order complete the demo, you will need access to a Stripe dev instance. An Accounts team member can provide this upon request. Please see our ",(0,n.jsx)(t.a,{href:"/ecosystem-platform/tutorials/subscription-platform#configuration",children:"developer docs"})," to learn more."]}),"\n",(0,n.jsx)(t.h4,{id:"setting-up-your-marketing-pages",children:"Setting up your marketing pages"}),"\n",(0,n.jsx)(t.p,{children:"If your integration includes lead pages to start a subscription flow, you will need to include the product and plan id's in the subscription 'buy' URL. This link for production has the form of:"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{children:"https://{hostname}/subscriptions/products/{productId}?plan={planId}\n"})}),"\n",(0,n.jsx)(t.p,{children:"Valid hostnames for the FxA environments:"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:["Production - ",(0,n.jsx)(t.code,{children:"accounts.firefox.com"})]}),"\n",(0,n.jsxs)(t.li,{children:["Stage - ",(0,n.jsx)(t.code,{children:"accounts.stage.mozaws.net"})]}),"\n"]}),"\n",(0,n.jsxs)(t.p,{children:["Note that valid values for ",(0,n.jsx)(t.code,{children:"productId"})," and ",(0,n.jsx)(t.code,{children:"planId"})," will vary with environment as a different Stripe account is associated with each."]}),"\n",(0,n.jsx)(t.p,{children:"Additionally, if your product has multiple associated plans in any environment, you will need to ensure that you are routing users correctly. The most likely cases for this would be:"}),"\n",(0,n.jsxs)(t.ol,{children:["\n",(0,n.jsx)(t.li,{children:"If your product has plans with different billing intervals (monthly, annually)"}),"\n",(0,n.jsx)(t.li,{children:"If your product has plans in different currencies"}),"\n"]}),"\n",(0,n.jsx)(t.p,{children:"Importantly, the Subscription Platform does not currently provide any inbuilt capabilities for routing users to a correct currency or for showing multiple plans to a user at once. If this is a requirement for your product, you must provide the appropriate UI and routing to ensure that users end up on the correct payment page for the correct product."}),"\n",(0,n.jsx)(t.p,{children:"For any plans which are not approved for release, such as the case of internal testing plans, ensure each internal plan has been Archived in Stripe prior to release."}),"\n",(0,n.jsx)(t.h4,{id:"webhook-events",children:"Webhook Events"}),"\n",(0,n.jsxs)(t.p,{children:["If your integration includes an application service, ",(0,n.jsx)(t.a,{href:"https://github.com/mozilla/fxa/tree/main/packages/fxa-event-broker#subscription-state-change",children:"subscription state notifications"})," will also be sent via ",(0,n.jsx)(t.a,{href:"https://en.wikipedia.org/wiki/Webhook",children:"webhook"})," to your registered ",(0,n.jsx)(t.a,{href:"https://en.wikipedia.org/wiki/Webhook",children:"webhook"})," URL."]}),"\n",(0,n.jsx)(t.h4,{id:"testing",children:"Testing"}),"\n",(0,n.jsxs)(t.p,{children:["When integrated with the FxA stage or development environments, subscription sign-up's can be tested using ",(0,n.jsx)(t.a,{href:"https://stripe.com/docs/testing#cards",children:"Stripe test cards"}),"."]}),"\n",(0,n.jsx)(t.h4,{id:"ensure-your-products-are-included-in-subplats-looker-dashboards",children:"Ensure your product(s) are included in SubPlat's Looker dashboards"}),"\n",(0,n.jsxs)(t.p,{children:["Once you have your products and plans configured in Stripe and/or Contentful, and before you deploy your integration to production, file a ",(0,n.jsx)(t.a,{href:"https://mozilla-hub.atlassian.net/jira/software/c/projects/DO/boards/269",children:"Data Org ticket in Jira"})," to add your product(s) to the SubPlat ETL."]}),"\n",(0,n.jsxs)(t.p,{children:["See ",(0,n.jsx)(t.a,{href:"#product-metrics-in-looker",children:"Product metrics in Looker"})," for more information."]}),"\n",(0,n.jsx)(t.h2,{id:"evaluating-the-current-user-flow",children:"Evaluating the current user flow"}),"\n",(0,n.jsx)(t.p,{children:"To see the user experience without setting up your localhost you can subscribe to any of the existing subscriptions that we have available. If you want to try out the upgrade flow please use MDN Plus."}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:["VPN - ",(0,n.jsx)(t.a,{href:"https://www-dev.allizom.org/en-US/products/vpn/#pricing",children:"https://www-dev.allizom.org/en-US/products/vpn/#pricing"})]}),"\n",(0,n.jsxs)(t.li,{children:["Relay Premium - ",(0,n.jsx)(t.a,{href:"https://stage.fxprivaterelay.nonprod.cloudops.mozgcp.net/",children:"https://stage.fxprivaterelay.nonprod.cloudops.mozgcp.net/"})]}),"\n",(0,n.jsxs)(t.li,{children:["MDN Plus - ",(0,n.jsx)(t.a,{href:"https://developer.allizom.org/en-US/plus#subscribe",children:"https://developer.allizom.org/en-US/plus#subscribe"})]}),"\n"]}),"\n",(0,n.jsx)(t.p,{children:"Once you selected a plan please create a new user. You can use the following Credit Card number: 4242424242424242 with any 3 digit CVC and a valid expiration date. NOTE: this is a test card and is only available on staging. Once you complete the subscription you can look at the email communications sent out by the SubPlat team."}),"\n",(0,n.jsxs)(t.p,{children:["To cancel your subscription simply go to ",(0,n.jsx)(t.a,{href:"https://accounts.stage.mozaws.net/subscriptions",children:"https://accounts.stage.mozaws.net/subscriptions"})," and press the cancel button."]}),"\n",(0,n.jsx)(t.p,{children:"To upgrade your subscription sign in to your account using the step above and go to the MDN Plus link. The website will now display your current plan and the upgrade options."}),"\n",(0,n.jsx)(t.h2,{id:"integration-with-google-iap",children:"Integration with Google IAP"}),"\n",(0,n.jsxs)(t.p,{children:["To integrate your android app with the Subscription Platform, please see ",(0,n.jsx)(t.a,{href:"/ecosystem-platform/relying-parties/how-tos/google-iap",children:"Google IAP"}),"."]}),"\n",(0,n.jsx)(t.h2,{id:"integration-with-apple-iap",children:"Integration with Apple IAP"}),"\n",(0,n.jsxs)(t.p,{children:["To integrate your iOS app with the Subscription Platform, please see ",(0,n.jsx)(t.a,{href:"/ecosystem-platform/relying-parties/how-tos/apple-iap",children:"Apple IAP"}),"."]}),"\n",(0,n.jsx)(t.h2,{id:"product-metrics-in-looker",children:"Product metrics in Looker"}),"\n",(0,n.jsxs)(t.p,{children:["To view product metrics in Looker for your products and/or services, please see ",(0,n.jsx)(t.a,{href:"/ecosystem-platform/relying-parties/how-tos/product-metrics",children:"Metrics for Relying Parties"}),"."]})]})}function u(e={}){const{wrapper:t}={...(0,r.a)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(p,{...e})}):p(e)}},11151:(e,t,i)=>{i.d(t,{Z:()=>a,a:()=>s});var n=i(67294);const r={},o=n.createContext(r);function s(e){const t=n.useContext(o);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:s(e.components),n.createElement(o.Provider,{value:t},e.children)}}}]);