"use strict";(self.webpackChunkfirefox_ecosystem_platform=self.webpackChunkfirefox_ecosystem_platform||[]).push([[3222],{28453:(e,n,s)=>{s.d(n,{R:()=>l,x:()=>d});var i=s(96540);const a={},c=i.createContext(a);function l(e){const n=i.useContext(c);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:l(e.components),i.createElement(c.Provider,{value:n},e.children)}},73649:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>r,contentTitle:()=>d,default:()=>h,frontMatter:()=>l,metadata:()=>i,toc:()=>t});const i=JSON.parse('{"id":"reference/webchannels","title":"WebChannels","description":"Current as of April 17, 2023","source":"@site/docs/reference/webchannels.md","sourceDirName":"reference","slug":"/reference/webchannels","permalink":"/ecosystem-platform/reference/webchannels","draft":false,"unlisted":false,"editUrl":"https://github.com/mozilla/ecosystem-platform/edit/master/docs/reference/webchannels.md","tags":[],"version":"current","frontMatter":{"title":"WebChannels"},"sidebar":"docs","previous":{"title":"Tokens","permalink":"/ecosystem-platform/reference/tokens"},"next":{"title":"Architectural Decision Records","permalink":"/ecosystem-platform/explanation/architectural-decision-records"}}');var a=s(74848),c=s(28453);const l={title:"WebChannels"},d="Communication with Firefox via WebChannels",r={},t=[{value:"Firefox Desktop",id:"firefox-desktop",level:2},{value:"Context",id:"context",level:3},{value:"Commands",id:"commands",level:3},{value:"fxaccounts",id:"fxaccounts",level:4},{value:"request data",id:"request-data",level:5},{value:"response data",id:"response-data",level:5},{value:"fxaccounts",id:"fxaccounts-1",level:4},{value:"fxaccounts",id:"fxaccounts-2",level:4},{value:"request data",id:"request-data-1",level:5},{value:"response data",id:"response-data-1",level:5},{value:"fxaccounts",id:"fxaccounts-3",level:4},{value:"data",id:"data",level:5},{value:"fxaccounts",id:"fxaccounts-4",level:4},{value:"data",id:"data-1",level:5},{value:"fxaccounts",id:"fxaccounts-5",level:4},{value:"data",id:"data-2",level:5},{value:"fxaccounts",id:"fxaccounts-6",level:4},{value:"data",id:"data-3",level:5},{value:"fxaccount",id:"fxaccount",level:4},{value:"data",id:"data-4",level:5},{value:"fxaccounts",id:"fxaccounts-7",level:4},{value:"data",id:"data-5",level:5},{value:"profile",id:"profile",level:4},{value:"data",id:"data-6",level:5},{value:"Command data values",id:"command-data-values",level:3},{value:"loginData",id:"logindata",level:4},{value:"capabilities",id:"capabilities",level:4},{value:"engines",id:"engines",level:5},{value:"Possible values (Firefox Desktop)",id:"possible-values-firefox-desktop",level:6},{value:"Possible values (OAuth WebChannel Flow)",id:"possible-values-oauth-webchannel-flow",level:6},{value:"declinedSyncEngines, offeredSyncEngines",id:"declinedsyncengines-offeredsyncengines",level:4},{value:"signedInUser",id:"signedinuser",level:4},{value:"Command/Request format",id:"commandrequest-format",level:3},{value:"Response format",id:"response-format",level:3},{value:"Example command order for a signin/signup",id:"example-command-order-for-a-signinsignup",level:3},{value:"OAuth WebChannels",id:"oauth-webchannels",level:2},{value:"GeckoView applications",id:"geckoview-applications",level:3},{value:"Commands",id:"commands-1",level:3},{value:"fxaccounts",id:"fxaccounts-8",level:4},{value:"<code>engines</code> capability",id:"engines-capability",level:5},{value:"fxaccounts",id:"fxaccounts-9",level:4},{value:"data",id:"data-7",level:5},{value:"support",id:"support",level:5}];function o(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",h6:"h6",header:"header",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,c.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(n.p,{children:["Current as of ",(0,a.jsx)(n.code,{children:"April 17, 2023"})]}),"\n",(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"communication-with-firefox-via-webchannels",children:"Communication with Firefox via WebChannels"})}),"\n",(0,a.jsxs)(n.p,{children:["Mozilla accounts communicates with Firefox desktop and Fennec using ",(0,a.jsx)(n.a,{href:"https://developer.mozilla.org/en-US/docs/Mozilla/JavaScript_code_modules/WebChannel.jsm",children:"WebChannels"}),". WebChannels provide secure two-way communication between the browser and web content. Messages sent from content to the browser utilize ",(0,a.jsx)(n.code,{children:"WebChannelMessageToChrome"})," custom events. Messages sent from the browser to content utilize ",(0,a.jsx)(n.code,{children:"WebChannelMessageToContent"})," custom events."]}),"\n",(0,a.jsx)(n.h2,{id:"firefox-desktop",children:"Firefox Desktop"}),"\n",(0,a.jsx)(n.h3,{id:"context",children:"Context"}),"\n",(0,a.jsxs)(n.p,{children:["WebChannels are used to communicate Sync related information when\n",(0,a.jsx)(n.code,{children:"service=sync&context=<context>"})," query parameters are specified.\n",(0,a.jsx)(n.code,{children:"<context>"})," should be one of:"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.code,{children:"fx_desktop_v3"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.code,{children:"fx_fennec_v1"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"./webchannels-in-fenix-webextensions",children:(0,a.jsx)(n.code,{children:"oauth_webchannel_v1"})})}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"commands",children:"Commands"}),"\n",(0,a.jsxs)(n.p,{children:["A command is a ",(0,a.jsx)(n.code,{children:"WebChannelMessageToChrome"})," custom event sent from FxA to the browser using the ",(0,a.jsx)(n.code,{children:"account_updates"})," WebChannel."]}),"\n",(0,a.jsxs)(n.p,{children:["Command format is explained in the section titled ",(0,a.jsx)(n.a,{href:"#commandrequest-format",children:"Command/Request format"}),"."]}),"\n",(0,a.jsxs)(n.h4,{id:"fxaccounts",children:["fxaccounts",":fxa_status"]}),"\n",(0,a.jsx)(n.p,{children:"Sent on startup to fetch the FxA state from supporting browsers (only Firefox Desktop 55+).\nUsed to get the browser's currently signed in user as well as browser capabilities."}),"\n",(0,a.jsx)(n.h5,{id:"request-data",children:"request data"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-js",children:"{\n  isPairing: <boolean>,\n  service: <string>\n}\n"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"isPairing"}),": whether or not accounts.firefox.com is executing a pairing flow"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"service"}),": the service name or OAuth client-id that is requesting authentication"]}),"\n"]}),"\n",(0,a.jsx)(n.h5,{id:"response-data",children:"response data"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-js",children:"{\n  capabilities: <capabilities>\n  signedInUser: <signed in user> || null\n}\n"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"capabilities"})," - A list of capabilities supported by the browser. See ",(0,a.jsx)(n.a,{href:"#capabilities",children:"capabilities"}),"."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"signedInUser"})," - the user currently signed into Sync on the browser. See ",(0,a.jsx)(n.a,{href:"#signedInUser",children:"signedInUser"}),"."]}),"\n"]}),"\n",(0,a.jsxs)(n.h4,{id:"fxaccounts-1",children:["fxaccounts",":loaded"]}),"\n",(0,a.jsx)(n.p,{children:"Sent on startup. Sent after the first screen is visible. No data is sent. No response is expected."}),"\n",(0,a.jsxs)(n.h4,{id:"fxaccounts-2",children:["fxaccounts",":can_link_account"]}),"\n",(0,a.jsxs)(n.p,{children:["Sent on signin or signup after a user has entered their credentials and submit the form. A response with an ",(0,a.jsx)(n.code,{children:"ok"})," field is expected."]}),"\n",(0,a.jsx)(n.h5,{id:"request-data-1",children:"request data"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-js",children:"{\n  email: <email>\n}\n"})}),"\n",(0,a.jsx)(n.h5,{id:"response-data-1",children:"response data"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-js",children:"{\n  ok: true | false;\n}\n"})}),"\n",(0,a.jsxs)(n.h4,{id:"fxaccounts-3",children:["fxaccounts",":login"]}),"\n",(0,a.jsx)(n.p,{children:"Sent when a user successfully authenticates with Mozilla accounts and sync can begin. This includes after a user signs up but before they verify their email address, after an account unlock, and after a password reset. No response is expected."}),"\n",(0,a.jsx)(n.h5,{id:"data",children:"data"}),"\n",(0,a.jsxs)(n.p,{children:["See ",(0,a.jsx)(n.a,{href:"#logindata",children:"Login Data"}),"."]}),"\n",(0,a.jsxs)(n.h4,{id:"fxaccounts-4",children:["fxaccounts",":verified"]}),"\n",(0,a.jsx)(n.p,{children:"The user has successfully verified their email address."}),"\n",(0,a.jsx)(n.h5,{id:"data-1",children:"data"}),"\n",(0,a.jsxs)(n.p,{children:["See ",(0,a.jsx)(n.a,{href:"#logindata",children:"Login Data"}),"."]}),"\n",(0,a.jsxs)(n.h4,{id:"fxaccounts-5",children:["fxaccounts",":delete_account"]}),"\n",(0,a.jsx)(n.p,{children:"Sent after the user successfully deletes their account. No response is expected.\nExpected by Fennec."}),"\n",(0,a.jsx)(n.h5,{id:"data-2",children:"data"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-js",children:"{\n  email: <email>,\n  uid: <user id>\n}\n"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"email"})," - User's email address."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"uid"})," - The user identifier."]}),"\n"]}),"\n",(0,a.jsxs)(n.h4,{id:"fxaccounts-6",children:["fxaccounts",":delete"]}),"\n",(0,a.jsx)(n.p,{children:"Sent after the user successfully deletes their account. No response is expected.\nExpected by Fx Desktop."}),"\n",(0,a.jsx)(n.h5,{id:"data-3",children:"data"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-js",children:"{\n  email: <email>,\n  uid: <user id>\n}\n"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"email"})," - User's email address."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"uid"})," - The user identifier."]}),"\n"]}),"\n",(0,a.jsxs)(n.h4,{id:"fxaccount",children:["fxaccount",":change_password"]}),"\n",(0,a.jsx)(n.p,{children:"Sent after the user successfully changes their password. No response is expected."}),"\n",(0,a.jsx)(n.h5,{id:"data-4",children:"data"}),"\n",(0,a.jsxs)(n.p,{children:["See ",(0,a.jsx)(n.a,{href:"#logindata",children:"Login Data"}),"."]}),"\n",(0,a.jsxs)(n.h4,{id:"fxaccounts-7",children:["fxaccounts",":logout"]}),"\n",(0,a.jsx)(n.p,{children:"Called whenever the user signs out of their account. No response is expected."}),"\n",(0,a.jsx)(n.h5,{id:"data-5",children:"data"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-js",children:"{\n  uid: <user id>\n}\n"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"uid"})," - The user identifier."]}),"\n"]}),"\n",(0,a.jsxs)(n.h4,{id:"profile",children:["profile",":change"]}),"\n",(0,a.jsx)(n.p,{children:"Sent after the user changes their avatar or display name. No response is\nexpected."}),"\n",(0,a.jsx)(n.h5,{id:"data-6",children:"data"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-js",children:"{\n  uid: <user id>\n}\n"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"uid"})," - The user identifier."]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"command-data-values",children:"Command data values"}),"\n",(0,a.jsx)(n.h4,{id:"logindata",children:"loginData"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-js",children:"{\n  declinedSyncEngines: [<array of declined sync engines>],\n  email: <email>,\n  keyFetchToken: <key fetch token>,\n  offeredSyncEngines: [<array of displayed sync engines>],\n  sessionToken: <session token>,\n  uid: <user id>,\n  unwrapBKey: <unwrap b key>,\n  verified: (true|false),\n  verifiedCanLinkAccount: (true|false)\n}\n"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"declinedSyncEngines"})," - An array of Sync engines the user has deselected. See ",(0,a.jsx)(n.a,{href:"#declinedsyncengines-offeredsyncengines",children:"declinedSyncEngines, offeredSyncEngines"}),"."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"email"})," - User's email address."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"keyFetchToken"})," - Token used to fetch wrapWrapKB from the server."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"offeredSyncEngines"})," - An array of Sync engines that were displayed to the user. See ",(0,a.jsx)(n.a,{href:"#declinedsyncengines-offeredsyncengines",children:"declinedSyncEngines, offeredSyncEngines"}),"."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"sessionToken"})," - The current session token that can be used to interact with FxA's auth server."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"uid"})," - The user identifier."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"unwrapBKey"})," - Used to unwrap wrapWrapKB fetched from the server, resulting key is called kB. Keys derived from kB are used for data encryption for Sync, Send, and Notes."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"verified"})," - Is the user verified?"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"verifiedCanLinkAccount"})," - Has the user verified they want to link accounts, if signing into a different account than previously signed in to?"]}),"\n"]}),"\n",(0,a.jsx)(n.h4,{id:"capabilities",children:"capabilities"}),"\n",(0,a.jsx)(n.p,{children:"An object containing browser supported capabilities. Only available with browser support."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-js",children:"{\n  engines: [list of optional supported engines],\n  choose_what_to_sync : <boolean>[default: false],\n  multiService: <boolean>[default: false],\n  pairing: <boolean>\n}\n"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"engines"})," - A list of optional supported engines."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"choose_what_to_sync"})," - (OAuth WebChannel Only) - Whether to show the Choose What to Sync screen"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"multiService"})," - ",(0,a.jsx)(n.code,{children:"true"}),' if the user is signing into a "Sync Optional" flow where the user can sign into the browser but not enable Sync, e.g., about',":welcome"," or the protection report. ",(0,a.jsx)(n.code,{children:"false"})," if the user is signing into Sync."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"pairing"})," - Whether the browser can act as a pairing authority."]}),"\n"]}),"\n",(0,a.jsx)(n.h5,{id:"engines",children:"engines"}),"\n",(0,a.jsx)(n.p,{children:"A list of optional supported engines. If we are unsure whether an optional engine should be displayed, it will only be displayed if the engine is in the list."}),"\n",(0,a.jsx)(n.h6,{id:"possible-values-firefox-desktop",children:"Possible values (Firefox Desktop)"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.code,{children:"addresses"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.code,{children:"creditcards"})}),"\n"]}),"\n",(0,a.jsx)(n.h6,{id:"possible-values-oauth-webchannel-flow",children:"Possible values (OAuth WebChannel Flow)"}),"\n",(0,a.jsxs)(n.p,{children:["See ",(0,a.jsxs)(n.a,{href:"./webchannels-in-fenix-webextensions#engines-capability",children:[(0,a.jsx)(n.code,{children:"engines"})," capability in Fenix & WebExtensions"]}),"."]}),"\n",(0,a.jsx)(n.h4,{id:"declinedsyncengines-offeredsyncengines",children:"declinedSyncEngines, offeredSyncEngines"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.code,{children:"addons"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.code,{children:"addresses"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.code,{children:"bookmarks"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.code,{children:"creditcards"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.code,{children:"history"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.code,{children:"passwords"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.code,{children:"preferences"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.code,{children:"tabs"})}),"\n"]}),"\n",(0,a.jsx)(n.h4,{id:"signedinuser",children:"signedInUser"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"email"})," - User's email address"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"sessionToken"})," - The current session token that can be used to interact with FxA's auth server."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"uid"})," - The user identifier."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"verified"})," - Is the user verified?"]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"commandrequest-format",children:"Command/Request format"}),"\n",(0,a.jsx)(n.p,{children:"Each custom event is created as follows:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-js",children:"new CustomEvent('WebChannelMessageToChrome', {\n  detail: {\n    id: 'account_updates',\n    message: {\n      command: <command>,\n      data: <data>,\n      messageId: <message id>\n    }\n  }\n});\n"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"command"})," is one of the commands specified below."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"data"})," is an optional JavaScript object."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"messageId"})," is an opaque identifier that should be specified when responding to to a message."]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"response-format",children:"Response format"}),"\n",(0,a.jsxs)(n.p,{children:["Responses to FxA use the ",(0,a.jsx)(n.code,{children:"WebChannelMessageToContent"})," custom event, which is handled by the ",(0,a.jsx)(n.code,{children:"WebChannel.jsm"})," module's ",(0,a.jsxs)(n.a,{href:"https://searchfox.org/mozilla-central/source/services/fxaccounts/FxAccountsWebChannel.sys.mjs",children:[(0,a.jsx)(n.code,{children:"send"})," function"]}),". The ",(0,a.jsx)(n.code,{children:"message"})," parameter should the following format:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-js",children:"{\n  command: <command>,\n  data: <data>,\n  messageId: <message id>\n}\n"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"command"})," is one of the commands specified above."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"data"})," is an optional JavaScript object."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"messageId"})," is the message ID sent in the ",(0,a.jsx)(n.code,{children:"WebChannelMessageToChrome"})," custom event."]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"example-command-order-for-a-signinsignup",children:"Example command order for a signin/signup"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:["fxaccounts",":fxa_status"," (if supported)"]}),"\n",(0,a.jsxs)(n.li,{children:["fxaccounts",":loaded"]}),"\n",(0,a.jsxs)(n.li,{children:["fxaccounts",":can_link_account"]}),"\n",(0,a.jsxs)(n.li,{children:["fxaccounts",":login"]}),"\n",(0,a.jsxs)(n.li,{children:["fxaccounts",":email_verified"," (if supported)"]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"oauth-webchannels",children:"OAuth WebChannels"}),"\n",(0,a.jsx)(n.p,{children:"OAuth WebChannels is an extension of the FxA WebChannel Desktop Flow.\nIt consists of similar messages as the Desktop Sync flow, however is more generic because of the use\nof OAuth in the background. Some behaviours in the OAuth flow are different."}),"\n",(0,a.jsx)(n.p,{children:"This flow currently supports the following messages:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.code,{children:"fxaccounts:fxa_status"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.code,{children:"fxaccounts:oauth_login"})}),"\n"]}),"\n",(0,a.jsxs)(n.p,{children:["The ",(0,a.jsx)(n.code,{children:"fxaccounts:fxa_status"})," message in the OAuth flow supports specifying a custom list of Sync engines that the app supports.\nSee ",(0,a.jsx)(n.a,{href:"#engines",children:"engines"})," for details of engine capabilities."]}),"\n",(0,a.jsx)(n.h3,{id:"geckoview-applications",children:"GeckoView applications"}),"\n",(0,a.jsxs)(n.p,{children:["To enable this feature in applications with GeckoView we ship a WebExtension\nas part of the ",(0,a.jsx)(n.a,{href:"https://github.com/mozilla-mobile/android-components/blob/master/components/service/firefox-accounts/README.md",children:"firefox-accounts"})," Android component."]}),"\n",(0,a.jsx)(n.p,{children:"Communication channel is established from web content to this class via webextension, as follows:"}),"\n",(0,a.jsx)(n.mermaid,{value:"sequenceDiagram\n  participant fxa as FxA web content\n  participant glue as glue - fxawebchannel.js\n  participant webext as Web Extension\n\n  fxa--\x3e>glue: WebChannelMessageToChrome JS Event\n  glue--\x3e>webext: Port message\n  webext--\x3e>glue: Port message\n  glue--\x3e>fxa: WebChannelMessageToContent JS Event"}),"\n",(0,a.jsx)(n.mermaid,{value:"sequenceDiagram\n  participant fxa as FxA web content\n  participant browser as Browser\n\n  fxa--\x3e>browser: fxa-status - request account status & device capabilities\n  browser--\x3e>fxa: response-based on state of [accountManager]\n  fxa->>fxa: user authenticates/authorizes\n  fxa--\x3e>browser: oauth-login - send OAuth code, state, syncEngine info"}),"\n",(0,a.jsx)(n.h3,{id:"commands-1",children:"Commands"}),"\n",(0,a.jsxs)(n.h4,{id:"fxaccounts-8",children:["fxaccounts",":fxa_status"]}),"\n",(0,a.jsxs)(n.p,{children:["See the ",(0,a.jsxs)(n.a,{href:"#fxaccountsfxa_status",children:["fxaccounts",":fxa_status"," section"]})," of the WebChannel Protocol document."]}),"\n",(0,a.jsxs)(n.h5,{id:"engines-capability",children:[(0,a.jsx)(n.code,{children:"engines"})," capability"]}),"\n",(0,a.jsxs)(n.p,{children:["Unlike the Desktop WebChannel integration, the OAuth WebChannel integration expects all supported\nengines to be enumerated within the ",(0,a.jsx)(n.code,{children:"engines"})," capability. Possible values are:"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.code,{children:"addons"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.code,{children:"addresses"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.code,{children:"bookmarks"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.code,{children:"creditcards"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.code,{children:"history"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.code,{children:"passwords"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.code,{children:"preferences"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.code,{children:"tabs"})}),"\n"]}),"\n",(0,a.jsxs)(n.h4,{id:"fxaccounts-9",children:["fxaccounts",":oauth_login"]}),"\n",(0,a.jsx)(n.p,{children:"Sent when a user successfully authenticates via a WebChannel OAuth flow."}),"\n",(0,a.jsx)(n.h5,{id:"data-7",children:"data"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-js",children:'{\n  "code": "02f3cfea84ac4c143662b38d6c7f0c82c6f91eb041befc7cecda446b1b4887c1",\n  "state": "vHao1p6OizzwReCkQMSpZA",\n  "redirect": "urn:ietf:wg:oauth:2.0:oob:oauth-redirect-webchannel",\n  "action": "signin",\n  "declinedSyncEngines": ["history"],\n  "offeredSyncEngines": ["history"]\n}\n'})}),"\n",(0,a.jsx)(n.h5,{id:"support",children:"support"}),"\n",(0,a.jsxs)(n.p,{children:["Supported by ",(0,a.jsx)(n.code,{children:"oauth_webchannel_v1"})," context."]})]})}function h(e={}){const{wrapper:n}={...(0,c.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(o,{...e})}):o(e)}}}]);