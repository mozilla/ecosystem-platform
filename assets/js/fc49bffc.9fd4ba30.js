"use strict";(self.webpackChunkfirefox_ecosystem_platform=self.webpackChunkfirefox_ecosystem_platform||[]).push([[4462],{9346:(e,i,s)=>{s.r(i),s.d(i,{assets:()=>a,contentTitle:()=>l,default:()=>h,frontMatter:()=>r,metadata:()=>o,toc:()=>c});const o=JSON.parse('{"id":"reference/metrics","title":"Metrics","description":"Last updated: Oct 6th, 2023","source":"@site/docs/reference/metrics.md","sourceDirName":"reference","slug":"/reference/metrics","permalink":"/ecosystem-platform/reference/metrics","draft":false,"unlisted":false,"editUrl":"https://github.com/mozilla/ecosystem-platform/edit/master/docs/reference/metrics.md","tags":[],"version":"current","frontMatter":{"title":"Metrics"},"sidebar":"docs","previous":{"title":"Localization","permalink":"/ecosystem-platform/reference/localization"},"next":{"title":"Mobile Specifics","permalink":"/ecosystem-platform/reference/mobile-specifics"}}');var t=s(74848),n=s(28453);const r={title:"Metrics"},l=void 0,a={},c=[{value:"Application metrics",id:"application-metrics",level:2},{value:"Submitting a Data Review request",id:"submitting-a-data-review-request",level:3},{value:"Working with Raw Logs",id:"working-with-raw-logs",level:3},{value:"Crashes",id:"crashes",level:2},{value:"Server Health",id:"server-health",level:2},{value:"Front-end Performance",id:"front-end-performance",level:2},{value:"Subscription product metrics",id:"subscription-product-metrics",level:2},{value:"Looker",id:"looker",level:3},{value:"Dashboards",id:"dashboards",level:4},{value:"Subscription Platform &gt; Logical Subscription(s) explores",id:"subscription-platform--logical-subscriptions-explores",level:4},{value:"Mozilla accounts &gt; All Event Counts explores",id:"mozilla-accounts--all-event-counts-explores",level:4},{value:"How to inspect the underlying data from an explore or look",id:"how-to-inspect-the-underlying-data-from-an-explore-or-look",level:4}];function d(e){const i={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",h3:"h3",h4:"h4",img:"img",li:"li",ol:"ol",p:"p",ul:"ul",...(0,n.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(i.p,{children:["Last updated: ",(0,t.jsx)(i.code,{children:"Oct 6th, 2023"})]}),"\n",(0,t.jsx)(i.p,{children:"Mozilla accounts collects metrics from servers running our code and clients accessing our services.  Mozilla takes data collection seriously so our policies and processes around it may seem more complex than most organizations but it is in an effort to grant agency to users over their own data."}),"\n",(0,t.jsxs)(i.p,{children:["Note that the ",(0,t.jsx)(i.a,{href:"https://wiki.mozilla.org/Data_Collection",children:"Mozilla Data Collection policies"})," apply to Mozilla accounts."]}),"\n",(0,t.jsx)(i.p,{children:"Our code is deployed to a staging environment before it goes to production so the metrics detailed below are available for both environments.  The details below will focus mostly on production."}),"\n",(0,t.jsx)(i.p,{children:"Keep in mind that Mozilla accounts allows users to opt-out of data collection via a toggle on the account settings page."}),"\n",(0,t.jsxs)(i.p,{children:["We also have a ",(0,t.jsx)(i.a,{href:"../explanation/metrics",children:"metrics section which expands on the history of our system and how these are implemented"}),"."]}),"\n",(0,t.jsx)(i.h2,{id:"application-metrics",children:"Application metrics"}),"\n",(0,t.jsx)(i.admonition,{type:"note",children:(0,t.jsx)(i.p,{children:"This is all undergoing major changes now with the move to GCP as well as FxA's migration to using Glean.  Hopefully we can remove this message in 2024 and simplify these docs, though it is unclear if/when SubPlat will migrate to using Glean."})}),"\n",(0,t.jsx)(i.p,{children:"These are logs from Mozilla accounts code.  These are probably the most useful logs for product decision making as they were written by hand by engineers.  They are also the most complex."}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:["Example data recorded","\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:["See the ",(0,t.jsx)(i.a,{href:"https://docs.telemetry.mozilla.org/datasets/fxa.html",children:"taxonomies in the Mozilla Data Docs"}),"."]}),"\n",(0,t.jsxs)(i.li,{children:["As we move to Glean the dictionaries here will remain up to date automatically:  ",(0,t.jsx)(i.a,{href:"https://dictionary.telemetry.mozilla.org/apps/accounts_frontend",children:"Frontend"})," and ",(0,t.jsx)(i.a,{href:"https://dictionary.telemetry.mozilla.org/apps/accounts_backend",children:"Backend"})]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(i.li,{children:["Recorded with","\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:["\n",(0,t.jsxs)(i.p,{children:["These are logged via ",(0,t.jsx)(i.a,{href:"https://github.com/mozilla/mozlog/",children:"mozlog"})," as regular server logs."]}),"\n"]}),"\n",(0,t.jsxs)(i.li,{children:["\n",(0,t.jsxs)(i.p,{children:["The logs are immediately ingested into ",(0,t.jsx)(i.a,{href:"https://cloud.google.com/logging",children:"GCP Cloud Logging"})]}),"\n"]}),"\n",(0,t.jsxs)(i.li,{children:["\n",(0,t.jsxs)(i.p,{children:["From there they are passed and stored in BigQuery in the ",(0,t.jsx)(i.code,{children:"moz-fx-fxa-prod.gke-fx-fxa-prod"})," or ",(0,t.jsx)(i.code,{children:"moz-fx-fxa-nonprod.gke-fx-fxa-stage"})," projects depending on which environment they are coming out of.  These projects are relatively restricted and not for general consumption."]}),"\n"]}),"\n",(0,t.jsxs)(i.li,{children:["\n",(0,t.jsxs)(i.p,{children:["Every 24 hours, ",(0,t.jsx)(i.a,{href:"https://github.com/mozilla/bigquery-etl/tree/main/sql/moz-fx-data-shared-prod/firefox_accounts_derived",children:"some ETL jobs"})," run which create derived tables from the original logs and store them in the ",(0,t.jsx)(i.code,{children:"mozdata"})," project in BigQuery.  ",(0,t.jsx)(i.code,{children:"mozdata"})," is accessible by anyone at Mozilla.  Please note: ",(0,t.jsx)(i.em,{children:"Derived tables do not include all the events or details in the original logs.  You can read the queries that create the derived tables to see what is included."})]}),"\n"]}),"\n",(0,t.jsxs)(i.li,{children:["\n",(0,t.jsxs)(i.p,{children:["Additionally, there are some ",(0,t.jsx)(i.a,{href:"https://github.com/mozilla/bigquery-etl/tree/main/sql/moz-fx-data-shared-prod/firefox_accounts",children:"user-facing datasets"})," of that same data, and also in ",(0,t.jsx)(i.code,{children:"mozdata"}),", which are designed to be easier to use."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(i.li,{children:["Accessible via","\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.a,{href:"https://console.cloud.google.com/bigquery?",children:"BigQuery"}),".  Look for the ",(0,t.jsx)(i.code,{children:"firefox_accounts"})," dataset in the ",(0,t.jsx)(i.code,{children:"mozdata"})," project.  ",(0,t.jsx)(i.em,{children:"Be aware that there are large amounts of data in BigQuery and you can spend a lot of money if you don't restrict your queries."})]}),"\n",(0,t.jsxs)(i.li,{children:["Looker is backed by BigQuery and there is a ",(0,t.jsx)(i.a,{href:"https://mozilla.cloud.looker.com/folders/374",children:"Mozilla accounts folder"})," there.","\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:["Subscription Platform dashboards are located in the ",(0,t.jsx)(i.a,{href:"https://mozilla.cloud.looker.com/folders/1355",children:"Subscription Platform folder"}),". See also ",(0,t.jsx)(i.a,{href:"#subscription-product-metrics",children:"Subscription product metrics"}),"."]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(i.li,{children:["There are ",(0,t.jsx)(i.a,{href:"https://earthangel-b40313e5.influxcloud.net/?orgId=1&search=open&query=fxa",children:"several dashboards in grafana"})," with a mix of these metrics on them"]}),"\n",(0,t.jsx)(i.li,{children:"See the section below about raw logs also"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(i.h3,{id:"submitting-a-data-review-request",children:"Submitting a Data Review request"}),"\n",(0,t.jsx)(i.p,{children:"Before new metrics can be collected with Glean, they must pass the Data Review process."}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsx)(i.li,{children:"Create a github issue with the data review request with the Data Review template"}),"\n",(0,t.jsxs)(i.li,{children:["Directly contact ",(0,t.jsx)(i.a,{href:"https://wiki.mozilla.org/Data_Collection",children:"a member of the Data Review stewards"}),", or request a review in the #data-stewardship-help channel."]}),"\n",(0,t.jsx)(i.li,{children:"Create a PR containing the changes that will record the data. Do not merge the PR until the Data Review request has been approved."}),"\n"]}),"\n",(0,t.jsx)(i.h3,{id:"working-with-raw-logs",children:"Working with Raw Logs"}),"\n",(0,t.jsxs)(i.p,{children:["If you need real-time data you need to be looking at the raw logs in ",(0,t.jsx)(i.code,{children:"moz-fx-fxa-prod.gke-fx-fxa-prod"})," or ",(0,t.jsx)(i.code,{children:"moz-fx-fxa-nonprod.gke-fx-fxa-stage"}),".  Otherwise there will be a 24 hour delay.  We don't run our normal metrics out of those logs because it is too expensive and slow."]}),"\n",(0,t.jsxs)(i.p,{children:["As noted above, these datasets are restricted but if you have access you'll find each package logging to those datasets in either the ",(0,t.jsx)(i.code,{children:"stderr"})," or ",(0,t.jsx)(i.code,{children:"stdout"})," tables.  You can (and should) filter your queries by the package.  For example, to only look at logs from ",(0,t.jsx)(i.code,{children:"fxa-customs-server"})," we would filter where ",(0,t.jsx)(i.code,{children:'labels.k8s_pod_deployment="customs" AND resource.labels.container_name="customs"'}),".  This will capture the pod name and the container name.  We need to filter on both because each pod runs the package as well as nginx."]}),"\n",(0,t.jsx)(i.h2,{id:"crashes",children:"Crashes"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:["Example data recorded:","\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.code,{children:"t is undefined"})," and a link to the JS that failed to run"]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.code,{children:"An internal validation check failed."})," and details about what the software expected to see and what it actually saw"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(i.li,{children:["Recorded with","\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsx)(i.li,{children:"Sentry"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(i.li,{children:["Accessible via","\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsx)(i.li,{children:(0,t.jsx)(i.a,{href:"https://sentry.prod.mozaws.net/operations/",children:"Sentry"})}),"\n",(0,t.jsxs)(i.li,{children:["Look for any project starting with ",(0,t.jsx)(i.code,{children:"fxa-"}),".  Eg. ",(0,t.jsx)(i.code,{children:"fxa-auth-prod"})," and ",(0,t.jsx)(i.code,{children:"fxa-content-client-prod"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(i.h2,{id:"server-health",children:"Server Health"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:["Example data recorded","\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsx)(i.li,{children:"There are 30 healthy hosts running"}),"\n",(0,t.jsx)(i.li,{children:"A host is running at 100% cpu"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(i.li,{children:["Recorded with","\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsx)(i.li,{children:"The reporting tools built into the clouds we use"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(i.li,{children:["Accessible via","\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:["In their most detailed form, you'd need access to the cloud consoles themselves, but most of the data is also available in our Grafana instance.  ",(0,t.jsx)(i.a,{href:"https://earthangel-b40313e5.influxcloud.net/d/HqOQKXoZk/fxa-auth-prod-elb?orgId=1",children:"Here is one of our dashboards hitting CloudWatch for metrics"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(i.h2,{id:"front-end-performance",children:"Front-end Performance"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:["Example data recorded","\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:["It took 400ms to load ",(0,t.jsx)(i.code,{children:"/settings"})]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(i.li,{children:["Recorded with","\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:["As of this writing we record the data using our own library (which maybe isn't totally accurate) and write the data via ",(0,t.jsx)(i.code,{children:"statsd"})," which ends up in influxdb.  We expect to move to ",(0,t.jsx)(i.a,{href:"https://sentry.io/for/performance/",children:"Sentry Performance"})," soon"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(i.li,{children:["Accessible via","\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:["Look for the ",(0,t.jsx)(i.code,{children:"svcops_aws"})," project in Grafana.  ",(0,t.jsx)(i.a,{href:"https://earthangel-b40313e5.influxcloud.net/d/1tthDDrWk/content-server?orgId=1",children:"Here is a dashboard with some examples"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(i.h2,{id:"subscription-product-metrics",children:"Subscription product metrics"}),"\n",(0,t.jsxs)(i.p,{children:["These are a combination of ",(0,t.jsx)(i.a,{href:"#application-metrics",children:"application metrics"})," and metrics more directly from subscription providers like Stripe, Apple and Google to answer product questions as initially specified by the ",(0,t.jsx)(i.a,{href:"https://docs.google.com/document/d/1AL8BSlHuxABypDdQSoaiMuo6H1pmintj1Loh6oesxZU/edit?usp=sharing",children:"PRD"})," and ",(0,t.jsx)(i.a,{href:"https://docs.google.com/document/d/1-KdXzZbn3Utw2aekJbcc1lrMV9tNb19tzifPbdtQaso/edit?usp=sharing",children:"Technical Specification"})," for ",(0,t.jsx)(i.a,{href:"https://mozilla-hub.atlassian.net/browse/FXA-6556",children:"FXA-6556"}),"."]}),"\n",(0,t.jsxs)(i.p,{children:["For high level information from the RP perspective, see ",(0,t.jsx)(i.a,{href:"/ecosystem-platform/relying-parties/how-tos/product-metrics",children:"Metrics for Relying Parties"}),"."]}),"\n",(0,t.jsx)(i.h3,{id:"looker",children:"Looker"}),"\n",(0,t.jsxs)(i.p,{children:[(0,t.jsx)(i.a,{href:"https://mozilla.cloud.looker.com",children:"Looker"})," is the business intelligence tool Mozilla uses to report on product metrics, and we have SubPlat dashboards there based on Logical Subscription(s) and All Event Counts explores created and maintained by our data engineering team."]}),"\n",(0,t.jsx)(i.h4,{id:"dashboards",children:"Dashboards"}),"\n",(0,t.jsxs)(i.p,{children:["Anyone at Mozilla can view the SubPlat Looker dashboards, which are in the ",(0,t.jsx)(i.a,{href:"https://mozilla.cloud.looker.com/folders/1355",children:"Subscription Platform"})," folder and include:"]}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsx)(i.li,{children:(0,t.jsx)(i.a,{href:"https://mozilla.cloud.looker.com/dashboards/1329",children:"SubPlat Subscriptions"})}),"\n",(0,t.jsx)(i.li,{children:(0,t.jsx)(i.a,{href:"https://mozilla.cloud.looker.com/dashboards/1371",children:"SubPlat Checkout"})}),"\n"]}),"\n",(0,t.jsxs)(i.p,{children:["To obtain edit access, ask SubPlat's engineering manager to request it in the ",(0,t.jsxs)(i.a,{href:"https://app.slack.com/client/T027LFU12/C4D5ZA91B",children:[(0,t.jsx)(i.code,{children:"#data-help"})," Slack channel"]}),"."]}),"\n",(0,t.jsxs)(i.p,{children:["Grafana dashboards have been moved to ",(0,t.jsx)(i.a,{href:"https://yardstick.mozilla.org",children:"Yardstick"})]}),"\n",(0,t.jsxs)(i.p,{children:["To obtain edit access for Yardstick dashboards, ",(0,t.jsx)(i.a,{href:"https://mozilla-hub.atlassian.net/wiki/spaces/CS1/pages/886866077/Prometheus+and+Grafana+Yardstick#How-to%3A-Requesting-editor-access",children:"see the instructions on the Prometheus and Grafana Confluence page"})]}),"\n",(0,t.jsx)(i.h4,{id:"subscription-platform--logical-subscriptions-explores",children:"Subscription Platform > Logical Subscription(s) explores"}),"\n",(0,t.jsx)(i.p,{children:"There are currently four Logical Subscription(s) explores:"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.a,{href:"https://mozilla.cloud.looker.com/explore/subscription_platform/daily_active_logical_subscriptions",children:"Daily Active Logical Subscriptions"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsx)(i.li,{children:"Represents all the subscriptions that were active at any point on a certain date."}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.a,{href:"https://mozilla.cloud.looker.com/explore/subscription_platform/monthly_active_logical_subscriptions",children:"Monthly Active Logical Subscriptions"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsx)(i.li,{children:"Represents all the subscriptions that were active at any point during a certain month."}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.a,{href:"https://mozilla.cloud.looker.com/explore/subscription_platform/logical_subscription_events",children:"Logical Subscription Events"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsx)(i.li,{children:"Represents changes we see to a subscription over time, i.e. lifecycle events such as start, end, cancel or plan change."}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.a,{href:"https://mozilla.cloud.looker.com/explore/subscription_platform/logical_subscriptions",children:"Logical Subscriptions"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsx)(i.li,{children:"Represents the current state of subscriptions, including all subscriptions that have ended."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(i.p,{children:["Data sources for these explores are described in ",(0,t.jsx)(i.a,{href:"/ecosystem-platform/relying-parties/reference/metrics-for-relying-parties",children:"Metrics for Relying Parties"}),"."]}),"\n",(0,t.jsxs)(i.p,{children:["More information can be found in the ",(0,t.jsx)(i.a,{href:"https://docs.google.com/document/d/13TgTN7UJ_89dhh0S64eh0oDsYNHPdeJyEmLk0uScoGI/edit?usp=sharing",children:"SubPlat consolidated reporting ETL design document"})," and from these ",(0,t.jsx)(i.a,{href:"https://docs.google.com/document/d/1-K9TtkKHezL-Xo6LcGxd866TkAaeRzQqdXNx9PJQnNE/edit#bookmark=id.7eo8irobcj0k",children:"walkthrough notes"}),"."]}),"\n",(0,t.jsx)(i.admonition,{type:"note",children:(0,t.jsx)(i.p,{children:"Logical subscriptions reflect one subscription per Stripe subscription item. So if a single Stripe subscription has two subscription items, this would be two separate logical subscriptions in these explores. This is in anticipation of potential support in the future for consolidated billing where each subscription item is effectively a separate subscription billed with a single invoice."})}),"\n",(0,t.jsx)(i.h4,{id:"mozilla-accounts--all-event-counts-explores",children:"Mozilla accounts > All Event Counts explores"}),"\n",(0,t.jsxs)(i.p,{children:["These data are events pulled out of FxA application logs (see ",(0,t.jsx)(i.a,{href:"#application-metrics",children:"Application metrics"}),"). There is currently one explore that we use for the SubPlat dashboard: ",(0,t.jsx)(i.a,{href:"https://mozilla.cloud.looker.com/explore/firefox_accounts/all_event_counts",children:"All Event Counts"}),"."]}),"\n",(0,t.jsx)(i.h4,{id:"how-to-inspect-the-underlying-data-from-an-explore-or-look",children:"How to inspect the underlying data from an explore or look"}),"\n",(0,t.jsxs)(i.p,{children:["As explained in ",(0,t.jsx)(i.a,{href:"#application-metrics",children:"Application metrics"}),", the data for these explores comes from ETL jobs where data exists in various tables in BigQuery. Here's how you can find out more information about a particular dimension in a Looker Look or Explore."]}),"\n",(0,t.jsxs)(i.ol,{children:["\n",(0,t.jsxs)(i.li,{children:['Find the Look or Explore you want to inspect in Looker. For a Look in a dashboard, click "Explore from here" from the Look\'s overflow menu. E.g. navigate to the ',(0,t.jsx)(i.a,{href:"https://mozilla.cloud.looker.com/explore/subscription_platform/monthly_active_logical_subscriptions",children:"Monthly Active Logical Subscriptions"})," explore."]}),"\n",(0,t.jsx)(i.li,{children:'In the Explore view in Looker, in the left sidebar, hover over the dimension of interest (e.g. Monthly Active Logical Subscriptions > Subscription > Auto Renew) and click the Info icon, then click "Go to LookML".'}),"\n",(0,t.jsxs)(i.li,{children:["You'll be brought to a new page displaying the ",(0,t.jsx)(i.code,{children:"view"})," file. Here you can inspect which table the data came from in the ",(0,t.jsx)(i.code,{children:"mozdata"})," GCP project. Often this can be found by searching for ",(0,t.jsx)(i.code,{children:"sql_table_name"}),". E.g. ",(0,t.jsx)(i.code,{children:"mozdata.subscription_platform.monthly_active_logical_subscriptions"}),"."]}),"\n",(0,t.jsxs)(i.li,{children:["Now you have one of two choices, though the easiest is likely to search the data catalog (",(0,t.jsx)(i.a,{href:"https://mozilla.acryl.io/",children:"Acryl"}),") for this dataset by name. The dot notation indicates the namespaces you'll find the table under, with the last value being the table name (e.g. ",(0,t.jsx)(i.code,{children:"monthly_active_logical_subscriptions"}),").","\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:["Search for the table name in Acryl.","\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:["Select the Datasets > BigQuery > ",(0,t.jsx)(i.code,{children:"mozdata"})," > ",(0,t.jsx)(i.code,{children:"subscription_platform"})," result. ",(0,t.jsx)(i.code,{children:"mozdata"})," is a GCP project in BigQuery with metrics for lots of Mozilla products and services."]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(i.li,{children:'Click the "Lineage" tab'}),"\n",(0,t.jsx)(i.li,{children:'Click "Visualize Lineage"'}),"\n",(0,t.jsxs)(i.li,{children:["Continue to click the ",(0,t.jsx)(i.code,{children:"+"})," icons to the left of the table in question to find upstream tables, until you reach the origin table."]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(i.li,{children:["As we can see from the diagram below, we may find how this dimension is set from the ",(0,t.jsx)(i.code,{children:"stripe_logical_subscriptions_history_v1"})," table. Looking ",(0,t.jsxs)(i.a,{href:"https://github.com/mozilla/bigquery-etl/blob/de71eac14d195c5abaf62abd485f2e0a0ca9c75a/sql/moz-fx-data-shared-prod/subscription_platform_derived/stripe_logical_subscriptions_history_v1/query.sql#L185",children:["that table up in the ",(0,t.jsx)(i.code,{children:"bigquery-etl"})," repo"]}),", we can confirm this."]}),"\n"]}),"\n",(0,t.jsx)(i.p,{children:(0,t.jsx)(i.img,{src:s(65755).A+"",width:"3426",height:"1954"})}),"\n",(0,t.jsxs)(i.p,{children:["The other option is to search for the queries (i.e. ",(0,t.jsx)(i.code,{children:"query.sql"})," files) that create these tables in the ",(0,t.jsxs)(i.a,{href:"https://github.com/mozilla/bigquery-etl/",children:[(0,t.jsx)(i.code,{children:"bigquery-etl"})," repo"]})," with a series of reverse look-ups."]}),"\n",(0,t.jsxs)(i.ol,{children:["\n",(0,t.jsxs)(i.li,{children:["Search for the table name (e.g. ",(0,t.jsx)(i.code,{children:"monthly_active_logical_subscriptions"}),")"]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.code,{children:"moz-fx-data-shared-prod.subscription_platform.monthly_active_logical_subscriptions"})," pulls from:"]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.code,{children:"moz-fx-data-shared-prod.subscription_platform_derived.monthly_active_logical_subscriptions_v1"})," pulls from:"]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.code,{children:"moz-fx-data-shared-prod.subscription_platform_derived.daily_active_logical_subscriptions_v1"})," pulls from:"]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.code,{children:"moz-fx-data-shared-prod.subscription_platform_derived.logical_subscriptions_history_v1"})," pulls from:"]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.code,{children:"moz-fx-data-shared-prod.subscription_platform_derived.stripe_logical_subscriptions_history_v1"})," pulls from:"]}),"\n",(0,t.jsxs)(i.li,{children:["Finally! ",(0,t.jsx)(i.a,{href:"https://github.com/mozilla/bigquery-etl/blob/de71eac14d195c5abaf62abd485f2e0a0ca9c75a/sql/moz-fx-data-shared-prod/subscription_platform_derived/stripe_logical_subscriptions_history_v1/query.sql#L185",children:"We've found how this dimension is set"})," from the table in the previous step."]}),"\n"]}),"\n",(0,t.jsx)(i.admonition,{type:"note",children:(0,t.jsx)(i.p,{children:"A given query can pull from multiple tables, so the lineage for a given table is not necessarily linear and more likely branches. See example lineage from the data catalog image above."})})]})}function h(e={}){const{wrapper:i}={...(0,n.R)(),...e.components};return i?(0,t.jsx)(i,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},28453:(e,i,s)=>{s.d(i,{R:()=>r,x:()=>l});var o=s(96540);const t={},n=o.createContext(t);function r(e){const i=o.useContext(n);return o.useMemo(function(){return"function"==typeof e?e(i):{...i,...e}},[i,e])}function l(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:r(e.components),o.createElement(n.Provider,{value:i},e.children)}},65755:(e,i,s)=>{s.d(i,{A:()=>o});const o=s.p+"assets/images/data_catalog_example-56db3387e4ea06655e30f5bd3019c9aa.png"}}]);