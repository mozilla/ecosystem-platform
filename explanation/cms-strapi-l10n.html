<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-explanation/cms-strapi-l10n" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.1">
<title data-rh="true">Localization Workflow | Firefox Ecosystem Platform</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://mozilla.github.io/ecosystem-platform/explanation/cms-strapi-l10n"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Localization Workflow | Firefox Ecosystem Platform"><meta data-rh="true" name="description" content="Last updated: Aug 25th, 2025"><meta data-rh="true" property="og:description" content="Last updated: Aug 25th, 2025"><link data-rh="true" rel="icon" href="/ecosystem-platform/img/firefox-logo.png"><link data-rh="true" rel="canonical" href="https://mozilla.github.io/ecosystem-platform/explanation/cms-strapi-l10n"><link data-rh="true" rel="alternate" href="https://mozilla.github.io/ecosystem-platform/explanation/cms-strapi-l10n" hreflang="en"><link data-rh="true" rel="alternate" href="https://mozilla.github.io/ecosystem-platform/explanation/cms-strapi-l10n" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://RFM5H13DFK-dsn.algolia.net" crossorigin="anonymous"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Localization Workflow","item":"https://mozilla.github.io/ecosystem-platform/explanation/cms-strapi-l10n"}]}</script><link rel="search" type="application/opensearchdescription+xml" title="Firefox Ecosystem Platform" href="/ecosystem-platform/opensearch.xml"><link rel="stylesheet" href="/ecosystem-platform/assets/css/styles.6b629fdc.css">
<script src="/ecosystem-platform/assets/js/runtime~main.16dde052.js" defer="defer"></script>
<script src="/ecosystem-platform/assets/js/main.641b342b.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")),document.documentElement.setAttribute("data-theme-choice",t||"system")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/ecosystem-platform/img/firefox-logo.png"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/ecosystem-platform/"><div class="navbar__logo"><img src="/ecosystem-platform/img/firefox-logo.png" alt="Ecosystem Platform Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/ecosystem-platform/img/firefox-logo.png" alt="Ecosystem Platform Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Firefox Ecosystem Platform</b></a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/mozilla/ecosystem-platform" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Meta+k)" aria-keyshortcuts="Meta+k"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 24 24" aria-hidden="true"><circle cx="11" cy="11" r="8" stroke="currentColor" fill="none" stroke-width="1.4"></circle><path d="m21 21-4.3-4.3" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/ecosystem-platform/"><span title="Introduction" class="linkLabel_WmDU">Introduction</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link"><span title="For Relying Parties" class="categoryLinkLabel_W154">For Relying Parties</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/ecosystem-platform/relying-parties/tutorials/integration-with-fxa"><span title="Tutorials" class="categoryLinkLabel_W154">Tutorials</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/ecosystem-platform/relying-parties/how-tos/end-to-end-encryption"><span title="How-to Guides" class="categoryLinkLabel_W154">How-to Guides</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/ecosystem-platform/relying-parties/reference/glossary"><span title="Reference" class="categoryLinkLabel_W154">Reference</span></a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--active"><span title="For FxA Engineers" class="categoryLinkLabel_W154">For FxA Engineers</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/ecosystem-platform/tutorials/development-setup"><span title="Tutorials" class="categoryLinkLabel_W154">Tutorials</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/ecosystem-platform/how-tos/ci-guidelines"><span title="How-to Guides" class="categoryLinkLabel_W154">How-to Guides</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/ecosystem-platform/reference/team-processes/development-process"><span title="Reference" class="categoryLinkLabel_W154">Reference</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/ecosystem-platform/explanation/architectural-decision-records"><span title="Explanation" class="categoryLinkLabel_W154">Explanation</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/explanation/architectural-decision-records"><span title="Architectural Decision Records" class="linkLabel_WmDU">Architectural Decision Records</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/explanation/content-server-architecture"><span title="Content-server architecture" class="linkLabel_WmDU">Content-server architecture</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/explanation/onepw-protocol"><span title="onepw Protocol" class="linkLabel_WmDU">onepw Protocol</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/explanation/pairing-flow-architecture"><span title="Pairing Flow Architecture" class="linkLabel_WmDU">Pairing Flow Architecture</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/explanation/scoped-keys"><span title="Scoped Keys" class="linkLabel_WmDU">Scoped Keys</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/ecosystem-platform/explanation/cms-strapi-l10n"><span title="Localization Workflow" class="linkLabel_WmDU">Localization Workflow</span></a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/additional-docs"><span title="Additional Docs" class="linkLabel_WmDU">Additional Docs</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link"><span title="For Support Agents" class="categoryLinkLabel_W154">For Support Agents</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/ecosystem-platform/reference/admin-panel"><span title="Reference" class="categoryLinkLabel_W154">Reference</span></a></div></li></ul></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/ecosystem-platform/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">For FxA Engineers</span></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Explanation</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Localization Workflow</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Localization Workflow</h1></header><p>Last updated: <code>Aug 25th, 2025</code></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="overview">Overview<a href="#overview" class="hash-link" aria-label="Direct link to Overview" title="Direct link to Overview" translate="no">​</a></h2>
<p>This document describes the complete localization workflow for Mozilla Accounts (FxA), covering how content changes in Strapi CMS trigger automated localization processes, and how localized content is delivered to users at runtime.</p>
<p>The Mozilla Accounts localization system enables dynamic, localized user experiences by integrating Strapi CMS, GitHub, Pontoon, and runtime content delivery. The workflow ensures that content changes are automatically processed for localization and efficiently delivered to users with proper caching and error handling.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="architecture-components">Architecture Components<a href="#architecture-components" class="hash-link" aria-label="Direct link to Architecture Components" title="Direct link to Architecture Components" translate="no">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="core-components">Core Components<a href="#core-components" class="hash-link" aria-label="Direct link to Core Components" title="Direct link to Core Components" translate="no">​</a></h3>
<ol>
<li><strong>Strapi CMS</strong>: Headless CMS for managing relying party configurations</li>
<li><strong>fxa-auth-server</strong> (<code>cms.ts</code>): API layer handling CMS requests and webhook processing</li>
<li><strong>fxa-shared</strong> (<code>relying-party-configuration-manager.ts</code>): Configuration management with caching</li>
<li><strong>fxa-settings</strong> (<code>getCmsInfo</code>): Frontend integration for localized content</li>
<li><strong>GitHub</strong>: Version control and FTL file storage</li>
<li><strong>Pontoon</strong>: Mozilla&#x27;s localization platform</li>
<li><strong>FTL (Fluent Translation List)</strong>: Localization file format</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="workflow-diagram">Workflow Diagram<a href="#workflow-diagram" class="hash-link" aria-label="Direct link to Workflow Diagram" title="Direct link to Workflow Diagram" translate="no">​</a></h2>
<!-- -->
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="detailed-workflow-steps">Detailed Workflow Steps<a href="#detailed-workflow-steps" class="hash-link" aria-label="Direct link to Detailed Workflow Steps" title="Direct link to Detailed Workflow Steps" translate="no">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-content-creation-and-publishing">1. Content Creation and Publishing<a href="#1-content-creation-and-publishing" class="hash-link" aria-label="Direct link to 1. Content Creation and Publishing" title="Direct link to 1. Content Creation and Publishing" translate="no">​</a></h3>
<p><strong>Location</strong>: Strapi CMS</p>
<p><strong>Participants</strong>: Content editors, marketing teams</p>
<ol>
<li>Content creators log into Strapi CMS</li>
<li>Create or modify relying party configurations</li>
<li>Content includes localizable fields like headlines, descriptions, button text</li>
<li>Content is published, triggering the webhook system</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-webhook-processing-and-ftl-generation">2. Webhook Processing and FTL Generation<a href="#2-webhook-processing-and-ftl-generation" class="hash-link" aria-label="Direct link to 2. Webhook Processing and FTL Generation" title="Direct link to 2. Webhook Processing and FTL Generation" translate="no">​</a></h3>
<p><strong>Location</strong>: <code>packages/fxa-auth-server/lib/routes/cms.ts:178-297</code></p>
<p><strong>Participants</strong>: Webhook handler, GitHub API</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="webhook-validation">Webhook Validation<a href="#webhook-validation" class="hash-link" aria-label="Direct link to Webhook Validation" title="Direct link to Webhook Validation" translate="no">​</a></h4>
<div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Webhook authorization is verified using timing-safe comparison</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> authHeader </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> request</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">headers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">authorization</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">!</span><span class="token plain">crypto</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">timingSafeEqual</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Buffer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">from</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">authHeader</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Buffer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">from</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">this</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">config</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">cmsl10n</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">strapiWebhook</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">secret</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">throw</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Error</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;Invalid authorization header&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="ftl-generation-process">FTL Generation Process<a href="#ftl-generation-process" class="hash-link" aria-label="Direct link to FTL Generation Process" title="Direct link to FTL Generation Process" translate="no">​</a></h4>
<p><strong>Location</strong>: <code>packages/fxa-auth-server/lib/routes/utils/cms/localization.ts:110-192</code></p>
<ol>
<li><strong>Fetch All Entries</strong>: Query Strapi for all published relying party entries</li>
<li><strong>Extract Localizable Content</strong>: Filter out non-localizable fields (IDs, dates, URLs, colors)</li>
<li><strong>Generate FTL Format</strong>: Convert extracted strings to Fluent format with unique identifiers</li>
<li><strong>Create GitHub PR</strong>: Either update existing PR or create new branch and PR</li>
</ol>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="ftl-format-example">FTL Format Example<a href="#ftl-format-example" class="hash-link" aria-label="Direct link to FTL Format Example" title="Direct link to FTL Format Example" translate="no">​</a></h4>
<div class="language-ftl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-ftl codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">### Generated on 2024-01-15T10:30:00.000Z</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">### FTL file for CMS localization</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">## sync-signin - Firefox Sync Sign In</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Headline for Sign In Page</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">sync-signin-headline-a1b2c3d4 = Sign in to sync your data</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Primary Button Text for Sign In Page</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">sync-signin-primary-button-text-e5f6g7h8 = Continue</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-github-integration-and-pr-management">3. GitHub Integration and PR Management<a href="#3-github-integration-and-pr-management" class="hash-link" aria-label="Direct link to 3. GitHub Integration and PR Management" title="Direct link to 3. GitHub Integration and PR Management" translate="no">​</a></h3>
<p><strong>Location</strong>: <code>packages/fxa-auth-server/lib/routes/utils/cms/localization.ts:495-604</code></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="pr-creation-process">PR Creation Process<a href="#pr-creation-process" class="hash-link" aria-label="Direct link to PR Creation Process" title="Direct link to PR Creation Process" translate="no">​</a></h4>
<ol>
<li><strong>Branch Creation</strong>: Create timestamped branch <code>cms-localization-{timestamp}</code></li>
<li><strong>File Creation</strong>: Add/update <code>locales/en/cms.ftl</code></li>
<li><strong>PR Creation</strong>: Create PR with detailed description including:<!-- -->
<ul>
<li>Webhook event details</li>
<li>Entry count processed</li>
<li>Generation timestamp</li>
<li>Source information</li>
</ul>
</li>
</ol>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="pr-update-process">PR Update Process<a href="#pr-update-process" class="hash-link" aria-label="Direct link to PR Update Process" title="Direct link to PR Update Process" translate="no">​</a></h4>
<ul>
<li><strong>Existing PR Detection</strong>: Search for open PRs with CMS localization titles</li>
<li><strong>Content Update</strong>: Update FTL file in existing branch</li>
<li><strong>Metadata Preservation</strong>: Maintain PR context and approval history</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="4-human-review-and-approval">4. Human Review and Approval<a href="#4-human-review-and-approval" class="hash-link" aria-label="Direct link to 4. Human Review and Approval" title="Direct link to 4. Human Review and Approval" translate="no">​</a></h3>
<p><strong>Participants</strong>: Development team, localization coordinators</p>
<ol>
<li>Automated PR contains generated FTL file</li>
<li>Reviewers verify content extraction accuracy</li>
<li>Check for proper FTL format compliance</li>
<li>Approve and merge PR to main branch</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="5-pontoon-integration">5. Pontoon Integration<a href="#5-pontoon-integration" class="hash-link" aria-label="Direct link to 5. Pontoon Integration" title="Direct link to 5. Pontoon Integration" translate="no">​</a></h3>
<p><strong>Location</strong>: External to FxA codebase</p>
<ol>
<li><strong>Detection</strong>: Pontoon monitors the FxA repository for FTL file changes</li>
<li><strong>Project Update</strong>: New strings are imported into Pontoon projects</li>
<li><strong>Translation</strong>: Community translators and staff work on localizations</li>
<li><strong>Quality Assurance</strong>: Translations are reviewed and approved</li>
<li><strong>Merge Back</strong>: Completed translations are committed back to the repository</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="6-runtime-localization-and-caching">6. Runtime Localization and Caching<a href="#6-runtime-localization-and-caching" class="hash-link" aria-label="Direct link to 6. Runtime Localization and Caching" title="Direct link to 6. Runtime Localization and Caching" translate="no">​</a></h3>
<p><strong>Location</strong>:</p>
<ul>
<li>API: <code>packages/fxa-auth-server/lib/routes/cms.ts:96-176</code></li>
<li>Configuration Manager: <code>libs/shared/cms/src/lib/relying-party-configuration.manager.ts</code></li>
<li>Frontend: <code>packages/fxa-settings/src/models/integrations/integration.ts:167-199</code></li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="caching-strategy">Caching Strategy<a href="#caching-strategy" class="hash-link" aria-label="Direct link to Caching Strategy" title="Direct link to Caching Strategy" translate="no">​</a></h4>
<!-- -->
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="cache-configuration">Cache Configuration<a href="#cache-configuration" class="hash-link" aria-label="Direct link to Cache Configuration" title="Direct link to Cache Configuration" translate="no">​</a></h4>
<ul>
<li><strong>Memory Cache TTL</strong>: 5 minutes (configurable via <code>cmsl10n.ftlCache.memoryTtlSeconds</code>)</li>
<li><strong>Firestore Cache TTL</strong>: 30 minutes (configurable via <code>cmsl10n.ftlCache.firestoreTtlSeconds</code>)</li>
<li><strong>Firestore Offline TTL</strong>: 7 days (configurable via <code>cmsl10n.ftlCache.firestoreOfflineTtlSeconds</code>)</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="localization-request-flow">Localization Request Flow<a href="#localization-request-flow" class="hash-link" aria-label="Direct link to Localization Request Flow" title="Direct link to Localization Request Flow" translate="no">​</a></h4>
<ol>
<li><strong>Client Request</strong>: Frontend requests <code>/cms/config?clientId={id}&amp;entrypoint={point}</code></li>
<li><strong>Base Configuration</strong>: Fetch base config from Strapi via RelyingPartyConfigurationManager</li>
<li><strong>Locale Detection</strong>: Determine user locale from request headers</li>
<li><strong>Localization Logic</strong>:<!-- -->
<ul>
<li>If locale is &#x27;en&#x27; → return base config</li>
<li>If localization disabled → return base config</li>
<li>Otherwise, proceed with localization</li>
</ul>
</li>
<li><strong>FTL Retrieval</strong>: Fetch localized FTL content with fallback logic:<!-- -->
<ul>
<li>Try specific locale (e.g., &#x27;es-MX&#x27;)</li>
<li>Fallback to base language (e.g., &#x27;es&#x27;)</li>
<li>Use cached content when available</li>
</ul>
</li>
<li><strong>Content Merging</strong>: Parse FTL and merge with base configuration</li>
<li><strong>Response</strong>: Return localized configuration to client</li>
</ol>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="ftl-url-template">FTL URL Template<a href="#ftl-url-template" class="hash-link" aria-label="Direct link to FTL URL Template" title="Direct link to FTL URL Template" translate="no">​</a></h4>
<div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Configuration example</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token string-property property">&quot;cmsl10n&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token string-property property">&quot;ftlUrl&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token string-property property">&quot;template&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;https://raw.githubusercontent.com/mozilla/fxa/{branch}/locales/{locale}/cms.ftl&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token string-property property">&quot;timeout&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">5000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="error-handling-and-fallbacks">Error Handling and Fallbacks<a href="#error-handling-and-fallbacks" class="hash-link" aria-label="Direct link to Error Handling and Fallbacks" title="Direct link to Error Handling and Fallbacks" translate="no">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="webhook-processing-errors">Webhook Processing Errors<a href="#webhook-processing-errors" class="hash-link" aria-label="Direct link to Webhook Processing Errors" title="Direct link to Webhook Processing Errors" translate="no">​</a></h3>
<p><strong>Location</strong>: <code>packages/fxa-auth-server/lib/routes/cms.ts:290-296</code></p>
<ul>
<li><strong>Authentication Failures</strong>: Invalid webhook secrets are logged and rejected</li>
<li><strong>Strapi API Errors</strong>: Network failures fall back gracefully without blocking the webhook</li>
<li><strong>GitHub API Errors</strong>: PR creation failures are logged with full context</li>
<li><strong>Validation Errors</strong>: Malformed content is logged for debugging</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="runtime-localization-errors">Runtime Localization Errors<a href="#runtime-localization-errors" class="hash-link" aria-label="Direct link to Runtime Localization Errors" title="Direct link to Runtime Localization Errors" translate="no">​</a></h3>
<p><strong>Location</strong>: <code>packages/fxa-auth-server/lib/routes/utils/cms/localization.ts:665-716</code></p>
<ul>
<li><strong>FTL Fetch Failures</strong>: Automatic fallback to base language, then base config</li>
<li><strong>Network Timeouts</strong>: Configurable timeout with graceful degradation</li>
<li><strong>Cache Failures</strong>: Continue to next cache level or origin fetch</li>
<li><strong>Parse Errors</strong>: Return base configuration on FTL parsing failures</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="fallback-strategy">Fallback Strategy<a href="#fallback-strategy" class="hash-link" aria-label="Direct link to Fallback Strategy" title="Direct link to Fallback Strategy" translate="no">​</a></h3>
<!-- -->
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="configuration">Configuration<a href="#configuration" class="hash-link" aria-label="Direct link to Configuration" title="Direct link to Configuration" translate="no">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="environment-variables">Environment Variables<a href="#environment-variables" class="hash-link" aria-label="Direct link to Environment Variables" title="Direct link to Environment Variables" translate="no">​</a></h3>
<ul>
<li><code>FXA_L10N_REPO</code>: L10n repository URL (default: mozilla/fxa-content-server-l10n)</li>
<li><code>FXA_L10N_BRANCH</code>: Target branch (default: main)</li>
<li><code>FXA_L10N_SHA</code>: Specific commit hash for L10n files</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="service-configuration">Service Configuration<a href="#service-configuration" class="hash-link" aria-label="Direct link to Service Configuration" title="Direct link to Service Configuration" translate="no">​</a></h3>
<div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">interface</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">CMSLocalizationConfig</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  enabled</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">boolean</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  strapiWebhook</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    enabled</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">boolean</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    secret</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">string</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    strapiUrl</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">string</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  github</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    token</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">string</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    owner</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">string</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    repo</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">string</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    branch</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">string</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ftlUrl</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    template</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">string</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    timeout</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">number</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ftlCache</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    memoryTtlSeconds</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">number</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    firestoreTtlSeconds</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">number</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    firestoreOfflineTtlSeconds</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">number</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="key-file-locations">Key File Locations<a href="#key-file-locations" class="hash-link" aria-label="Direct link to Key File Locations" title="Direct link to Key File Locations" translate="no">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="backend-components">Backend Components<a href="#backend-components" class="hash-link" aria-label="Direct link to Backend Components" title="Direct link to Backend Components" translate="no">​</a></h3>
<ul>
<li><strong>CMS Routes</strong>: <code>packages/fxa-auth-server/lib/routes/cms.ts</code></li>
<li><strong>Localization Logic</strong>: <code>packages/fxa-auth-server/lib/routes/utils/cms/localization.ts</code></li>
<li><strong>Configuration Manager</strong>: <code>libs/shared/cms/src/lib/relying-party-configuration.manager.ts</code></li>
<li><strong>Test Suite</strong>: <code>packages/fxa-auth-server/test/local/routes/utils/cms/localization.js</code></li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="frontend-components">Frontend Components<a href="#frontend-components" class="hash-link" aria-label="Direct link to Frontend Components" title="Direct link to Frontend Components" translate="no">​</a></h3>
<ul>
<li><strong>Integration Layer</strong>: <code>packages/fxa-settings/src/models/integrations/integration.ts:167</code></li>
<li><strong>CMS Hooks</strong>: <code>packages/fxa-settings/src/models/hooks.ts:262</code></li>
<li><strong>Auth Client</strong>: <code>packages/fxa-auth-client/lib/client.ts:2428</code></li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="l10n-scripts">L10n Scripts<a href="#l10n-scripts" class="hash-link" aria-label="Direct link to L10n Scripts" title="Direct link to L10n Scripts" translate="no">​</a></h3>
<ul>
<li><strong>Clone Script</strong>: <code>_scripts/l10n/clone.sh</code></li>
<li><strong>Prime Script</strong>: <code>_scripts/l10n/prime.sh</code></li>
<li><strong>Bundle Script</strong>: <code>_scripts/l10n/bundle.sh</code></li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="monitoring-and-metrics">Monitoring and Metrics<a href="#monitoring-and-metrics" class="hash-link" aria-label="Direct link to Monitoring and Metrics" title="Direct link to Monitoring and Metrics" translate="no">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="statsd-metrics">StatsD Metrics<a href="#statsd-metrics" class="hash-link" aria-label="Direct link to StatsD Metrics" title="Direct link to StatsD Metrics" translate="no">​</a></h3>
<ul>
<li><code>cms.getConfig.empty</code>: Config requests returning empty results</li>
<li><code>cms.getConfig.multiple</code>: Multiple relying parties found for request</li>
<li><code>cms.getConfig.error</code>: Config fetch errors</li>
<li><code>cms.getLocalizedConfig.success</code>: Successful localized config delivery</li>
<li><code>cms.getLocalizedConfig.fallback</code>: Fallback to base config</li>
<li><code>cms.getLocalizedConfig.error</code>: Localization errors</li>
<li><code>cms.strapiWebhook.processed</code>: Successfully processed webhooks</li>
<li><code>cms.strapiWebhook.error</code>: Webhook processing errors</li>
<li><code>cms_ftl_cache_hit</code>: FTL cache hit timing</li>
<li><code>cms_ftl_request</code>: FTL fetch timing and errors</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="logging">Logging<a href="#logging" class="hash-link" aria-label="Direct link to Logging" title="Direct link to Logging" translate="no">​</a></h3>
<p>All components use structured logging with:</p>
<ul>
<li>Request correlation IDs</li>
<li>Client identification</li>
<li>Locale information</li>
<li>Error details and stack traces</li>
<li>Performance metrics</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="testing-localization">Testing Localization<a href="#testing-localization" class="hash-link" aria-label="Direct link to Testing Localization" title="Direct link to Testing Localization" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Run localization-specific tests</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">NODE_ENV=test yarn test test/local/routes/utils/cms/localization.js</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Test with specific locale</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">curl &quot;http://localhost:9000/v1/cms/config?clientId={clientId}&amp;entrypoint={entrypoint}&quot; \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  -H &quot;Accept-Language: es-MX&quot;</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="troubleshooting">Troubleshooting<a href="#troubleshooting" class="hash-link" aria-label="Direct link to Troubleshooting" title="Direct link to Troubleshooting" translate="no">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="common-issues">Common Issues<a href="#common-issues" class="hash-link" aria-label="Direct link to Common Issues" title="Direct link to Common Issues" translate="no">​</a></h3>
<ol>
<li><strong>Empty Localized Config</strong>: Check FTL file availability and cache status</li>
<li><strong>Webhook Failures</strong>: Verify webhook secret configuration and Strapi connectivity</li>
<li><strong>GitHub PR Errors</strong>: Confirm GitHub token permissions and repository access</li>
<li><strong>Cache Inconsistency</strong>: Clear Firestore and memory caches, verify TTL settings</li>
<li><strong>FTL Parse Errors</strong>: Validate FTL file format and character encoding</li>
</ol></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/mozilla/ecosystem-platform/edit/master/docs/explanation/cms-strapi-l10n.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/ecosystem-platform/explanation/scoped-keys"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Scoped Keys</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/ecosystem-platform/additional-docs"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Additional Docs</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#overview" class="table-of-contents__link toc-highlight">Overview</a></li><li><a href="#architecture-components" class="table-of-contents__link toc-highlight">Architecture Components</a><ul><li><a href="#core-components" class="table-of-contents__link toc-highlight">Core Components</a></li></ul></li><li><a href="#workflow-diagram" class="table-of-contents__link toc-highlight">Workflow Diagram</a></li><li><a href="#detailed-workflow-steps" class="table-of-contents__link toc-highlight">Detailed Workflow Steps</a><ul><li><a href="#1-content-creation-and-publishing" class="table-of-contents__link toc-highlight">1. Content Creation and Publishing</a></li><li><a href="#2-webhook-processing-and-ftl-generation" class="table-of-contents__link toc-highlight">2. Webhook Processing and FTL Generation</a></li><li><a href="#3-github-integration-and-pr-management" class="table-of-contents__link toc-highlight">3. GitHub Integration and PR Management</a></li><li><a href="#4-human-review-and-approval" class="table-of-contents__link toc-highlight">4. Human Review and Approval</a></li><li><a href="#5-pontoon-integration" class="table-of-contents__link toc-highlight">5. Pontoon Integration</a></li><li><a href="#6-runtime-localization-and-caching" class="table-of-contents__link toc-highlight">6. Runtime Localization and Caching</a></li></ul></li><li><a href="#error-handling-and-fallbacks" class="table-of-contents__link toc-highlight">Error Handling and Fallbacks</a><ul><li><a href="#webhook-processing-errors" class="table-of-contents__link toc-highlight">Webhook Processing Errors</a></li><li><a href="#runtime-localization-errors" class="table-of-contents__link toc-highlight">Runtime Localization Errors</a></li><li><a href="#fallback-strategy" class="table-of-contents__link toc-highlight">Fallback Strategy</a></li></ul></li><li><a href="#configuration" class="table-of-contents__link toc-highlight">Configuration</a><ul><li><a href="#environment-variables" class="table-of-contents__link toc-highlight">Environment Variables</a></li><li><a href="#service-configuration" class="table-of-contents__link toc-highlight">Service Configuration</a></li></ul></li><li><a href="#key-file-locations" class="table-of-contents__link toc-highlight">Key File Locations</a><ul><li><a href="#backend-components" class="table-of-contents__link toc-highlight">Backend Components</a></li><li><a href="#frontend-components" class="table-of-contents__link toc-highlight">Frontend Components</a></li><li><a href="#l10n-scripts" class="table-of-contents__link toc-highlight">L10n Scripts</a></li></ul></li><li><a href="#monitoring-and-metrics" class="table-of-contents__link toc-highlight">Monitoring and Metrics</a><ul><li><a href="#statsd-metrics" class="table-of-contents__link toc-highlight">StatsD Metrics</a></li><li><a href="#logging" class="table-of-contents__link toc-highlight">Logging</a></li><li><a href="#testing-localization" class="table-of-contents__link toc-highlight">Testing Localization</a></li></ul></li><li><a href="#troubleshooting" class="table-of-contents__link toc-highlight">Troubleshooting</a><ul><li><a href="#common-issues" class="table-of-contents__link toc-highlight">Common Issues</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 Mozilla Corporation.</div></div></div></footer></div>
</body>
</html>