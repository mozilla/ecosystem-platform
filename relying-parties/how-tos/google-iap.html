<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-relying-parties/how-tos/google-iap" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">Google IAP | Firefox Ecosystem Platform</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://mozilla.github.io/ecosystem-platform/relying-parties/how-tos/google-iap"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Google IAP | Firefox Ecosystem Platform"><meta data-rh="true" name="description" content="Introduction"><meta data-rh="true" property="og:description" content="Introduction"><link data-rh="true" rel="icon" href="/ecosystem-platform/img/firefox-logo.png"><link data-rh="true" rel="canonical" href="https://mozilla.github.io/ecosystem-platform/relying-parties/how-tos/google-iap"><link data-rh="true" rel="alternate" href="https://mozilla.github.io/ecosystem-platform/relying-parties/how-tos/google-iap" hreflang="en"><link data-rh="true" rel="alternate" href="https://mozilla.github.io/ecosystem-platform/relying-parties/how-tos/google-iap" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://RFM5H13DFK-dsn.algolia.net" crossorigin="anonymous"><link rel="search" type="application/opensearchdescription+xml" title="Firefox Ecosystem Platform" href="/ecosystem-platform/opensearch.xml"><link rel="stylesheet" href="/ecosystem-platform/assets/css/styles.b0ab5bf8.css">
<script src="/ecosystem-platform/assets/js/runtime~main.a02feac1.js" defer="defer"></script>
<script src="/ecosystem-platform/assets/js/main.15ef5dbd.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();null!==e?t(e):window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,t("light"))}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/ecosystem-platform/img/firefox-logo.png"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/ecosystem-platform/"><div class="navbar__logo"><img src="/ecosystem-platform/img/firefox-logo.png" alt="Ecosystem Platform Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/ecosystem-platform/img/firefox-logo.png" alt="Ecosystem Platform Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Firefox Ecosystem Platform</b></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/mozilla/ecosystem-platform" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/ecosystem-platform/">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--active">For Relying Parties</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/ecosystem-platform/relying-parties/tutorials/integration-with-fxa">Tutorials</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/ecosystem-platform/relying-parties/how-tos/end-to-end-encryption">How-to Guides</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/relying-parties/how-tos/end-to-end-encryption">End-to-end Encryption</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/ecosystem-platform/relying-parties/how-tos/google-iap">Google IAP</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/relying-parties/how-tos/apple-iap">Apple IAP</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/relying-parties/how-tos/product-metrics">Product metrics</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/relying-parties/how-tos/device-registration">Device Registration (Sync)</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/ecosystem-platform/relying-parties/reference/glossary">Reference</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link">For FxA Engineers</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/ecosystem-platform/tutorials/development-setup">Tutorials</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/ecosystem-platform/how-tos/ci-guidelines">How-to Guides</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/ecosystem-platform/reference/team-processes/development-process">Reference</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/ecosystem-platform/explanation/architectural-decision-records">Explanation</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/additional-docs">Additional Docs</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link">For Support Agents</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/ecosystem-platform/reference/admin-panel">Reference</a></div></li></ul></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/ecosystem-platform/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">For Relying Parties</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">How-to Guides</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Google IAP</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Google IAP</h1></header><h2 class="anchor anchorWithStickyNavbar_LWe7" id="introduction">Introduction<a href="#introduction" class="hash-link" aria-label="Direct link to Introduction" title="Direct link to Introduction">​</a></h2>
<p>As of November 2021, Subscription Platform (SubPlat) supports <a href="https://developer.android.com/google/play/billing" target="_blank" rel="noopener noreferrer">Google IAP</a> integrations for products with Mozilla VPN as one example. An integration allows us to maintain an awareness of a Google IAP subscriber&#x27;s subscription status for a given Android app, including any state changes, which we forward on to the relevant relying party (RP).</p>
<p>Importantly, Google provides read-only access to Google IAP subscriptions. Consequently, we do not (and cannot) modify Google IAP subscriptions (e.g. making plan changes such as upgrades).</p>
<p>A more technical discussion (geared toward Mozilla accounts (FxA) engineers) can be found in <a href="/ecosystem-platform/tutorials/subscription-platform#google-iap-integration">Google IAP Integration</a>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="recent-changes-to-google-play-billing-library">Recent changes to Google Play Billing Library<a href="#recent-changes-to-google-play-billing-library" class="hash-link" aria-label="Direct link to Recent changes to Google Play Billing Library" title="Direct link to Recent changes to Google Play Billing Library">​</a></h3>
<p>As of May 2022, the Google Play Billing Library introduced changes in the way subscription products are defined and managed in the Google Play Console. This includes the deprecation of the <code>SkuDetails</code> class and renaming all <code>sku</code> references to the more aptly named <code>productId</code>.</p>
<p>Importantly, Google has included backwards compatibility to allow for a gradual migration. In our codebase, we are currently still referencing the outdated <code>sku</code>. However, as this is a How-to Guide for RPs, and what one can expect to see in Google Play Console, this guide will reference all new field names, and in particular, <code>productId</code>.</p>
<p>For more information on these changes and updated field mappings, see <a href="https://support.google.com/googleplay/android-developer/answer/12154973" target="_blank" rel="noopener noreferrer">Understanding subscriptions</a> and <a href="https://developer.android.com/google/play/billing/compatibility" target="_blank" rel="noopener noreferrer">May 2022 subscription changes guide</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="prerequisites">Prerequisites<a href="#prerequisites" class="hash-link" aria-label="Direct link to Prerequisites" title="Direct link to Prerequisites">​</a></h2>
<p>This guide assumes you are already integrated with FxA/SubPlat; please see <a href="/ecosystem-platform/relying-parties/tutorials/integration-with-subscription-platform">Integration with Subscription Platform</a> for more information.</p>
<p>Ideally, you will also want to grant 1-2 SubPlat engineers working on the integration developer access to your Android app in <a href="https://play.google.com/console" target="_blank" rel="noopener noreferrer">Google Play Console</a> (<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1726184" target="_blank" rel="noopener noreferrer">example bug</a>). This allows us to access your Android app’s <a href="https://developers.google.com/android-publisher" target="_blank" rel="noopener noreferrer">Google Play Developer API</a> keys, to look up needed app-specific information and to configure an endpoint to receive <a href="https://developer.android.com/google/play/billing/rtdn-reference" target="_blank" rel="noopener noreferrer">Real-time developer notifications (RTDN)</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="configuration">Configuration<a href="#configuration" class="hash-link" aria-label="Direct link to Configuration" title="Direct link to Configuration">​</a></h2>
<p>These steps can be done by a product manager or developer and in parallel with steps in <a href="#subplat-api-calls">SubPlat API Calls</a>. More information regarding specific Stripe metadata keys mentioned below can be found in the <a href="/ecosystem-platform/tutorials/subscription-platform#stripe-productplans">Subscription Platform integration tutorial</a>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="create-an-iap-configuration-document">Create an IAP configuration document<a href="#create-an-iap-configuration-document" class="hash-link" aria-label="Direct link to Create an IAP configuration document" title="Direct link to Create an IAP configuration document">​</a></h3>
<p>This document represents a list of Play Store plans (identified uniquely by their Play Store <a href="https://support.google.com/googleplay/android-developer/answer/140504#zippy=%2Ccreate-a-new-subscription" target="_blank" rel="noopener noreferrer"><code>productId</code></a> for your product.</p>
<ol>
<li>Go into Google Play Console and find details about your Android app by <a href="https://support.google.com/googleplay/android-developer/answer/140504#zippy=%2Ccreate-a-new-subscription" target="_blank" rel="noopener noreferrer"><code>productId</code></a>.</li>
<li>Create a configuration document similar in form to <a href="https://api.accounts.firefox.com/v1/oauth/subscriptions/iap/plans/guardian-vpn" target="_blank" rel="noopener noreferrer">https://api.accounts.firefox.com/v1/oauth/subscriptions/iap/plans/guardian-vpn</a> (omitting iOS plans) using the details retrieved in Step 1. This can be in a Google document for now.<!-- -->
<ul>
<li>Note: The only information SubPlat uses from the VPN document currently is the <code>productId</code> and <code>platform</code>. The VPN configuration document is structured in this way for historical reasons. We may change how this information is structured for future integrations.</li>
</ul>
</li>
<li>File a ticket in the <a href="https://mozilla-hub.atlassian.net/browse/FXA" target="_blank" rel="noopener noreferrer">FXA Jira project</a> to create a new document in SubPlat&#x27;s &quot;IAP config&quot; Firestore collection, and provide the document from Step 2 along with an <code>appName</code>.<!-- -->
<ul>
<li><code>appName</code> is a human-readable name that SubPlat uses to uniquely identify your app in our system (e.g. <code>&quot;guardian-vpn&quot;</code> is the <code>appName</code> for the Mozilla VPN in the link above).
When the ticket is complete and deployed, you should be able to view your configuration at <a href="https://api.accounts.firefox.com/v1/oauth/subscriptions/iap/plans/$%7BappName%7D" target="_blank" rel="noopener noreferrer">https://api.accounts.firefox.com/v1/oauth/subscriptions/iap/plans/${appName}</a>.</li>
</ul>
</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="add-google-play-developer-api-keys-in-subplat">Add Google Play Developer API keys in SubPlat<a href="#add-google-play-developer-api-keys-in-subplat" class="hash-link" aria-label="Direct link to Add Google Play Developer API keys in SubPlat" title="Direct link to Add Google Play Developer API keys in SubPlat">​</a></h3>
<p>A SubPlat engineer with developer access to Google Play Console (see <a href="#prerequisites">Prerequisites</a>) can configure this for you when ready.</p>
<p>Google Play Developer API keys are needed for SubPlat to make calls to Google API. For more information on how to obtain these keys, see <a href="https://support.google.com/googleapi/answer/6158862" target="_blank" rel="noopener noreferrer">Setting up API keys</a>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="send-real-time-developer-notifications-to-subplat">Send Real-time developer notifications to SubPlat<a href="#send-real-time-developer-notifications-to-subplat" class="hash-link" aria-label="Direct link to Send Real-time developer notifications to SubPlat" title="Direct link to Send Real-time developer notifications to SubPlat">​</a></h3>
<p>A SubPlat engineer with developer access to Google Play Console (see <a href="#prerequisites">Prerequisites</a>) can configure this for you when ready.</p>
<p>When ready, the Production endpoint in RTDN must be updated with SubPlat&#x27;s notification endpoint in order for our system to receive RTDN.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="map-google-iap-to-stripe-plans">Map Google IAP to Stripe plans<a href="#map-google-iap-to-stripe-plans" class="hash-link" aria-label="Direct link to Map Google IAP to Stripe plans" title="Direct link to Map Google IAP to Stripe plans">​</a></h3>
<p>In order to know what capabilities to grant a given Google IAP user, we map Play Store <code>productId</code>s to <a href="https://support.stripe.com/questions/how-to-create-products-and-prices" target="_blank" rel="noopener noreferrer">Stripe <code>price</code> or <code>plan</code></a> IDs (<code>price</code>s supersede <code>plan</code>s).</p>
<ol>
<li>Go into the Google Play Console and find your Android app’s human-readable <code>productId</code>s.</li>
<li>In the Stripe dashboard for the desired environment (stage or production), create a new, valid product in Stripe and a new, valid plan underneath that product.<!-- -->
<ul>
<li>We hope to simplify this process in SubPlat 3.0, expected in 2023; see this <a href="https://mozilla-hub.atlassian.net/browse/PSP-64?focusedCommentId=627245" target="_blank" rel="noopener noreferrer">Jira comment</a> for more details.</li>
</ul>
</li>
<li>Add each Play Store <code>productId</code> as a comma-separated value to a new <code>playSkuIds</code> metadata property on the newly created plan.</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="prevent-google-iap-subscribers-from-double-subscribing">Prevent Google IAP subscribers from double subscribing<a href="#prevent-google-iap-subscribers-from-double-subscribing" class="hash-link" aria-label="Direct link to Prevent Google IAP subscribers from double subscribing" title="Direct link to Prevent Google IAP subscribers from double subscribing">​</a></h3>
<p>As noted previously, we don’t support upgrades or any plan changes for Google IAP subscribers. However, it is possible for a Google IAP subscriber to try to sign up again for your product on the SubPlat website. Follow these steps to prevent them from double subscribing.</p>
<ol>
<li>In the Stripe dashboard for the given environment (stage or production), remove any <code>productSet</code> properties that may have been previously set on the newly created product/plan from <a href="#map-google-iap-to-stripe-plans">Map Google IAP to Stripe plans</a>.</li>
<li>Add a <code>productSet</code> metadata key with a value equal to the comma-separated list of all the unique <code>productSet</code>s for all your product’s plans in the environment to the new product referenced in Step 1. Without their own <code>productSet</code> specified, the new plan will inherit its product’s <code>productSet</code>.</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="subplat-api-calls">SubPlat API Calls<a href="#subplat-api-calls" class="hash-link" aria-label="Direct link to SubPlat API Calls" title="Direct link to SubPlat API Calls">​</a></h2>
<p>These steps can be done by a developer and in parallel with the steps in <a href="#configuration">Configuration</a>.</p>
<p>As mentioned in the <a href="#introduction">Introduction</a>, SubPlat has read-only access to Play Store subscription information. We will store Google IAP subscribers&#x27; data in our system and update the information when we receive notifications from RTDN, broadcasting updates in real time to the relevant RPs.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="getting-the-current-subscription-status-for-a-fxa-user">Getting the current subscription status for a FxA user<a href="#getting-the-current-subscription-status-for-a-fxa-user" class="hash-link" aria-label="Direct link to Getting the current subscription status for a FxA user" title="Direct link to Getting the current subscription status for a FxA user">​</a></h3>
<p>Assuming you are already integrated with FxA generally (see <a href="#prerequisites">Prerequisites</a>), are receiving subscription updates for other types of subscriptions (e.g. for PayPal or Stripe), and you have completed the <a href="#map-google-iap-to-stripe-plans">mapping of Play Store to Stripe plans</a>, no further work is required to continue receiving these updates for Google IAP subscribers. You can also pull this information from FxA with the existing <a href="/ecosystem-platform/api#tag/Account/operation/getAccountProfile"><code>/account/profile</code></a> endpoint without any further changes.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="registering-a-google-iap-subscriber">Registering a Google IAP subscriber<a href="#registering-a-google-iap-subscriber" class="hash-link" aria-label="Direct link to Registering a Google IAP subscriber" title="Direct link to Registering a Google IAP subscriber">​</a></h3>
<p>SubPlat needs to be able to associate a Google IAP subscription in Google&#x27;s system to a specific FxA user. This is done by registering each Google IAP subscriber with the <a href="/ecosystem-platform/api#tag/Subscriptions/operation/postOauthSubscriptionsIapPlaytokenAppname"><code>/subscriptions/iap/play-token/${appName}</code></a> endpoint.</p>
<p>By design, we allow only one FxA user per Play Store <a href="https://support.google.com/googleplay/android-developer/answer/140504#zippy=%2Ccreate-a-new-subscription" target="_blank" rel="noopener noreferrer"><code>productId</code></a>, which is how Google uniquely identifies the user&#x27;s device when the subscription was purchased.</p>
<p>This endpoint can be used to register a new Google IAP subscriber or to migrate an existing Google IAP subscriber. For the latter, see <a href="#optional-migrating-existing-google-iap-subscribers-to-subplat">(Optional) Migrate existing Google IAP subscribers to SubPlat</a>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="optional-migrating-existing-google-iap-subscribers-to-subplat">(Optional) Migrating existing Google IAP subscribers to SubPlat<a href="#optional-migrating-existing-google-iap-subscribers-to-subplat" class="hash-link" aria-label="Direct link to (Optional) Migrating existing Google IAP subscribers to SubPlat" title="Direct link to (Optional) Migrating existing Google IAP subscribers to SubPlat">​</a></h3>
<p>This section only applies to products that currently have a direct integration with Google who need to migrate existing subscribers to SubPlat.</p>
<p>This step can be done by a developer. Before proceeding, complete the steps under <a href="#configuration">Configuration</a> and <a href="#subplat-api-calls">SubPlat API Calls</a>. See also the <a href="#testing-your-integration">Testing your integration</a> section.</p>
<p>To migrate existing subscribers to SubPlat, use the existing registration endpoint (<a href="/ecosystem-platform/api#tag/Subscriptions/operation/postOauthSubscriptionsIapPlaytokenAppname"><code>/subscriptions/iap/play-token/${appName}</code></a>) to register each existing user with SubPlat.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="testing-your-integration">Testing your integration<a href="#testing-your-integration" class="hash-link" aria-label="Direct link to Testing your integration" title="Direct link to Testing your integration">​</a></h2>
<p>Currently, there is no sandbox or separate test environment. To create a test subscription, append <code>(Stage)</code> to the end of a subscription title in the Google Play Console to differentiate from a Production subscription. This approach will enable RPs to test multiple scenarios to understand what to expect.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="end-to-end-testing-of-subplat-apis">End-to-end testing of SubPlat APIs<a href="#end-to-end-testing-of-subplat-apis" class="hash-link" aria-label="Direct link to End-to-end testing of SubPlat APIs" title="Direct link to End-to-end testing of SubPlat APIs">​</a></h3>
<p>After development and the steps above are complete (and importantly, before involving QA), it is recommended for the lead RP integration engineer to pair with the lead SubPlat integration engineer to test the following:</p>
<ul>
<li><a href="#getting-the-current-subscription-status-for-a-fxa-user">Getting the current subscription status for a FxA user</a></li>
<li><a href="#registering-a-google-iap-subscriber">Registering a Google IAP subscriber</a></li>
<li><a href="#send-real-time-developer-notifications-to-subplat">Send Real-time developer notifications to SubPlat</a></li>
<li><a href="#optional-migrating-existing-google-iap-subscribers-to-subplat">(Optional) Migrating existing Google IAP subscribers to SubPlat</a></li>
</ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/mozilla/ecosystem-platform/edit/master/docs/relying-parties/how-tos/google-iap.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/ecosystem-platform/relying-parties/how-tos/end-to-end-encryption"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">End-to-end Encryption</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/ecosystem-platform/relying-parties/how-tos/apple-iap"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Apple IAP</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#introduction" class="table-of-contents__link toc-highlight">Introduction</a><ul><li><a href="#recent-changes-to-google-play-billing-library" class="table-of-contents__link toc-highlight">Recent changes to Google Play Billing Library</a></li></ul></li><li><a href="#prerequisites" class="table-of-contents__link toc-highlight">Prerequisites</a></li><li><a href="#configuration" class="table-of-contents__link toc-highlight">Configuration</a><ul><li><a href="#create-an-iap-configuration-document" class="table-of-contents__link toc-highlight">Create an IAP configuration document</a></li><li><a href="#add-google-play-developer-api-keys-in-subplat" class="table-of-contents__link toc-highlight">Add Google Play Developer API keys in SubPlat</a></li><li><a href="#send-real-time-developer-notifications-to-subplat" class="table-of-contents__link toc-highlight">Send Real-time developer notifications to SubPlat</a></li><li><a href="#map-google-iap-to-stripe-plans" class="table-of-contents__link toc-highlight">Map Google IAP to Stripe plans</a></li><li><a href="#prevent-google-iap-subscribers-from-double-subscribing" class="table-of-contents__link toc-highlight">Prevent Google IAP subscribers from double subscribing</a></li></ul></li><li><a href="#subplat-api-calls" class="table-of-contents__link toc-highlight">SubPlat API Calls</a><ul><li><a href="#getting-the-current-subscription-status-for-a-fxa-user" class="table-of-contents__link toc-highlight">Getting the current subscription status for a FxA user</a></li><li><a href="#registering-a-google-iap-subscriber" class="table-of-contents__link toc-highlight">Registering a Google IAP subscriber</a></li><li><a href="#optional-migrating-existing-google-iap-subscribers-to-subplat" class="table-of-contents__link toc-highlight">(Optional) Migrating existing Google IAP subscribers to SubPlat</a></li></ul></li><li><a href="#testing-your-integration" class="table-of-contents__link toc-highlight">Testing your integration</a><ul><li><a href="#end-to-end-testing-of-subplat-apis" class="table-of-contents__link toc-highlight">End-to-end testing of SubPlat APIs</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 Mozilla Corporation.</div></div></div></footer></div>
</body>
</html>