<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-reference/tokens" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">Tokens | Firefox Ecosystem Platform</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://mozilla.github.io/ecosystem-platform/reference/tokens"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Tokens | Firefox Ecosystem Platform"><meta data-rh="true" name="description" content="Last updated: April 17, 2023"><meta data-rh="true" property="og:description" content="Last updated: April 17, 2023"><link data-rh="true" rel="icon" href="/ecosystem-platform/img/firefox-logo.png"><link data-rh="true" rel="canonical" href="https://mozilla.github.io/ecosystem-platform/reference/tokens"><link data-rh="true" rel="alternate" href="https://mozilla.github.io/ecosystem-platform/reference/tokens" hreflang="en"><link data-rh="true" rel="alternate" href="https://mozilla.github.io/ecosystem-platform/reference/tokens" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://RFM5H13DFK-dsn.algolia.net" crossorigin="anonymous"><link rel="search" type="application/opensearchdescription+xml" title="Firefox Ecosystem Platform" href="/ecosystem-platform/opensearch.xml"><link rel="stylesheet" href="/ecosystem-platform/assets/css/styles.b0ab5bf8.css">
<script src="/ecosystem-platform/assets/js/runtime~main.70721ad9.js" defer="defer"></script>
<script src="/ecosystem-platform/assets/js/main.8bac9435.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();null!==e?t(e):window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,t("light"))}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/ecosystem-platform/img/firefox-logo.png"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/ecosystem-platform/"><div class="navbar__logo"><img src="/ecosystem-platform/img/firefox-logo.png" alt="Ecosystem Platform Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/ecosystem-platform/img/firefox-logo.png" alt="Ecosystem Platform Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Firefox Ecosystem Platform</b></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/mozilla/ecosystem-platform" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/ecosystem-platform/">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link">For Relying Parties</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/ecosystem-platform/relying-parties/tutorials/integration-with-fxa">Tutorials</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/ecosystem-platform/relying-parties/how-tos/end-to-end-encryption">How-to Guides</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/ecosystem-platform/relying-parties/reference/glossary">Reference</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--active">For FxA Engineers</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/ecosystem-platform/tutorials/development-setup">Tutorials</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/ecosystem-platform/how-tos/ci-guidelines">How-to Guides</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/ecosystem-platform/reference/team-processes/development-process">Reference</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/ecosystem-platform/reference/team-processes/development-process">Team Processes</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/ecosystem-platform/reference/style-guides/node-style-guide">Style Guides</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/ecosystem-platform/reference/tests-in-circleci">CI and Test Automation</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/reference/application-logging">Application Logging</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/reference/application-tracing">Application Tracing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/reference/browser-support">Browser Support</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/reference/canceling-subscriptions-to-plan">Canceling Subscriptions to Plan</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/customs-api">⚙️ Customs API Reference</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/reference/database-structure">Database Structure</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/reference/emails">Emails</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/reference/experiments-ab-testing">Experiments &amp; A/B Testing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/reference/github-strategies">GitHub Strategies</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/reference/localization">Localization</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/reference/metrics">Metrics</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/reference/mobile-specifics">Mobile Specifics</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/reference/npm-scripts-and-nx">NPM / NX Guidelines</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/reference/oauth-details">OAuth Details</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/reference/rate-limiting">Rate limiting</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/reference/storybook-deploys-with-circleci">Storybook Deploys with CircleCI</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/reference/system-diagrams">System Diagrams</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/reference/third-party-authentication">Third Party Authentication</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/ecosystem-platform/reference/tokens">Tokens</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/reference/webchannels">WebChannels</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a href="https://docs.telemetry.mozilla.org/datasets/fxa.html" target="_blank" rel="noopener noreferrer" class="menu__link menuExternalLink_NmtK" tabindex="0">Telemetry Data Docs<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/ecosystem-platform/explanation/architectural-decision-records">Explanation</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/additional-docs">Additional Docs</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link">For Support Agents</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/ecosystem-platform/reference/admin-panel">Reference</a></div></li></ul></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/ecosystem-platform/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">For FxA Engineers</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Reference</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Tokens</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Tokens</h1></header><p>Last updated: <code>April 17, 2023</code></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="token-formats">Token Formats<a href="#token-formats" class="hash-link" aria-label="Direct link to Token Formats" title="Direct link to Token Formats">​</a></h2>
<p>A <em><strong>Bearer Token</strong></em> is an opaque string that can be used by any client in posession of the token, simply by presenting
it verbatim in the request to the server (e.g. in the <code>Authorization</code> header). These are the simplest types of token
for clients to use, but allow for interception and replay attacks. In particular, the server that receives a Bearer Token
is capable of extracting it and using it to perform other API calls.</p>
<p>A <em><strong>Hawk Token</strong></em> consists of an opaque string id and corresponding secret key. To use the token, clients must use the
secret key to sign outgoing requests using <a href="https://github.com/mozilla/hawk/blob/main/API.md" target="_blank" rel="noopener noreferrer">the scheme described here</a>. This is more
complicated for clients but it binds the use of the token to the particular request being made, and it offers the
potential for replay prevention.</p>
<p>An <em><strong>FxA Hawk Token</strong></em> is a 32-byte string from which the id and key of a <em><strong>Hawk Token</strong></em> can be generated using HKDF.
This simplifies client handling of the token since it only has to persist a single value.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="token-types">Token Types<a href="#token-types" class="hash-link" aria-label="Direct link to Token Types" title="Direct link to Token Types">​</a></h2>
<p>Mozilla accounts uses a number of different types of tokens to keep track of whether a user has been authenticated,
and of what actions a client is authorized to perform.</p>
<p>The most important types of tokens for FxA Replying Parties to know about are:</p>
<ul>
<li><a href="#session-tokens">Session Tokens</a>, long-lived tokens that represent an authenticated user session with the FxA servers.</li>
<li><a href="#oauth-refresh-tokens">OAuth Refresh Tokens</a>, long-lived tokens indicating that the user has authorized a particular client to perform
particular actions on their behalf.</li>
<li><a href="#oauth-access-tokens">OAuth Access Tokens</a>, short-lived tokens used by authorized clients when performing particular actions
on behalf of the user.</li>
<li><a href="#oidc-identity-tokens">OIDC Identity Tokens</a>, short-lived JWTs used to communicate an authentication event from FxA
to a relying party.</li>
</ul>
<p>FxA has additional types of tokens that it uses for its own account-management purposes, but which should
never be visible to Relying Parties:</p>
<ul>
<li><a href="#keyfetch-tokens">KeyFetch Tokens</a></li>
<li><a href="#password-change-tokens">Password Change Tokens</a></li>
<li><a href="#password-forgot-tokens">Password Forgot Tokens</a></li>
<li><a href="#account-reset-tokens">Account Reset Tokens</a></li>
</ul>
<p>Relying Parties that wish to integrate with Firefox Sync may also need to know about this additional type
of token:</p>
<ul>
<li><a href="#sync-storage-credentials">Sync Storage Credentials</a></li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="session-tokens">Session Tokens<a href="#session-tokens" class="hash-link" aria-label="Direct link to Session Tokens" title="Direct link to Session Tokens">​</a></h3>
<p>A <code>sessionToken</code> is the Mozilla accounts equivalent of traditional website login session cookie - it represents
the user who is currently signed in to accounts.firefox.com, and it used to authenticate many calls from the
FxA front-end website to the FxA back-end API.</p>
<p>Session tokens are an <em><strong>FxA Hawk Token</strong></em> where the 32-byte string is generated by the server. They can be obtained by:</p>
<ul>
<li>The successful creation of a new account, via the <code>/account/create</code> endpoint.</li>
<li>A successful login to a new account, via the <code>/account/login</code> endpoint.</li>
<li>Duplicating an existing <code>sessionToken</code>, via the <code>/session/duplicate</code> endpoint.</li>
<li>Providing the id of a previous <code>sessionToken</code> when changing the account password, via the <code>/password/change/finish</code>
endpoint.</li>
<li>Requesting the <code>https://identity.mozilla.com/tokens/session</code> scope during an OAuth flow.</li>
</ul>
<p>Session tokens are intended only for authenticated communication with the FxA servers themselves, so RP servers
should never encounter a session token in the wild.</p>
<p>On the client side, session tokens are typically handled by web content on <code>accounts.firefox.com</code> while the user
is interacting with their account. However, web browsers that support signing in with FxA in order to access
account-enabled browser features, may obtain a session token during the sigin flow and use it to communicate
directly with the FxA server APIs.</p>
<p>Session tokens in MySQL can be associated with a device record. “Device” is a misleading name here because it really means “Firefox instance”.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="verified-sessions">Verified Sessions<a href="#verified-sessions" class="hash-link" aria-label="Direct link to Verified Sessions" title="Direct link to Verified Sessions">​</a></h4>
<p>As an additional security measure against credential-stuffing attacks, FxA has the notion of a &quot;verified session&quot;,
which is intended to indicate a higher level of confidence in the authenticity of the user.</p>
<p>A session is considered verified if the user did some additional authentication step <em>in addition</em> to proving
knowledge of the account password, such as completing an email confirmation loop or answering a 2FA challenge.
Sessions may also be considered verified based on server-side heuristics, such as whether the account is newly-created
or whether we&#x27;ve seen previous verified logins form the same IP address.</p>
<p>Certain actions on the account can only be performed with a verified session, including:</p>
<ul>
<li>Modifying email or 2FA settings</li>
<li>Authorizing OAuth grants that involve key-bearing scopes</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="multi-factor-auth--2fa">Multi-Factor Auth / 2FA<a href="#multi-factor-auth--2fa" class="hash-link" aria-label="Direct link to Multi-Factor Auth / 2FA" title="Direct link to Multi-Factor Auth / 2FA">​</a></h4>
<p>If the user enables two-step authentication on their account, then each sessionToken will keep track of
whether it has been involved in a successful 2FA authentication. This information is reported in the session
metadata in two ways:</p>
<ul>
<li>The &quot;authenticator assurance level&quot; or &quot;AAL&quot; is a numeric indicator of the number of distinct types of
authentication factor that have been provided for a session; it will be <code>2</code> for sessions in which the user
has successfully successfully performed 2FA.</li>
<li>The &quot;authentication methods&quot; is a list of all the different types of authentication action that have been
performed on this session (such as &quot;entered password&quot; or &quot;completed email loop&quot; or &quot;provided totp code&quot;).
It&#x27;s a more detailed view than the summary provided by the AAL.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="oauth-refresh-tokens">OAuth Refresh Tokens<a href="#oauth-refresh-tokens" class="hash-link" aria-label="Direct link to OAuth Refresh Tokens" title="Direct link to OAuth Refresh Tokens">​</a></h3>
<p>RPs that wish to obtain long-lived permission to access the user&#x27;s account data should request
an <a href="https://oauth.net/2/grant-types/refresh-token/" target="_blank" rel="noopener noreferrer">OAuth Refresh Token</a> as part of their authorization flow.
This is a long-lived <em><strong>Bearer Token</strong></em> that represents the permissions granted by the user to that RP.
For example the refresh token might indicate that the RP has permission to read the user&#x27;s profile data.</p>
<p>Refresh tokens can only be created by authorizing them via a valid <code>sessionToken</code>.</p>
<p>Refresh tokens should only ever be presented to the FxA OAuth server, and should <strong>not</strong> be used when
talking to other resource servers. Instead, the RP should use the refresh token to generate a short-lived
<a href="#oauth-access-tokens">access token</a> and use that to communicate with resource servers.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="oauth-access-tokens">OAuth Access Tokens<a href="#oauth-access-tokens" class="hash-link" aria-label="Direct link to OAuth Access Tokens" title="Direct link to OAuth Access Tokens">​</a></h3>
<p>RPs that wish to access resource servers on behalf of the user (say, to read or store user data) need
to obtain an <a href="https://www.oauth.com/oauth2-servers/access-tokens/" target="_blank" rel="noopener noreferrer">OAuth Access Token</a>.  This is a short-lived
<em><strong>Bearer Token</strong></em> that represents the permissions granted by the user to that RP, in a format that can
be consumed by resource servers. For example the RP might use an access token with scope &quot;profile&quot; in order
to read the user&#x27;s profile data from the FxA profile server.</p>
<p>FxA also supports JWT Access tokens.  See <a href="#jwt-access-tokens">JWT Access Tokens</a> for an in-depth look at that less-commonly-used type.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="oidc-identity-tokens">OIDC Identity Tokens<a href="#oidc-identity-tokens" class="hash-link" aria-label="Direct link to OIDC Identity Tokens" title="Direct link to OIDC Identity Tokens">​</a></h3>
<p>They&#x27;re for signin.</p>
<p>See the <a href="https://openid.net/specs/openid-connect-core-1_0.html#IDToken" target="_blank" rel="noopener noreferrer">OIDC spec</a> and the
<a href="https://accounts.firefox.com/.well-known/openid-configuration" target="_blank" rel="noopener noreferrer">FxA supported claims</a>.</p>
<p>This token, a JWT, proves that a user&#x27;s been authenticated (in this case,
with FxA). It can also be used as the <code>id_token_hint</code> query param value in a
<code>prompt=none</code> flow (<a href="https://github.com/mozilla/fxa/blob/main/packages/fxa-auth-server/docs/oauth/prompt-none.md" target="_blank" rel="noopener noreferrer">additional information</a>).</p>
<p>This token is issued along with the access token and refresh token when the
scope &quot;openid&quot; is present.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="keyfetch-tokens">KeyFetch Tokens<a href="#keyfetch-tokens" class="hash-link" aria-label="Direct link to KeyFetch Tokens" title="Direct link to KeyFetch Tokens">​</a></h3>
<p>They&#x27;re for fetching keys. RPs shouldn&#x27;t need to know this, because they use the scoped-keys flow.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="password-change-tokens">Password Change Tokens<a href="#password-change-tokens" class="hash-link" aria-label="Direct link to Password Change Tokens" title="Direct link to Password Change Tokens">​</a></h3>
<p>A special-use <em><strong>Hawk token</strong></em> for changing password.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="password-forgot-tokens">Password Forgot Tokens<a href="#password-forgot-tokens" class="hash-link" aria-label="Direct link to Password Forgot Tokens" title="Direct link to Password Forgot Tokens">​</a></h3>
<p>This is a special-use token for resetting a password. The user needs to be verified via a code received over email.  This has a limited number of verification attempts and generates a reset token.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="account-recovery-tokens">Account Recovery Tokens<a href="#account-recovery-tokens" class="hash-link" aria-label="Direct link to Account Recovery Tokens" title="Direct link to Account Recovery Tokens">​</a></h3>
<p>To help reduce the risk of a user losing their encrypted data (such as synced passwords or bookmarks) during a password reset, Firefox Account users can create an &quot;account recovery key&quot;. This account recovery key is used to store an encrypted version of the user&#x27;s encryption key <code>kB</code>, which can be re-wrapped with their new password during the password reset process.</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>If you&#x27;re looking for more detail, see the <a href="/ecosystem-platform/explanation/onepw-protocol">onepw protocol spec</a></p></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="registering-an-account-recovery-key">Registering an Account Recovery Key<a href="#registering-an-account-recovery-key" class="hash-link" aria-label="Direct link to Registering an Account Recovery Key" title="Direct link to Registering an Account Recovery Key">​</a></h4>
<p>Creating a new account recovery key involves the following steps:</p>
<ul>
<li>FxA web-content prompts for the user&#x27;s password and retrieves <code>kB</code>.</li>
<li>FxA web-content generates an &quot;account recovery key&quot;, consisting of between 16 and 32 random bytes.</li>
<li>FxA web-content uses HKDF to derive two values from the account recovery key:<!-- -->
<ul>
<li>A key fingerprint: recover-kid = HKDF(recover-key, uid, &quot;fxa recovery fingerprint&quot;, len=16)</li>
<li>An encryption key: recover-enc = HKDF(recover-key, uid, &quot;fxa recovery encrypt key&quot;, len=32)</li>
</ul>
</li>
<li>FxA web-content encrypts kB into a JWE to produce the &quot;recovery data&quot;:<!-- -->
<ul>
<li>recover-data = JWE(recover-enc, {&quot;alg&quot;: &quot;dir&quot;, &quot;enc&quot;: &quot;A256GCM&quot;, &quot;kid&quot;: recover-kid}, kB)</li>
</ul>
</li>
<li>FxA web-content submits recovery data to FxA server for storage,
associating it with the fingerprint (recover-kid)<!-- -->
<ul>
<li><code>POST /recoveryKey</code>, providing <code>recoveryKeyId</code> and <code>recoveryData</code> in the request body.</li>
</ul>
</li>
</ul>
<p>This scheme ensures someone in possession of the account recovery key, can request the encrypted recovery data from the FxA server, and use it to recover the user&#x27;s kB.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="using-an-account-recovery-key-during-password-reset">Using an Account Recovery Key during password reset<a href="#using-an-account-recovery-key-during-password-reset" class="hash-link" aria-label="Direct link to Using an Account Recovery Key during password reset" title="Direct link to Using an Account Recovery Key during password reset">​</a></h4>
<p>During the password reset process, a user who has an account recovery key can use it to maintain their existing kB as follows:</p>
<ul>
<li>User completes an email confirmation loop to confirm password reset.<!-- -->
<ul>
<li>This produces an <code>accountResetToken</code>, a credential for subsequent requests.</li>
</ul>
</li>
<li>User retrieves backup authentication code from print out or downloaded file,
and provides it to FxA web-content in the password reset flow.</li>
<li>FxA web-content uses the backup authentication code to derive the fingerprint
and encryption key (recover-kid and recover-enc as defined above).</li>
<li>FxA web-content requests recover-data from FxA server, providing recover-kid.<!-- -->
<ul>
<li><code>GET /recoveryKey/:recoveryKeyId</code>, authenticated with <code>accountResetToken</code>.</li>
<li>Providing the <code>:recoveryKeyId</code> here proves that the user possesses the account recovery key,
while the <code>accountResetToken</code> proves that they control the email address
of the account.</li>
</ul>
</li>
<li>FxA web-content decrypts recover-data with recover-enc to obtain the user&#x27;s kB.</li>
<li>User enters a new password into web-content.</li>
<li>FxA web-content wraps kB with the new password,
and submits <code>wrapKb</code> and <code>recoveryKeyId</code> with the account reset request.<!-- -->
<ul>
<li><code>POST /account/reset</code>, authenticated with <code>accountResetToken</code>,
providing <code>recoveryKeyId</code> and <code>wrapKb</code> in the request body.</li>
</ul>
</li>
<li>Upon successful password reset, the FxA auth-server deletes the
account recovery key and its associated recovery data.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="jwt-access-tokens">JWT Access Tokens<a href="#jwt-access-tokens" class="hash-link" aria-label="Direct link to JWT Access Tokens" title="Direct link to JWT Access Tokens">​</a></h3>
<p>The <a href="https://tools.ietf.org/html/rfc6749" target="_blank" rel="noopener noreferrer">original OAuth 2.0 spec</a> does not specify a
format for access tokens, most OAuth implementations use fixed length opaque tokens.</p>
<p>A service provider (SP) that accepts access tokens must verify the token to determine
whether the grant associated with the token has sufficient privileges to access a
protected resource. With opaque tokens, verification involves sending the token to
the remote authorization server (AS)&#x27;s <code>/introspect</code> endpoint. The AS looks up the
token in a database, verifies the token is still valid, and returns associated
metadata such as a userid and list of scopes in the grant. Because verification
involves a request to the AS, verification can introduce unwanted latency.</p>
<p>The IETF <a href="https://tools.ietf.org/html/draft-bertocci-oauth-access-token-jwt-00" target="_blank" rel="noopener noreferrer">JWT access token draft spec</a>
solves the latency problem by defining a standard access token format that can be verified
locally by the SP, eliminating the need to call remote services on every verification.</p>
<p><a href="https://tools.ietf.org/html/rfc7519" target="_blank" rel="noopener noreferrer">JWTs are signed JSON packets</a> that can contain
arbitrary information in fields called <code>claims</code> where a claim is a single unit of
information. JWT access tokens are signed with public/private key pairs, and once the
SP fetches the correct public key from the AS, no further remote calls are needed.
JWT access tokens can contain most of the same information as the AS&#x27;s <code>/introspect</code>
endpoint.</p>
<p>At a high level, a SP that wishes to do local verification of JWT access tokens needs
to verify the header of the token, verify the signature of the token, ensure the token
is not yet expired, and ensure the access token contains the correct claims necessary
to access a protected resource. More information can be found in the section titled
<a href="#local-verification-of-a-jwt-access-token">Local verification of a JWT access token</a>.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="claims-within-a-jwt-access-token">Claims within a JWT access token<a href="#claims-within-a-jwt-access-token" class="hash-link" aria-label="Direct link to Claims within a JWT access token" title="Direct link to Claims within a JWT access token">​</a></h4>
<p>Mozilla accounts largely follows the IETF JWT access token draft spec&#x27;s
<a href="https://tools.ietf.org/html/draft-bertocci-oauth-access-token-jwt-00#section-2.2" target="_blank" rel="noopener noreferrer">Data Structure</a>.</p>
<ul>
<li><code>aud</code> - audience. By default the <code>client_id</code> of the Relying Party (RP). If a RP specifies
a <a href="https://tools.ietf.org/html/draft-ietf-oauth-resource-indicators-08" target="_blank" rel="noopener noreferrer">Resource Indicator</a> when requesting the access token, it will be an array that contains both the client_id and the resource indicator.</li>
<li><code>client_id</code> - client id of the RP.</li>
<li><code>iss</code> - issuer. For tokens that come from FxA&#x27;s production stack this will be <code>https://accounts.firefox.com</code></li>
<li><code>exp</code> - expiration time after which the access token MUST NOT be accepted for processing, in <em>seconds</em> since Unix epoch.</li>
<li><code>iat</code> - time at which the token was issued, in <em>seconds</em> since Unix epoch.</li>
<li><code>jti</code> - JWT id</li>
<li><code>scope</code> - space separated list of scopes associated with the grant.</li>
<li><code>sub</code> - subject, user id. Normally the FxA user id for the user. If the RP uses <a href="https://github.com/mozilla/fxa/blob/main/packages/fxa-auth-server/docs/oauth/pairwise-pseudonymous-identifiers.md" target="_blank" rel="noopener noreferrer">Pairwise Pseudonymous Identifiers (PPID)</a>, will be an identifier that cannot be correlated to either the real FxA userid, or the PPID given out to other RPs.</li>
<li><code>fxa-subscriptions</code> - space separated list of subscriptions the user has for the RP. Claim is only present if the user has a subscription with the RP.</li>
</ul>
<p>Internal Mozilla reliers also have access to the following custom claims:</p>
<ul>
<li><code>fxa-generation</code>: A number that increases each time the user&#x27;s password is changed.
Reliers can use this value to reject JWTs that were created before the password change,
by tracking the largest-seen <code>fxa-generation</code> claim for each user and rejecting tokens
that have smaller values.</li>
<li><code>fxa-profileChangedAt</code>: A timestamp that increases each time the user&#x27;s core profile data
is changed. Reliers can use this value to refresh cached profile data in a timely manner.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="local-verification-of-a-jwt-access-token">Local verification of a JWT access token<a href="#local-verification-of-a-jwt-access-token" class="hash-link" aria-label="Direct link to Local verification of a JWT access token" title="Direct link to Local verification of a JWT access token">​</a></h4>
<p>The following is based on the <a href="https://tools.ietf.org/html/draft-bertocci-oauth-access-token-jwt-00#section-4" target="_blank" rel="noopener noreferrer">section on validation</a> JWT Access Token Draft Spec:</p>
<ol>
<li>The resource server MUST verify that the <code>typ</code> header value is
<code>at+jwt</code> and reject tokens carrying any other value.</li>
<li>The resource server MUST validate the signature of all incoming
JWT access token according to <a href="https://tools.ietf.org/html/rfc7515" target="_blank" rel="noopener noreferrer">RFC7515</a> using the algorithm
specified in the JWT <code>alg</code> Header Parameter. The SP MUST use the keys provided
at <a href="https://oauth.accounts.firefox.com/v1/jwks" target="_blank" rel="noopener noreferrer">https://oauth.accounts.firefox.com/v1/jwks</a></li>
<li>The <code>iss</code> claim MUST exactly match <code>https://accounts.firefox.com</code></li>
<li>The resource server MUST validate that the <code>aud</code> claim contains the
resource indicator value corresponding to the identifier the
resource server expects for itself, and should at a minimum contain
the client_id for the RP. The <code>aud</code> claim MAY contain an
array with more than one element. The JWT access token MUST be
rejected if <code>aud</code> does not list the resource indicator of the
current resource server as a valid audience, or if it contains
additional audiences that are not known aliases of the resource
indicator of the current resource server.</li>
<li>The current time MUST be before the time represented by the <code>exp</code>
Claim. <code>exp</code> is in <em>seconds</em> since Unix epoch.</li>
<li>The <code>scope</code> claim must contain the scopes necessary to access a protected resource.</li>
<li>If the protected resource requires a subscription, check the <code>fxa-subscriptions</code> claim
for the expected subscription capability. More information on why the <code>fxa-subscriptions</code>
claim is used instead of adding subscriptions onto the <code>scope</code> claim, please see
<a href="https://github.com/mozilla/fxa/blob/main/docs/adr/0007-subscription-claim-jwt-access-token.md" target="_blank" rel="noopener noreferrer">this explanation</a>.</li>
</ol>
<p>Libraries such as <a href="https://github.com/auth0/node-jsonwebtoken/" target="_blank" rel="noopener noreferrer">node-jsonwebtoken</a>, when properly configured, take
care of all of this except for the <code>scope</code> and <code>fxa-subscriptions</code> checks.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="remote-verification-of-a-jwt-access-token">Remote verification of a JWT access token<a href="#remote-verification-of-a-jwt-access-token" class="hash-link" aria-label="Direct link to Remote verification of a JWT access token" title="Direct link to Remote verification of a JWT access token">​</a></h4>
<p>A SP is not required to locally verify JWT access tokens, instead it may verify
these tokens by presenting them to FxA&#x27;s <a href="/ecosystem-platform/api#tag/OAuth-Server-API-Overview/operation/postIntrospect">/introspect</a>
and <a href="/ecosystem-platform/api#tag/OAuth-Server-API-Overview/operation/postVerify">/verify</a> endpoints.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="pitfalls-of-jwt-access-tokens">Pitfalls of JWT access tokens<a href="#pitfalls-of-jwt-access-tokens" class="hash-link" aria-label="Direct link to Pitfalls of JWT access tokens" title="Direct link to Pitfalls of JWT access tokens">​</a></h4>
<p>While FxA JWT access tokens allow for local verification, they do have some drawbacks.</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="access-token-size">Access token size<a href="#access-token-size" class="hash-link" aria-label="Direct link to Access token size" title="Direct link to Access token size">​</a></h5>
<p>The most obvious drawback is size, a JWT access token requires over 800 bytes
whereas a normal access token requires 64 bytes. JWT access tokens that are
sent with every request could add significant overhead.</p>
<p>JWT access tokens are signed using RSA keys, which generate large signatures. Changing
to a different key type would reduce the signature size but due to lack of demand this is not on the FxA roadmap.</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="revocation-and-cached-tokens">Revocation and cached tokens<a href="#revocation-and-cached-tokens" class="hash-link" aria-label="Direct link to Revocation and cached tokens" title="Direct link to Revocation and cached tokens">​</a></h5>
<p>A second, more subtle issue comes with local verification and revocation. When a
token is verified against FxA servers, FxA is able to look up whether that token has
been revoked by the user and immediately notify the SP the token is no longer valid.
SPs that cache and locally verify JWT access tokens have no way of knowing whether
the token has been revoked, they can only determine whether a token has expired.
Because tokens expire 24 to 48 hours after they are created (depending on FxA server load),
an SP could consider a token valid long after it has been revoked by the user.</p>
<p>Two mechanisms exist to partially mitigate this:</p>
<ul>
<li>Perform an occasional remote verification against the <code>/introspect</code> endpoint.</li>
<li>When trading the code for the token, specify a short <code>ttl</code>. Whenever the refresh token
is used to fetch a new access token, the <code>/token</code> endpoint will return a 4xx error indicating
the refresh token has been revoked.</li>
</ul>
<p>In the future, FxA may send notifications to SPs whenever an access or refresh token is revoked, but this functionality is not yet built.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="requesting-use-of-jwt-access-tokens">Requesting use of JWT access tokens<a href="#requesting-use-of-jwt-access-tokens" class="hash-link" aria-label="Direct link to Requesting use of JWT access tokens" title="Direct link to Requesting use of JWT access tokens">​</a></h4>
<p>JWT access tokens are only enabled for RPs on an opt-in basis. RPs can request JWT access
tokens when their OAuth credentials are being provisioned.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="token-pruning">Token Pruning<a href="#token-pruning" class="hash-link" aria-label="Direct link to Token Pruning" title="Direct link to Token Pruning">​</a></h2>
<p>FxA has a <a href="https://github.com/mozilla/fxa/blob/main/packages/fxa-auth-server/scripts/prune-tokens.ts" target="_blank" rel="noopener noreferrer">token pruning script</a> which runs via cron and is responsible for removing stale tokens in our system.  The actual token limits and values are variables which we may modify at any time and aren&#x27;t in the repository.</p>
<p>A session token that has a device record will never be pruned, because that would break Sync. So we only prune tokens if there’s no corresponding device in the db.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/mozilla/ecosystem-platform/edit/master/docs/reference/tokens.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/ecosystem-platform/reference/third-party-authentication"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Third Party Authentication</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/ecosystem-platform/reference/webchannels"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">WebChannels</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#token-formats" class="table-of-contents__link toc-highlight">Token Formats</a></li><li><a href="#token-types" class="table-of-contents__link toc-highlight">Token Types</a><ul><li><a href="#session-tokens" class="table-of-contents__link toc-highlight">Session Tokens</a></li><li><a href="#oauth-refresh-tokens" class="table-of-contents__link toc-highlight">OAuth Refresh Tokens</a></li><li><a href="#oauth-access-tokens" class="table-of-contents__link toc-highlight">OAuth Access Tokens</a></li><li><a href="#oidc-identity-tokens" class="table-of-contents__link toc-highlight">OIDC Identity Tokens</a></li><li><a href="#keyfetch-tokens" class="table-of-contents__link toc-highlight">KeyFetch Tokens</a></li><li><a href="#password-change-tokens" class="table-of-contents__link toc-highlight">Password Change Tokens</a></li><li><a href="#password-forgot-tokens" class="table-of-contents__link toc-highlight">Password Forgot Tokens</a></li><li><a href="#account-recovery-tokens" class="table-of-contents__link toc-highlight">Account Recovery Tokens</a></li><li><a href="#jwt-access-tokens" class="table-of-contents__link toc-highlight">JWT Access Tokens</a></li></ul></li><li><a href="#token-pruning" class="table-of-contents__link toc-highlight">Token Pruning</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 Mozilla Corporation.</div></div></div></footer></div>
</body>
</html>