<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-reference/rate-limiting" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">Rate limiting | Firefox Ecosystem Platform</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://mozilla.github.io/ecosystem-platform/reference/rate-limiting"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Rate limiting | Firefox Ecosystem Platform"><meta data-rh="true" name="description" content="FxA now uses a rate-limit library that communicates with a dedicated Redis instance to conduct rate-limiting operations. The following is essentially just a rehashed version of the libraries readme file which can be found here. Always check the lib&#x27;s readme for the most up to date doc!"><meta data-rh="true" property="og:description" content="FxA now uses a rate-limit library that communicates with a dedicated Redis instance to conduct rate-limiting operations. The following is essentially just a rehashed version of the libraries readme file which can be found here. Always check the lib&#x27;s readme for the most up to date doc!"><link data-rh="true" rel="icon" href="/ecosystem-platform/img/firefox-logo.png"><link data-rh="true" rel="canonical" href="https://mozilla.github.io/ecosystem-platform/reference/rate-limiting"><link data-rh="true" rel="alternate" href="https://mozilla.github.io/ecosystem-platform/reference/rate-limiting" hreflang="en"><link data-rh="true" rel="alternate" href="https://mozilla.github.io/ecosystem-platform/reference/rate-limiting" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://RFM5H13DFK-dsn.algolia.net" crossorigin="anonymous"><link rel="search" type="application/opensearchdescription+xml" title="Firefox Ecosystem Platform" href="/ecosystem-platform/opensearch.xml"><link rel="stylesheet" href="/ecosystem-platform/assets/css/styles.b0ab5bf8.css">
<script src="/ecosystem-platform/assets/js/runtime~main.3644a1ac.js" defer="defer"></script>
<script src="/ecosystem-platform/assets/js/main.d163ad31.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();null!==e?t(e):window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,t("light"))}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/ecosystem-platform/img/firefox-logo.png"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/ecosystem-platform/"><div class="navbar__logo"><img src="/ecosystem-platform/img/firefox-logo.png" alt="Ecosystem Platform Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/ecosystem-platform/img/firefox-logo.png" alt="Ecosystem Platform Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Firefox Ecosystem Platform</b></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/mozilla/ecosystem-platform" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/ecosystem-platform/">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link">For Relying Parties</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/ecosystem-platform/relying-parties/tutorials/integration-with-fxa">Tutorials</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/ecosystem-platform/relying-parties/how-tos/end-to-end-encryption">How-to Guides</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/ecosystem-platform/relying-parties/reference/glossary">Reference</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--active">For FxA Engineers</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/ecosystem-platform/tutorials/development-setup">Tutorials</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/ecosystem-platform/how-tos/ci-guidelines">How-to Guides</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/ecosystem-platform/reference/team-processes/development-process">Reference</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/ecosystem-platform/reference/team-processes/development-process">Team Processes</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/ecosystem-platform/reference/style-guides/node-style-guide">Style Guides</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/ecosystem-platform/reference/tests-in-circleci">CI and Test Automation</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/reference/application-logging">Application Logging</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/reference/application-tracing">Application Tracing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/reference/browser-support">Browser Support</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/reference/canceling-subscriptions-to-plan">Canceling Subscriptions to Plan</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/customs-api">⚙️ Customs API Reference</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/reference/database-structure">Database Structure</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/reference/emails">Emails</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/reference/experiments-ab-testing">Experiments &amp; A/B Testing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/reference/github-strategies">GitHub Strategies</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/reference/localization">Localization</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/reference/metrics">Metrics</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/reference/mobile-specifics">Mobile Specifics</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/reference/npm-scripts-and-nx">NPM / NX Guidelines</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/reference/oauth-details">OAuth Details</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/ecosystem-platform/reference/rate-limiting">Rate limiting</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/reference/storybook-deploys-with-circleci">Storybook Deploys with CircleCI</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/reference/system-diagrams">System Diagrams</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/reference/third-party-authentication">Third Party Authentication</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/reference/tokens">Tokens</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/reference/webchannels">WebChannels</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a href="https://docs.telemetry.mozilla.org/datasets/fxa.html" target="_blank" rel="noopener noreferrer" class="menu__link menuExternalLink_NmtK" tabindex="0">Telemetry Data Docs<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/ecosystem-platform/explanation/architectural-decision-records">Explanation</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/ecosystem-platform/additional-docs">Additional Docs</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link">For Support Agents</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/ecosystem-platform/reference/admin-panel">Reference</a></div></li></ul></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/ecosystem-platform/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">For FxA Engineers</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Reference</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Rate limiting</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Customs V2 Docs</h1></header>
<p>FxA now uses a rate-limit library that communicates with a dedicated Redis instance to conduct rate-limiting operations. The following is essentially just a rehashed version of the libraries readme file which can be found here. Always check the lib&#x27;s readme for the most up to date doc!</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="defining-rules">Defining Rules<a href="#defining-rules" class="hash-link" aria-label="Direct link to Defining Rules" title="Direct link to Defining Rules">​</a></h2>
<p>This library is driven by a simple grammar for defining rules. The grammar is as follows:</p>
<p><code> ${action} : ${property} : ${attempts} : ${window} : ${duration} : ${policy}</code></p>
<p>Where a &#x27;section&#x27; is separated by &#x27;:&#x27; and leading and trailing whitespace within a section is trimmed.
Note that comments can be added by starting a line with &#x27;#&#x27;. Adding comments explaining what the rulesets try to achieve is encouraged!</p>
<ul>
<li><code>action</code>   - This is the user action being checked and counted. For example, accountLogin would check when an account login is attempted.</li>
<li><code>property</code> - The property/attribute we are counting for a given action. Options are ip, email, ip_email, uid and ip_uid.</li>
<li><code>attempts</code> - Number of tries until the rule is considered violated and block (or ban) occurs</li>
<li><code>window</code>   - Time span over which actions are counted. Once the window ends, actions are allowed again.</li>
<li><code>duration</code> - How long the block (or ban) remains active. Note that while the block is active, attempts are not counted!</li>
<li><code>policy</code>   - Determines what happens after a rate limit is exceeded. Options are block, ban, or report</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="property-options">Property Options<a href="#property-options" class="hash-link" aria-label="Direct link to Property Options" title="Direct link to Property Options">​</a></h3>
<p>Here the valid options that can be provided in the property column, and their significance.</p>
<ul>
<li>ip        - The user&#x27;s IP. This is often useful for &#x27;ban&#x27; policies, where we want to flag an IP that is making a large number of requests.</li>
<li>ip_email  - The user&#x27;s IP with the user&#x27;s email appended. This is useful for ensuring one user cannot impact another user&#x27;s experience.</li>
<li>email     - The user&#x27;s email. This is useful only when the account isn&#x27;t known and for some reason, we don&#x27;t want to use ip_email.</li>
<li>uid       - The user&#x27;s account id. This can be useful for stopping a user that has logged in from doing something malicious, like trying to mine data.</li>
<li>ip_uid    - The user&#x27;s account id with the user&#x27;s uid appended. This is useful for ensuring one user cannot impact another user&#x27;s experience.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="policy-options">Policy Options<a href="#policy-options" class="hash-link" aria-label="Direct link to Policy Options" title="Direct link to Policy Options">​</a></h3>
<p>The block on policy describes what happens when a rate limit is exceeded. Or in other words when a given block on property is has seen more than the
the allotted max attempts.</p>
<ul>
<li>block  - The action+property for the rule is no longer permitted until the duration expires or the user provides an unblock code on sign in and clears the block.</li>
<li>ban    - Any and all rules for the given property are no longer permitted until the duration expires. Bans cannot be cleared by end users! So be very careful defining bans.</li>
<li>report - The rule for the given action and property is only reported on, i.e. we emit metrics that can be monitored, but we do not actually block the action/property.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="the-default-rule">The &#x27;default&#x27; Rule<a href="#the-default-rule" class="hash-link" aria-label="Direct link to The &#x27;default&#x27; Rule" title="Direct link to The &#x27;default&#x27; Rule">​</a></h3>
<p>To avoid lots of repetitive configuration, we have one special rule known as the &#x27;default&#x27; rule. This rule
is used as a fallback in the event an action is supplied to the rate limiter, but it cannot be found in the
set of configured rules. When the &#x27;default&#x27; rule is used, the action count is still kept distinct per action,
but the policy from the default rule is used.</p>
<p>For example, if we were to call</p>
<p><code>rateLimit.check(&#x27;foo&#x27;, { ip:0.0.0.0})</code></p>
<p>And our rules file looked like this:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">default : ip       : 100 : 10 minutes : 10 minutes : block</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">bar     : ip_email : 5   : 10 minutes : 10 minutes : block</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Then we&#x27;d increment the redis count for action foo blocking on ip, but we&#x27;d use the default rule&#x27;s settings to
determine the rate limit. So the redis state would like this after calling check:</p>
<p><code>rate-limit:attempts:ip=0.0.0.0:foo:100-600-600 =&gt; 1</code></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="testing--development-considerations">Testing &amp; Development Considerations<a href="#testing--development-considerations" class="hash-link" aria-label="Direct link to Testing &amp; Development Considerations" title="Direct link to Testing &amp; Development Considerations">​</a></h3>
<p>When developing new features, running functional test suites locally, or running smoke tests remotely, rate-limiting behavior can be annoying — or even downright disruptive. To work around this, there are a few options:</p>
<ul>
<li>You override ride them via an environment variable, RATE_LIMIT__RULES=&quot;&quot; <em>(Preferred option, since it works across the board.)</em></li>
<li>You use dev.json and override the config.</li>
<li>You can set the maxAttempt to be all be very high (or vary low if you want to test blocking scenarios quickly). <em>(Not great, you might accidently commit your changes.)</em></li>
<li>You can simply delete the contents of the rules in rate-limit-rules.txt. <em>(Not preferred cause you might accidently commit the change!)</em></li>
</ul>
<p>_ Note, you could also just add your IP to the RATE_LIMIT__IGNORE_IPS filter as mentioned below. Same options above apply here as to where / how you set this filter._</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="exclude-specific-attributes-like-ip-email-or-uid">Exclude specific attributes like ip, email, or UID<a href="#exclude-specific-attributes-like-ip-email-or-uid" class="hash-link" aria-label="Direct link to Exclude specific attributes like ip, email, or UID" title="Direct link to Exclude specific attributes like ip, email, or UID">​</a></h4>
<p>When running smoke tests against a remote server, the first approach may not work — so we also support excluding specific emails or IP addresses from being checked by the rate limiter. To do this, define these values in your server&#x27;s config file and pass them to the rate limiter.</p>
<ul>
<li>Email ignore values can use regex filters.</li>
<li>IP addresses and UIDs must be exact string matches.</li>
</ul>
<p><em>Note that when using the email filter, checks run on IP only may still be susceptible to getting blocked! For this reason the IP filter might be a better approach if you can use static IPs.</em></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="auth-server-specifics">Auth Server specifics<a href="#auth-server-specifics" class="hash-link" aria-label="Direct link to Auth Server specifics" title="Direct link to Auth Server specifics">​</a></h3>
<p>The auth server has a special config for auto checking all endpoints. To turn this on set <code>RATE_LIMIT__CHECK_ALL_ENDPOINTS=true</code>.</p>
<p>At the time of writing this isn&#x27;t currently enabled, but it might be in the future. And if it is, a couple things to note:</p>
<ul>
<li>When this is enabled, we should define the &#x27;default&#x27; rule! Otherwise calls will fall back to the legacy customs service, and this could result in a spike of blocked requests.</li>
<li>It&#x27;s also important to note that individual endpoints can be configured with the following pattern, <code>${HTTP_METHOD}_${PATH}</code> where path is lower case and non alpha numeric characters are converted to underscores.</li>
<li>Some endpoints like <code>/v1/verify</code> have very high traffic, so specific rules should be added for these endpoints. For example <code>post__v1_verify : 100 : ip : 1 minute : 1 minute : report</code> would be a safe rule to add if turning on check all end points.</li>
<li>Alternatively we might even consider skipping high traffic endpoints from rate-limiting checks. To do this add the high traffic endpoint to the <code>RATE_LIMIT__SKIP_ENDPOINTS</code> config setting.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="graphql-specifics">Graphql Specifics<a href="#graphql-specifics" class="hash-link" aria-label="Direct link to Graphql Specifics" title="Direct link to Graphql Specifics">​</a></h3>
<p>Graphql also has the ability to run custom checks on on various actions. To do this simply decorate the endpoint to protect with <code>@UseGuards(GqlCustomsGuard(&#x27;updateDisplayName&#x27;))</code>, where updateDisplayName is the action you wan to rate limit.</p>
<p>Same as auth-server, you can define default rules in the rate-limit-rules.txt file, or via the RATE_LIMIT__RULES env.</p>
<p><em>At the time of writing, there is no way to check all graphql endpoints automatically...</em></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="new-blocking-scenarios">New Blocking Scenarios<a href="#new-blocking-scenarios" class="hash-link" aria-label="Direct link to New Blocking Scenarios" title="Direct link to New Blocking Scenarios">​</a></h3>
<p>We have begun to collect blocking scenarios as a team in an attempt to strategize around how to provide rules that protect our end users, but also aren&#x27;t overly aggressive or annoying. If you are interested in these scnearios, or are considering adding a new one, please reach out to an FxA team member or look for the blocking scenarios in our internal docs for more info on how we approach setting up robust rate limiting rules.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="faq">FAQ<a href="#faq" class="hash-link" aria-label="Direct link to FAQ" title="Direct link to FAQ">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="how-is-it-different-from-v1">How is it different from V1?<a href="#how-is-it-different-from-v1" class="hash-link" aria-label="Direct link to How is it different from V1?" title="Direct link to How is it different from V1?">​</a></h3>
<p>The new version no longer uses a ‘service’. It talks directly to redis via the <code>libs/accounts/rate-limit</code> library. This library serves as the abstraction for configuring and enforcing rate limit policies.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="why-the-rewrite">Why the rewrite?<a href="#why-the-rewrite" class="hash-link" aria-label="Direct link to Why the rewrite?" title="Direct link to Why the rewrite?">​</a></h3>
<p>There’s several reasons.</p>
<ul>
<li>It’s smaller. The service had 3426 lines of codes, and the new library had 960 lines.</li>
<li>It’s config driven. The customs configuration is now easy to read and understand. There’s no more second guessing what customs is doing, just check the config. There’s also no need to edit code to add a rule, just update the config.</li>
<li>It’s more efficient and more direct. We skip a whole round of http web requests and json serialization. The new lib talks directly to redis.</li>
<li>It allows for more grain tuning of rules. We can now distinguish between blocking and banning, and we can do this on ip, email, uid, ip+email, or ip+uid. The old service would inevitably block on ip or email and bugs like this would happen.</li>
<li>It can be configured independently per service. Previously the custom’s service had a config that was specific to the services that used it. This is a prime example of feature envy. The old customs service was effectively concerned with aspects of the services it was being called from. This relationship is backward. In the new approach the library has no configuration defined. And has no knowledge of the calling code. The requirements for configuration have been shifted to calling code where they belong.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="great-can-i-just-turn-it-off-its-annoying-while-developing">Great, can I just turn it off? It’s annoying while developing…<a href="#great-can-i-just-turn-it-off-its-annoying-while-developing" class="hash-link" aria-label="Direct link to Great, can I just turn it off? It’s annoying while developing…" title="Direct link to Great, can I just turn it off? It’s annoying while developing…">​</a></h3>
<p>Yes, this is very easy. Simply set the rateLimit.rules to an empty string, and voila it’s off. Any of the following work for this:</p>
<ul>
<li>Set <code>RATE_LIMIT__RULES=””</code> in your .env file or .bashrc</li>
<li>Override the config setting in dev.json as you would any other config in fxa.</li>
<li>Delete the contents of rate-limit-rules.txt that customs reads from by default.</li>
</ul>
<p>Please note, we’d like you to develop with customs on! Ignoring customs is like ignoring an important piece of functionality in the code base.</p>
<p>We currently have plenty of examples where customs errors are not handled correctly. This probably stems from people developing with customs off. A better approach is to alter the ‘max attempts’ in the rate-limit-rules.txt files as needed. You could increase max attempts value to make customs less active, or decrease the max attempts value to make customs more active and make it easier to test blocking behavior.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="whats-the-difference-between-a-block-a-ban-and-report-policy-again">What’s the difference between a block, a ban, and report policy again?<a href="#whats-the-difference-between-a-block-a-ban-and-report-policy-again" class="hash-link" aria-label="Direct link to What’s the difference between a block, a ban, and report policy again?" title="Direct link to What’s the difference between a block, a ban, and report policy again?">​</a></h3>
<p>Blocks only apply to the current rule. You can think of a block as blocking an isolated action once the max attempts are hit.</p>
<p>Bans apply to the current rule, and all other rules. If a user trips a ban, then they are effectively blocked from that action, and all other actions, hence the term ‘ban’.</p>
<p>Report is the final policy option for . It allows you to record metrics, but not actually do a block. This is great for testing out hypotheticals with little risk. But, be careful not to clobber other existing rules when you use this!</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="whats-up-with-the-default-rule-again">What’s up with the ‘default’ rule again?<a href="#whats-up-with-the-default-rule-again" class="hash-link" aria-label="Direct link to What’s up with the ‘default’ rule again?" title="Direct link to What’s up with the ‘default’ rule again?">​</a></h3>
<p>The default rule is a special case. When configured, it will act as the fallback in the event a rule isn’t found. For example, let’s say you have a call like this: <code>rateLimit.check(‘foo’, {ip});</code> If there is no rule for action foo in the current rate limit rules config, then if and only if there’s a default rule defined, we will use that.</p>
<p>Be sure to set defaults for ALL blocks on policies. Otherwise, you might get an error.</p>
<p>Be very careful with the default. It should have plenty of overhead!</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="im-adding-a-new-rule-but-im-concerned-about-the-impact-can-i-monitor-this">I’m adding a new rule but I’m concerned about the impact, can I monitor this?<a href="#im-adding-a-new-rule-but-im-concerned-about-the-impact-can-i-monitor-this" class="hash-link" aria-label="Direct link to I’m adding a new rule but I’m concerned about the impact, can I monitor this?" title="Direct link to I’m adding a new rule but I’m concerned about the impact, can I monitor this?">​</a></h3>
<p>Yep! We got graphs over in yardstick. If you can&#x27;t find them reach out to a teammate.</p>
<p>A couple things to note about these graphs. We have some that are specific to auth-server. These metrics look like fxa_auth_server_customs_*. These are legacy metrics and we use these comparisons before and after a rule rolls out.</p>
<p>We also have the metrics emitted by the rate-limit library. These metrics offer further information about what got blocked and why. This graph provides a lot of detail about the exact nature of blocks that are occurring. These are rules targeting <code>${SERVICE_NAME}_rate_limit_*</code>. These will be referenced in dashboards titled ‘Rate Limit Library - $VIEW`.</p>
<p>As noted above, when rolling out a new rule, it’s often a good idea to roll it out initially with the ‘report’ policy, so no blocks occur at first. This can give a baseline for whether or not blocks seem reasonable. Once you feel good with blocking, i.e. we don’t see a sky high number of blocks, you can change the ‘report’ policy to a block or ban policy.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="once-a-user-is-blocked-do-they-get-unblocked-how-does-this-work-exactly">Once a user is blocked, do they get unblocked? How does this work exactly?<a href="#once-a-user-is-blocked-do-they-get-unblocked-how-does-this-work-exactly" class="hash-link" aria-label="Direct link to Once a user is blocked, do they get unblocked? How does this work exactly?" title="Direct link to Once a user is blocked, do they get unblocked? How does this work exactly?">​</a></h3>
<p>Yes, a user can become unblocked if they provide an unblock code at sign in. If the code is valid, all blocks will be cleared for the users’s current IP, email, uid, ip+email, and ip+uid that proved the sign in code correct… Checkout how the <code>/account/login/send_unblock_code</code> is invoked, and how the <code>RateLimit::unblock</code> method is called for exact details.</p>
<p>It’s important to note that ‘bans’ WILL NOT BE CLEARED. Which is why we should be very careful with ban operations and only apply them in cases where the behavior is clearly malicious like incorrect attempts at passwords or codes.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="a-user-is-having-trouble-with-being-blocked-can-i-help-them">A user is having trouble with being blocked. Can I help them?<a href="#a-user-is-having-trouble-with-being-blocked-can-i-help-them" class="hash-link" aria-label="Direct link to A user is having trouble with being blocked. Can I help them?" title="Direct link to A user is having trouble with being blocked. Can I help them?">​</a></h3>
<p>This is a work in progress, but sometime soon, you sure can go to admin panel, and navigate to the rate limit section. You will have 3 OR filters at the top for ip, email, and uid. If you enter any of these, any active block or ban will be displayed below. Assuming you have admin privileges, you can clear these blocks and bans.</p>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="legacy-customs-v1-docs-kept-for-historical-record-will-be-removed">Legacy Customs V1 Docs (Kept for historical Record, will be removed!)<a href="#legacy-customs-v1-docs-kept-for-historical-record-will-be-removed" class="hash-link" aria-label="Direct link to Legacy Customs V1 Docs (Kept for historical Record, will be removed!)" title="Direct link to Legacy Customs V1 Docs (Kept for historical Record, will be removed!)">​</a></h2>
<p>Last updated: <code>June 21th, 2022</code></p>
<p>The <a href="https://github.com/mozilla/fxa/blob/main/packages/fxa-customs-server/README.md" target="_blank" rel="noopener noreferrer">Customs server</a> is the service responsible for maintaining and implementing rate limiting in FxA.
It was developed to help detect and deter <a href="https://wiki.mozilla.org/Identity/Firefox_Accounts/Fraud_and_abuse" target="_blank" rel="noopener noreferrer">fraud and abuse</a>.</p>
<p>Currently, only it is used by the <a href="https://github.com/mozilla/fxa-auth-server" target="_blank" rel="noopener noreferrer">Mozilla accounts Auth Server</a>.</p>
<p>The Customs server uses a sliding window to keep track of the current count of a specific type of action and trims the count as needed.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="policies">Policies<a href="#policies" class="hash-link" aria-label="Direct link to Policies" title="Direct link to Policies">​</a></h3>
<p>There are two types of policies:</p>
<ul>
<li>rate-limiting: slows down attackers by temporarily blocking requests for 15 minutes (see <code>config.limits.rateLimitIntervalSeconds</code>)</li>
<li>block / ban: stops attacks by temporarily blocking requests for 24 hours (see <code>config.limits.blockIntervalSeconds</code>)</li>
</ul>
<p>We currently have the following policies in place:</p>
<ul>
<li>rate-limiting when too many emails (<code>config.limits.maxEmails</code> defaults to 3) have been sent to the same email address in a given time period (<code>config.limits.rateLimitIntervalSeconds</code> defaults to 15 minutes)</li>
<li>rate-limiting when too many requests to look up account status by email address (<code>config.limits.maxAccountStatusCheck</code>) have been sent from the same ip address during</li>
<li>rate-limiting when too many sms (<code>config.limits.smsRateLimit.maxSms</code>) have been sent from the same ip address during period (<code>config.limits.smsRateLimit.limitIntervalSeconds</code> defaults to 60 minutes)</li>
<li>rate-limiting when too many sms (<code>config.limits.smsRateLimit.maxSms</code>) have been sent from the same email address during period (<code>config.limits.smsRateLimit.limitIntervalSeconds</code> defaults to 60 minutes)</li>
<li>rate-limiting when too many sms (<code>config.limits.smsRateLimit.maxSms</code>) have been sent to the same phone number during period (<code>config.limits.smsRateLimit.limitIntervalSeconds</code> defaults to 60 minutes)</li>
<li>rate-limiting when too many failed login attempts (<code>config.limits.maxBadLogins</code> defaults to 2) have occurred for a given account and IP address, in a given time period (<code>config.limits.rateLimitIntervalSeconds</code> defaults to 15 minutes)</li>
<li>rate-limiting too many attempts to verify randomly-generated codes (<code>config.limits.maxVerifyCodes</code> defaults to 10) have occurred for a given account and IP address, in a given time period (<code>config.limits.rateLimitIntervalSeconds</code> defaults to 15 minutes)</li>
<li>manual blocking of an account (see <code>/blockEmail</code> API call)</li>
<li>manual blocking of an IP address (see <code>/blockIp</code> API call)</li>
</ul>
<p>The data that these policies are based on is stored in a memcache instance (keyed by <code>email</code>, <code>ip</code> or <code>ip + email</code> depending on the policy) and the code that implements them is split across these three files:</p>
<ul>
<li><code>email_record.js</code> handles blocking and rate-limiting based only on the email address</li>
<li><code>ip_email_record.js</code> handles rate-limiting based on both the email and IP address of the request</li>
<li><code>ip_record.js</code> handles blocking based only on the IP address</li>
</ul>
<p>The rate-limiting and blocking policies are conveyed to the auth server via the <code>block</code> property in the response to <code>/check</code>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="usage-in-auth-server">Usage in Auth-server<a href="#usage-in-auth-server" class="hash-link" aria-label="Direct link to Usage in Auth-server" title="Direct link to Usage in Auth-server">​</a></h3>
<p>In the auth-server, we utilized a helper library to make calls to the custom server api. The request could contain email, ip, and the action being performed.</p>
<p>For example, the call <code>customs.check(request, email, &#x27;accountCreate&#x27;)</code> would increment the <code>accountCreate</code> event for the user coming from this ip address and email.</p>
<p>Below are the current actions supported:</p>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Actions that, if allowed, would allow an attacker</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// to try a candidtate password against an account.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token constant" style="color:rgb(130, 170, 255)">PASSWORD_CHECKING_ACTION</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token literal-property property">accountLogin</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token literal-property property">accountDestroy</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token literal-property property">passwordChange</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Actions that, if allowed, would allow an attacker</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// to try a guess at a randomly-generated security code.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Code are higher entropy so we can allow more of these,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// but if you&#x27;re doing it a lot, you&#x27;re probably a baddie.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token constant" style="color:rgb(130, 170, 255)">CODE_VERIFYING_ACTION</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token literal-property property">recoveryEmailVerifyCode</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token literal-property property">passwordForgotVerifyCode</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token literal-property property">verifyRecoveryCode</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token literal-property property">verifySessionCode</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// not high entropy</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// changes at 60 seconds</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// limits by email</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token literal-property property">verifyTotpCode</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Actions that, if allowed, would allow an attacker</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// to check whether an account exists or has certain</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// properties for a particular user.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Basically any unauthenticated endpoint that takes</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// an email address as input.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token constant" style="color:rgb(130, 170, 255)">ACCOUNT_STATUS_ACTION</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token literal-property property">accountCreate</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token literal-property property">accountLogin</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token literal-property property">accountDestroy</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token literal-property property">passwordChange</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token literal-property property">passwordForgotSendCode</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token literal-property property">accountStatusCheck</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token literal-property property">sendUnblockCode</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token literal-property property">recoveryKeyExists</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Actions that send an email, and hence might make</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// us look like spammers if abused.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token constant" style="color:rgb(130, 170, 255)">EMAIL_SENDING_ACTION</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token literal-property property">accountCreate</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token literal-property property">createEmail</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token literal-property property">recoveryEmailResendCode</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token literal-property property">recoveryEmailSecondaryResendCode</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token literal-property property">passwordForgotSendCode</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token literal-property property">passwordForgotResendCode</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token literal-property property">sendUnblockCode</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Actions that can send sms, and could make us</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// very annoying to a user if abused.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token constant" style="color:rgb(130, 170, 255)">SMS_SENDING_ACTION</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token literal-property property">connectDeviceSms</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/mozilla/ecosystem-platform/edit/master/docs/reference/rate-limiting.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/ecosystem-platform/reference/oauth-details"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">OAuth Details</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/ecosystem-platform/reference/storybook-deploys-with-circleci"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Storybook Deploys with CircleCI</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#defining-rules" class="table-of-contents__link toc-highlight">Defining Rules</a><ul><li><a href="#property-options" class="table-of-contents__link toc-highlight">Property Options</a></li><li><a href="#policy-options" class="table-of-contents__link toc-highlight">Policy Options</a></li><li><a href="#the-default-rule" class="table-of-contents__link toc-highlight">The &#39;default&#39; Rule</a></li><li><a href="#testing--development-considerations" class="table-of-contents__link toc-highlight">Testing &amp; Development Considerations</a></li><li><a href="#auth-server-specifics" class="table-of-contents__link toc-highlight">Auth Server specifics</a></li><li><a href="#graphql-specifics" class="table-of-contents__link toc-highlight">Graphql Specifics</a></li><li><a href="#new-blocking-scenarios" class="table-of-contents__link toc-highlight">New Blocking Scenarios</a></li></ul></li><li><a href="#faq" class="table-of-contents__link toc-highlight">FAQ</a><ul><li><a href="#how-is-it-different-from-v1" class="table-of-contents__link toc-highlight">How is it different from V1?</a></li><li><a href="#why-the-rewrite" class="table-of-contents__link toc-highlight">Why the rewrite?</a></li><li><a href="#great-can-i-just-turn-it-off-its-annoying-while-developing" class="table-of-contents__link toc-highlight">Great, can I just turn it off? It’s annoying while developing…</a></li><li><a href="#whats-the-difference-between-a-block-a-ban-and-report-policy-again" class="table-of-contents__link toc-highlight">What’s the difference between a block, a ban, and report policy again?</a></li><li><a href="#whats-up-with-the-default-rule-again" class="table-of-contents__link toc-highlight">What’s up with the ‘default’ rule again?</a></li><li><a href="#im-adding-a-new-rule-but-im-concerned-about-the-impact-can-i-monitor-this" class="table-of-contents__link toc-highlight">I’m adding a new rule but I’m concerned about the impact, can I monitor this?</a></li><li><a href="#once-a-user-is-blocked-do-they-get-unblocked-how-does-this-work-exactly" class="table-of-contents__link toc-highlight">Once a user is blocked, do they get unblocked? How does this work exactly?</a></li><li><a href="#a-user-is-having-trouble-with-being-blocked-can-i-help-them" class="table-of-contents__link toc-highlight">A user is having trouble with being blocked. Can I help them?</a></li></ul></li><li><a href="#legacy-customs-v1-docs-kept-for-historical-record-will-be-removed" class="table-of-contents__link toc-highlight">Legacy Customs V1 Docs (Kept for historical Record, will be removed!)</a><ul><li><a href="#policies" class="table-of-contents__link toc-highlight">Policies</a></li><li><a href="#usage-in-auth-server" class="table-of-contents__link toc-highlight">Usage in Auth-server</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 Mozilla Corporation.</div></div></div></footer></div>
</body>
</html>